<!doctype html><html lang=zh-hant dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-docaligner/model_arch" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>模型設計 | DOCSAID</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:image content=https://docsaid.org/img/docsaid-social-card.jpg><meta data-rh=true name=twitter:image content=https://docsaid.org/img/docsaid-social-card.jpg><meta data-rh=true property=og:url content=https://docsaid.org/docs/docaligner/model_arch><meta data-rh=true property=og:locale content=zh_hant><meta data-rh=true property=og:locale:alternate content=en><meta data-rh=true property=og:locale:alternate content=ja><meta data-rh=true name=docusaurus_locale content=zh-hant><meta data-rh=true name=docsearch:language content=zh-hant><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="模型設計 | DOCSAID"><meta data-rh=true name=description content=我們參考過去的研究文獻，首先考慮了點回歸模型。><meta data-rh=true property=og:description content=我們參考過去的研究文獻，首先考慮了點回歸模型。><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://docsaid.org/docs/docaligner/model_arch><link data-rh=true rel=alternate href=https://docsaid.org/docs/docaligner/model_arch hreflang=zh-hant><link data-rh=true rel=alternate href=https://docsaid.org/en/docs/docaligner/model_arch hreflang=en><link data-rh=true rel=alternate href=https://docsaid.org/ja/docs/docaligner/model_arch hreflang=ja><link data-rh=true rel=alternate href=https://docsaid.org/docs/docaligner/model_arch hreflang=x-default><link data-rh=true rel=preconnect href=https://S9NC0RYCHF-dsn.algolia.net crossorigin=anonymous><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="DOCSAID RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="DOCSAID Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-RDF83L9R4M"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-RDF83L9R4M",{anonymize_ip:!0})</script><link rel=search type=application/opensearchdescription+xml title=DOCSAID href=/opensearch.xml><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css type=text/css integrity=sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM crossorigin=anonymous><link rel=stylesheet href=/assets/css/styles.31f7b4f1.css><script src=/assets/js/runtime~main.7318dbfb.js defer></script><script src=/assets/js/main.0787e0c0.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/img/docsaid_logo.png><link rel=preload as=image href=/img/docsaid_logo_white.png><div role=region aria-label=跳至主要内容><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>跳至主要内容</a></div><nav aria-label=主導航 class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class=navbar__inner><div class=navbar__items><button aria-label=切換導覽列 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/docsaid_logo.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/img/docsaid_logo_white.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/docs/>開源專案</a><a class="navbar__item navbar__link" href=/papers/intro>論文筆記</a><a class="navbar__item navbar__link" href=/blog>部落格</a><a class="navbar__item navbar__link" href=/playground/intro>遊樂場</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg viewBox="0 0 24 24" width=20 height=20 aria-hidden=true class=iconLanguage_nlXk><path fill=currentColor d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>繁體中文</a><ul class=dropdown__menu><li><a href=/docs/docaligner/model_arch target=_self rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=zh-hant>繁體中文</a><li><a href=/en/docs/docaligner/model_arch target=_self rel="noopener noreferrer" class=dropdown__link lang=en>English</a><li><a href=/ja/docs/docaligner/model_arch target=_self rel="noopener noreferrer" class=dropdown__link lang=ja>日本語</a></ul></div><a href=https://github.com/DocsaidLab target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><a href=https://buymeacoffee.com/docsaid target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">支持我們<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><a class="navbar__item navbar__link" href=/aboutus>關於我們</a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="搜尋 (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>搜尋</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label=回到頂部 class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex=-1 class=sidebarLogo_isFc href=/><img src=/img/docsaid_logo.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/img/docsaid_logo_white.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"><b></b></a><nav aria-label=文件側邊欄 class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/>開源專案</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/model-training-guide/>模型訓練指南</a><button aria-label="展開側邊欄分類 '模型訓練指南'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/autotraderx/>AutoTraderX</a><button aria-label="展開側邊欄分類 'AutoTraderX'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/capybara/>Capybara</a><button aria-label="展開側邊欄分類 'Capybara'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/docs/docaligner/>DocAligner</a><button aria-label="收起側邊欄分類 'DocAligner'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/docaligner/intro>介紹</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/docaligner/installation>安裝</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/docaligner/quickstart>快速開始</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/docaligner/advance>進階設定</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/docs/docaligner/model_arch>模型設計</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/docaligner/benchmark>評估模型</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/docaligner/discussion>結果與討論</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/docaligner/dataset>資料集說明</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/docaligner/summit_data>資料集提交</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/docaligner/reference>參考文獻</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/docclassifier/>DocClassifier</a><button aria-label="展開側邊欄分類 'DocClassifier'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/gmailsummary/>GmailSummary</a><button aria-label="展開側邊欄分類 'GmailSummary'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/mrzscanner/>MRZScanner</a><button aria-label="展開側邊欄分類 'MRZScanner'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/wordcanvas/>WordCanvas</a><button aria-label="展開側邊欄分類 'WordCanvas'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav><button type=button title=收起側邊欄 aria-label=收起側邊欄 class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_kv0_><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=頁面路徑><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label=主頁面 class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/docs/docaligner/><span itemprop=name>DocAligner</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>模型設計</span><meta itemprop=position content=2></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">本頁導覽</button></div><div class="theme-doc-markdown markdown"><header><h1>模型設計</h1></header>
<p>我們參考過去的<a href=/docs/docaligner/reference><strong>研究文獻</strong></a>，首先考慮了點回歸模型。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=點回歸模型>點回歸模型<a href=#點回歸模型 class=hash-link aria-label=點回歸模型的直接連結 title=點回歸模型的直接連結>​</a></h2>
<p><img decoding=async loading=lazy alt=arch_1.jpg src=/assets/images/point_model_arch-cb2afeedf5c66ea527d29726f64e2f03.jpg width=4574 height=3254 class=img_ev3q></p>
<p>點回歸模型是我們最早期的版本，它的基本架構分成四個部分：</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=1-特徵提取>1. 特徵提取<a href=#1-特徵提取 class=hash-link aria-label="1. 特徵提取的直接連結" title="1. 特徵提取的直接連結">​</a></h3>
<p><img decoding=async loading=lazy alt=pp-lcnet.jpg src=/assets/images/lcnet_arch-89fd4d95f589dbbd8ca1edc5b4486391.jpg width=1224 height=736 class=img_ev3q></p>
<p>這部分主要是用來將影像轉換成向量，這裡使用了 <a href=https://arxiv.org/abs/2109.15099 target=_blank rel="noopener noreferrer"><strong>PP-LCNet</strong></a> 作為特徵提取器。</p>
<p>輸入影像為 128 x 128 的 RGB 影像，經過特徵提取器後，輸出一個 256 維的向量。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>提示</div><div class=admonitionContent_BuS1><p><strong>為什麼你們總是喜歡用 LCNet？</strong><p>因為我們常會需要把模型部署到手機上，LCNet 是一個非常輕量的模型，適合在手機上運行。此外，當我們需要對模型進行量化時，LCNet 通常不會有運算子不支援的問題。</div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=2-cross-attention>2. Cross-Attention<a href=#2-cross-attention class=hash-link aria-label="2. Cross-Attention的直接連結" title="2. Cross-Attention的直接連結">​</a></h3>
<p>在此模型中，我們將 Neck 部分是用於增強從 Backbone 流出的特徵。</p>
<p>在這個模型中，我們使用了 Cross-Attention 機制，這是一種 Transformer 中常用的機制，能夠捕捉不同特徵之間的關係，並將這些關係應用於特徵的增強。我們預期 Cross-Attention 能夠幫助模型理解圖像中不同點之間的空間關係，從而提高預測的準確性。除了 Cross-Attention 之外，我們還使用了位置編碼（positional encodings），這些編碼有助於模型理解圖像中點的空間位置，從而提高預測的準確性。</p>
<p>我們考慮點回歸的特性，對於精確的像素定位，非常依賴於低級的特徵。因此我們從深層特徵開始，依序往淺層特徵（1/32 -> 1/16 -> 1/8 -> 1/4 -> 1/2）進行查詢，這樣的設計能夠讓模型在不同尺度的特徵中找到文件的位置。我們認為這種查詢方式能夠有效地提高模型的準確性。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=3-point-regression>3. Point Regression<a href=#3-point-regression class=hash-link aria-label="3. Point Regression的直接連結" title="3. Point Regression的直接連結">​</a></h3>
<p>在預測頭的設計中，我們僅使用一個簡單的線性層作為 Head，將特徵轉換為點的坐標。我們希望模型可以更依賴於 Cross-Attention 的特徵的表達能力，而不是依賴於複雜頭部架構。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=4-smooth-l1-loss>4. Smooth L1 Loss<a href=#4-smooth-l1-loss class=hash-link aria-label="4. Smooth L1 Loss的直接連結" title="4. Smooth L1 Loss的直接連結">​</a></h3>
<p>在我們的模型中，我們選擇使用 Smooth L1 Loss 作為損失函數，這是一種在回歸任務中常用的損失函數，特別適用於處理存在異常值的情況。</p>
<p>與 L1 Loss 相比，Smooth L1 Loss 在預測值與真實值差異較大時更加穩健，能夠減少異常值對模型訓練的影響。此外，為了降低點回歸的放大誤差，我們將點預測的權重「提高至 1000」，經過我們的實驗，這樣的設計能夠有效地提高模型的準確性。</p>
<p>除了角點的損失之外，我們也用了其他的損失，包括：</p>
<ul>
<li>Classification Loss: 這是一種用於分類的損失函數，用於預測圖像中是否存在文件，使用 BCE Loss。</li>
</ul>
<p>請注意，這裡的分類損失並非只是輔助損失，而是主要損失之一，因為角點預測本身的限制，當遇到沒有目標物的情況時，仍會預測出角點，因此在部署階段，我們需要分類頭來告訴我們是否有目標物。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=災難性失敗>災難性失敗<a href=#災難性失敗 class=hash-link aria-label=災難性失敗的直接連結 title=災難性失敗的直接連結>​</a></h2>
<p>在「點回歸模型」的架構中，我們遭遇了非常嚴重的「<strong>放大誤差</strong>」問題。</p>
<p>這個問題的根源在於，我們訓練模型的過程中，需要縮小原始圖像至 128 x 128 或 256 x 256。這樣的縮小過程，會導致原始圖像中的細節信息丟失，進而導致模型在預測時，無法準確地找到文件的角點。</p>
<p><strong>正確來說，模型會找到基於縮小圖像的角點。</strong></p>
<p>然後我們必須將這些角點放大至原始圖像的尺寸，才能找到原始圖像中的角點位置。</p>
<p>這樣的放大過程，會導致角點的位置出現大約 5 ~ 10 像素的偏移量，進而導致模型無法準確地預測文件的位置。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>提示</div><div class=admonitionContent_BuS1><p>你可以想像：在原始圖像中，目標角點的方圓 10 像素的圖像，在預測時都會縮小到 1 像素。然後模型作出預測，最後在放大過程中，就會導致角點的位置出現偏移。</div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=其他人怎麼做>其他人怎麼做？<a href=#其他人怎麼做 class=hash-link aria-label=其他人怎麼做？的直接連結 title=其他人怎麼做？的直接連結>​</a></h2>
<p>遇到這個問題後，我們開始有意識地去尋找其他人是如何解決這個問題的。</p>
<p>後來發現在該領域 (Document Localization) 的許多文獻中，解決方式就是：</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=使用大圖預測>使用大圖預測<a href=#使用大圖預測 class=hash-link aria-label=使用大圖預測的直接連結 title=使用大圖預測的直接連結>​</a></h3>
<p>這樣的做法，可以保證模型在預測時，能夠準確地找到文件的角點。</p>
<p>但是很慢，非常非常慢。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=引入錨點和偏移量>引入錨點和偏移量<a href=#引入錨點和偏移量 class=hash-link aria-label=引入錨點和偏移量的直接連結 title=引入錨點和偏移量的直接連結>​</a></h3>
<p>錨點（Anchor-Based）的做法可以參考物件偵測的領域，我們會需要一些先驗知識，用來定義 Anchor 的尺寸。但是文件出現在影像中可以是任意角度和形變，而錨點的設計會讓模型的偵測能力限縮在一定範圍內。</p>
<p>基本上，你所知道的有關錨點架構的優缺點，都可以在這裡重寫一次。</p>
<p>現實世界中的文件長寬比過於隨意，因此不適合使用錨點的設計。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=直接擬合評估數據集>直接擬合評估數據集<a href=#直接擬合評估數據集 class=hash-link aria-label=直接擬合評估數據集的直接連結 title=直接擬合評估數據集的直接連結>​</a></h3>
<p>比較早期的論文中，論述邏輯比較像是直接針對 SmartDoc 2015 設計一套算法，而不是設計一個通用的模型。</p>
<p>在近幾年的論文中，則是會將 SmartDoc 2015 自行拆分訓練集和測試集，透過這種方式來提昇對於 SmartDoc 2015 的分數。</p>
<p>所以你會在 Benchmark 的結果中看到有許多架構的分數相當不錯，但是在實際應用中，沒有足夠的泛化能力。</p>
<hr>
<p>我們發現這個領域的研究者，對於這個問題的解決方式，並沒有一個統一的看法。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=熱圖回歸模型>熱圖回歸模型<a href=#熱圖回歸模型 class=hash-link aria-label=熱圖回歸模型的直接連結 title=熱圖回歸模型的直接連結>​</a></h2>
<p><img decoding=async loading=lazy alt=arch_2.jpg src=/assets/images/hmap_model_arch-5a3b42fd4d54769ec6f331952327e323.jpg width=3277 height=1929 class=img_ev3q></p>
<p>這個模型架構沿用了原本的特徵提取器，但是修改了 Neck 和 Head 部分。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=1-特徵提取-1>1. 特徵提取<a href=#1-特徵提取-1 class=hash-link aria-label="1. 特徵提取的直接連結" title="1. 特徵提取的直接連結">​</a></h3>
<p>除了用來放在手機上的模型採用 LCNet 之外，我們還使用了一個更大的模型，用來提取更多的特徵。因為我們希望可以做出超越 SoTA 的模型，單純使用 LCNet 是不夠的。</p>
<p>在這個模型中，我們嘗試使用了 FastViT、MobileNetV2 等，還算「輕量」的卷積神經網路，特別適用於在計算資源受限的環境下進行高效的特徵提取。我們預期 Backbone 應該能從輸入數據中提取出足夠的特徵信息，為後續的熱圖回歸做好準備。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=2-bifpn>2. BiFPN<a href=#2-bifpn class=hash-link aria-label="2. BiFPN的直接連結" title="2. BiFPN的直接連結">​</a></h3>
<p>接著我們為了更好地融合多尺度的特徵，我們引入了 BiFPN (Bidirectional Feature Pyramid Network) 通過上下文信息的雙向流動，增強了特徵的表達能力。我們預期 BiFPN 會產生一系列尺度豐富且語義強的特徵圖，這些特徵圖對於捕捉不同尺度的對象非常有效，並對最終的預測精度有正面影響。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=3-heatmap-regression>3. Heatmap Regression<a href=#3-heatmap-regression class=hash-link aria-label="3. Heatmap Regression的直接連結" title="3. Heatmap Regression的直接連結">​</a></h3>
<p><img decoding=async loading=lazy alt=awing_loss.jpg src=/assets/images/awing_loss-f4531a7f843e26f0085e9962144a905d.jpg width=1224 height=912 class=img_ev3q></p>
<p>為了解決之前提到的放大誤差，我們需要對預測的結果有一定的「模糊性」。意思是：我們不能讓模型準確地指出這個文件的角點在哪裡，而是應該要讓模型說：「<strong>這個文件的角點大概在這個區域</strong>」。</p>
<p>為此，我們找來了常用於人臉關鍵點檢測或人體姿勢估計的方法：<strong>熱圖回歸</strong>。</p>
<p>熱圖回歸將生成物體的熱圖表示，這些熱圖反映了物體出現在不同位置的可能性。通過分析這些熱圖，模型能夠準確地預測出物體的位置和姿態。而在我們的情境中，熱圖則是用來找到文件的角點。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=4-adaptive-wing-loss>4. Adaptive Wing Loss<a href=#4-adaptive-wing-loss class=hash-link aria-label="4. Adaptive Wing Loss的直接連結" title="4. Adaptive Wing Loss的直接連結">​</a></h3>
<p>Loss 是模型訓練的關鍵，負責計算模型預測結果和真實標籤之間的差異。</p>
<p>在這個模型中，我們使用的是 Adaptive Wing Loss，這是一種專門用於人臉關鍵點檢測的損失函數，這種方法是針對熱圖回歸中的損失函數進行創新，特別適用於人臉對齊問題。其核心思想是讓損失函數能夠根據不同類型的真實熱圖像素調整其形狀，對前景像素（即人臉特徵點附近的像素）施加更多的懲罰，而對背景像素施加較少的懲罰。</p>
<p>在這裡，我們將文件角點預測的問題視為人臉關鍵點檢測問題，並使用專門用於人臉關鍵點檢測的損失函數。我們認為這種方法能夠有效地解決文件角點檢測中的問題，並且能夠在不同的場景中取得良好的效果。</p>
<ul>
<li><strong>Reference:</strong> <a href=https://arxiv.org/abs/1904.07399 target=_blank rel="noopener noreferrer"><strong>Adaptive Wing Loss for Robust Face Alignment via Heatmap Regression</strong></a></li>
</ul>
<p>除了角點的損失之外，我們也用了多個輔助的損失，包括：</p>
<ul>
<li><strong>Edge Loss:</strong> 這裡同時監督物體邊界訊息，使用 AWing Loss。</li>
<li><strong>Classification Loss:</strong> 這裡用於預測圖像中是否存在文件，使用 BCE Loss。</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=解決放大誤差>解決放大誤差<a href=#解決放大誤差 class=hash-link aria-label=解決放大誤差的直接連結 title=解決放大誤差的直接連結>​</a></h2>
<p>熱圖回歸模型的輸出就是一張熱圖，這張熱圖可以告訴我們文件的角點大概在哪裡。</p>
<p>接著，我們<strong>不能直接使用這張熱圖</strong>，因為這張熱圖是縮小過的，實際上應該要這樣：</p>
<ol>
<li>我們需要將這張熱圖放大至原始圖像的尺寸。</li>
<li>使用影像後處理的方式，找到每個熱圖中提示的角點區域的 Contour。</li>
<li>計算 Contour 的質心，這個質心就是文件的角點。</li>
</ol>
<p>如此一來，模型就能夠準確地找到角點，解決了之前提到的放大誤差問題。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=結論>結論<a href=#結論 class=hash-link aria-label=結論的直接連結 title=結論的直接連結>​</a></h2>
<p>你可以在熱圖模型的架構中找到一個很明顯的缺點：</p>
<ul>
<li><strong>不是端到端的模型架構</strong></li>
</ul>
<p>這也是我們在設計模型時，一直在思考的問題。我們希望能夠設計一個端到端的模型，這樣對於使用者來說更簡單，模型也可以對每個組件進行學習。但是基於點回歸模型遇到的困難，我們不得不使用熱圖回歸模型的設計方式。</p>
<p>總之，雖然不是那麼完美，但至少先解決了放大誤差問題。</p>
<p>在我們的熱圖模型實驗中，使用更大的 Backbone、更複雜的 Neck 都能提高模型的準確性。</p>
<p>在部署階段，你只需要考慮到使用場景中的算力限制，挑選合適的模型即可。</div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col></div><div class="col lastUpdated_JAkA"><span class=theme-last-updated>最後<!-- -->由 <b>zephyr-sh</b> <!-- -->於 <b><time datetime=2024-09-30T05:40:33.000Z itemprop=dateModified>2024年9月30日</time></b> <!-- -->更新</span></div></div><div style=margin-top:3rem> </div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label=文件選項卡><a class="pagination-nav__link pagination-nav__link--prev" href=/docs/docaligner/advance><div class=pagination-nav__sublabel>上一頁</div><div class=pagination-nav__label>進階設定</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/docs/docaligner/benchmark><div class=pagination-nav__sublabel>下一頁</div><div class=pagination-nav__label>評估模型</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#點回歸模型 class="table-of-contents__link toc-highlight">點回歸模型</a><ul><li><a href=#1-特徵提取 class="table-of-contents__link toc-highlight">1. 特徵提取</a><li><a href=#2-cross-attention class="table-of-contents__link toc-highlight">2. Cross-Attention</a><li><a href=#3-point-regression class="table-of-contents__link toc-highlight">3. Point Regression</a><li><a href=#4-smooth-l1-loss class="table-of-contents__link toc-highlight">4. Smooth L1 Loss</a></ul><li><a href=#災難性失敗 class="table-of-contents__link toc-highlight">災難性失敗</a><li><a href=#其他人怎麼做 class="table-of-contents__link toc-highlight">其他人怎麼做？</a><ul><li><a href=#使用大圖預測 class="table-of-contents__link toc-highlight">使用大圖預測</a><li><a href=#引入錨點和偏移量 class="table-of-contents__link toc-highlight">引入錨點和偏移量</a><li><a href=#直接擬合評估數據集 class="table-of-contents__link toc-highlight">直接擬合評估數據集</a></ul><li><a href=#熱圖回歸模型 class="table-of-contents__link toc-highlight">熱圖回歸模型</a><ul><li><a href=#1-特徵提取-1 class="table-of-contents__link toc-highlight">1. 特徵提取</a><li><a href=#2-bifpn class="table-of-contents__link toc-highlight">2. BiFPN</a><li><a href=#3-heatmap-regression class="table-of-contents__link toc-highlight">3. Heatmap Regression</a><li><a href=#4-adaptive-wing-loss class="table-of-contents__link toc-highlight">4. Adaptive Wing Loss</a></ul><li><a href=#解決放大誤差 class="table-of-contents__link toc-highlight">解決放大誤差</a><li><a href=#結論 class="table-of-contents__link toc-highlight">結論</a></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class=footer__links><a class=footer__link-item href=/docs>開源專案</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/papers/intro>論文筆記</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/blog>部落格</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/terms-of-service>使用條款</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/privacy-policy>隱私政策</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/become-an-author>成為作者</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/worklog>工作日誌</a><span class=footer__link-separator>·</span><a href=https://buymeacoffee.com/docsaid target=_blank rel="noopener noreferrer" class=footer__link-item>支持我們<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2025 DOCSAID.</div></div></div></footer></div>