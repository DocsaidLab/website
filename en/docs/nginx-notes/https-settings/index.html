<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-nginx-notes/https-settings" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>Nginx HTTPS Settings | DOCSAID</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:image content=https://docsaid.org/en/img/docsaid-social-card.jpg><meta data-rh=true name=twitter:image content=https://docsaid.org/en/img/docsaid-social-card.jpg><meta data-rh=true property=og:url content=https://docsaid.org/en/docs/nginx-notes/https-settings><meta data-rh=true property=og:locale content=en><meta data-rh=true property=og:locale:alternate content=zh_hant><meta data-rh=true property=og:locale:alternate content=ja><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Nginx HTTPS Settings | DOCSAID"><meta data-rh=true name=description content="In today's internet environment, website security has become a crucial concern, and SSL/TLS certificates are essential technologies to protect data transmission between websites and users."><meta data-rh=true property=og:description content="In today's internet environment, website security has become a crucial concern, and SSL/TLS certificates are essential technologies to protect data transmission between websites and users."><link data-rh=true rel=icon href=/en/img/favicon.ico><link data-rh=true rel=canonical href=https://docsaid.org/en/docs/nginx-notes/https-settings><link data-rh=true rel=alternate href=https://docsaid.org/docs/nginx-notes/https-settings hreflang=zh-hant><link data-rh=true rel=alternate href=https://docsaid.org/en/docs/nginx-notes/https-settings hreflang=en><link data-rh=true rel=alternate href=https://docsaid.org/ja/docs/nginx-notes/https-settings hreflang=ja><link data-rh=true rel=alternate href=https://docsaid.org/docs/nginx-notes/https-settings hreflang=x-default><link data-rh=true rel=preconnect href=https://S9NC0RYCHF-dsn.algolia.net crossorigin=anonymous><link rel=alternate type=application/rss+xml href=/en/blog/rss.xml title="DOCSAID RSS Feed"><link rel=alternate type=application/atom+xml href=/en/blog/atom.xml title="DOCSAID Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-RDF83L9R4M"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-RDF83L9R4M",{anonymize_ip:!0})</script><link rel=search type=application/opensearchdescription+xml title=DOCSAID href=/en/opensearch.xml><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css type=text/css integrity=sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM crossorigin=anonymous><link rel=stylesheet href=/en/assets/css/styles.488d6b0b.css><script src=/en/assets/js/runtime~main.412c9604.js defer></script><script src=/en/assets/js/main.7b99014c.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/en/img/docsaid_logo.png><link rel=preload as=image href=/en/img/docsaid_logo_white.png><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top navbarHideable_jvwV"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/en/><div class=navbar__logo><img src=/en/img/docsaid_logo.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/en/img/docsaid_logo_white.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/en/docs/>Projects</a><a class="navbar__item navbar__link" href=/en/papers/intro>Papers</a><a class="navbar__item navbar__link" href=/en/blog>Blog</a><a class="navbar__item navbar__link" href=/en/playground/intro>Playground</a><a class="navbar__item navbar__link" href=/en/services>Services</a><a class="navbar__item navbar__link" href=/en/aboutus>About Us</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg viewBox="0 0 24 24" width=20 height=20 aria-hidden=true class=iconLanguage_nlXk><path fill=currentColor d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>English</a><ul class=dropdown__menu><li><a href=/docs/nginx-notes/https-settings target=_self rel="noopener noreferrer" class=dropdown__link lang=zh-hant>繁體中文</a><li><a href=/en/docs/nginx-notes/https-settings target=_self rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=en>English</a><li><a href=/ja/docs/nginx-notes/https-settings target=_self rel="noopener noreferrer" class=dropdown__link lang=ja>日本語</a></ul></div><div class=navbarSearchContainer_dCNk><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div><button type=button class="ant-btn css-7ny38l ant-btn-circle ant-btn-default ant-btn-color-default ant-btn-variant-outlined ant-btn-icon-only"><span class=ant-btn-icon><span role=img aria-label=user style=font-size:18px class="anticon anticon-user"><svg viewBox="64 64 896 896" focusable=false data-icon=user width=1em height=1em fill=currentColor aria-hidden=true><path d="M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"/></svg></span></span></button></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_eExm"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex=-1 class=sidebarLogo_isFc href=/en/><img src=/en/img/docsaid_logo.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/en/img/docsaid_logo_white.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"><b></b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/en/docs/>Open Source Projects</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/model-training-guide/>Model Training Guide</a><button aria-label="Expand sidebar category 'Model Training Guide'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/autotraderx/>AutoTraderX</a><button aria-label="Expand sidebar category 'AutoTraderX'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/capybara/>Capybara</a><button aria-label="Expand sidebar category 'Capybara'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/docaligner/>DocAligner</a><button aria-label="Expand sidebar category 'DocAligner'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/docclassifier/>DocClassifier</a><button aria-label="Expand sidebar category 'DocClassifier'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/gmailsummary/>GmailSummary</a><button aria-label="Expand sidebar category 'GmailSummary'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/mrzscanner/>MRZScanner</a><button aria-label="Expand sidebar category 'MRZScanner'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/en/docs/nginx-notes/>Nginx Notes</a><button aria-label="Collapse sidebar category 'Nginx Notes'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/docs/nginx-notes/intro>Nginx Introduction</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/docs/nginx-notes/install-and-settings>Nginx Configuration</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/en/docs/nginx-notes/https-settings>Nginx HTTPS Settings</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/docs/nginx-notes/security>Nginx Security</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/docs/nginx-notes/monitoring>Nginx Monitoring</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/docs/nginx-notes/static-file-server>Nginx Serving Static Resources</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/en/docs/category/補充資料>Supplementary</a><button aria-label="Expand sidebar category 'Supplementary'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/wordcanvas/>WordCanvas</a><button aria-label="Expand sidebar category 'WordCanvas'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav><button type=button title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_kv0_><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/en/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/en/docs/nginx-notes/><span itemprop=name>Nginx Notes</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Nginx HTTPS Settings</span><meta itemprop=position content=2></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Nginx HTTPS Settings</h1></header>
<p>In today's internet environment, website security has become a crucial concern, and SSL/TLS certificates are essential technologies to protect data transmission between websites and users.</p>
<p>Let's Encrypt is a free, automated, and open Certificate Authority (CA) that provides encryption protection for millions of websites worldwide, making HTTPS more accessible.</p>
<p>Since it’s free, we definitely have to support it, right?</p>
<p>So, we’ll configure HTTPS on the Nginx server using Let's Encrypt.</p>
<p>The goals of this section include:</p>
<ul>
<li><strong>Obtain an SSL certificate</strong>: Use Let's Encrypt’s free certificate to encrypt website traffic.</li>
<li><strong>Enforce HTTPS traffic</strong>: Automatically redirect all HTTP requests to HTTPS (301 permanent redirect).</li>
<li><strong>Nginx Reverse Proxy</strong>: Ensure the front-end SSL works correctly with Nginx as a reverse proxy.</li>
<li><strong>Automatic Renewal</strong>: Set up an automatic certificate renewal mechanism to prevent certificate expiration after 90 days.</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>tip</div><div class=admonitionContent_BuS1><p>In the previous chapter, we briefly introduced the pros and cons of Let's Encrypt.<p>If you’re not familiar with it, you can first check out our supplementary document: <a href=/en/docs/nginx-notes/supplementary/about-lets-encrypt><strong>Let's Encrypt</strong></a></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=installing-lets-encrypt>Installing Let's Encrypt<a href=#installing-lets-encrypt class=hash-link aria-label="Direct link to Installing Let's Encrypt" title="Direct link to Installing Let's Encrypt">​</a></h2>
<p>We use Let's Encrypt's ACME protocol to obtain SSL certificates.</p>
<p>First, we need to install Certbot, the recommended ACME client from Let's Encrypt. Certbot automatically interacts with Let's Encrypt to request and renew certificates.</p>
<p>For Debian/Ubuntu, you can install it directly from the package repository:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo apt update</span><br></span><span class=token-line style=color:#393A34><span class="token plain">sudo apt install -y certbot python3-certbot-nginx</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This command will install Certbot along with the Nginx plugin, allowing Certbot to automatically modify Nginx configuration files to deploy the certificate.</p>
<p>Before proceeding, ensure the following preparations are complete:</p>
<ul>
<li><strong>You have a domain name</strong> and its DNS records are pointing to your server's IP address.</li>
<li><strong>You have opened ports 80 and 443 in your firewall</strong>, allowing HTTP/HTTPS traffic for verification and subsequent access.</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=requesting-a-lets-encrypt-certificate>Requesting a Let's Encrypt Certificate<a href=#requesting-a-lets-encrypt-certificate class=hash-link aria-label="Direct link to Requesting a Let's Encrypt Certificate" title="Direct link to Requesting a Let's Encrypt Certificate">​</a></h2>
<p>With Certbot, we can request a certificate from Let's Encrypt.</p>
<p>Let's Encrypt uses an automated ACME validation mechanism, requiring you to prove control over the domain. A common validation method is HTTP validation (Certbot will place a temporary file on your site for Let's Encrypt to validate) or DNS validation (more complex, used for wildcard certificate requests).</p>
<p>Here, we'll use simple HTTP validation and let the Nginx plugin configure it automatically:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"># Stop Nginx (may be required in webroot mode, but not needed with --nginx plugin)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># sudo systemctl stop nginx</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># Run Certbot with the Nginx plugin to request a certificate</span><br></span><span class=token-line style=color:#393A34><span class="token plain">sudo certbot --nginx -d your-domain.com -d www.your-domain.com</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Replace <code>your-domain.com</code> and <code>www.your-domain.com</code> with your actual domain name.</p>
<p>Once executed, Certbot will communicate with the Let's Encrypt server:</p>
<ul>
<li><strong>Domain Validation</strong>: Certbot might temporarily modify the Nginx configuration or start a temporary service to respond to Let's Encrypt’s validation request. For example, Let's Encrypt will attempt to access a validation file via <code>http://your-domain.com/.well-known/acme-challenge/</code>. If the validation is successful, it confirms you control the domain.</li>
<li><strong>Obtain Certificate</strong>: Once validated, Let's Encrypt will issue an SSL certificate (including the full certificate chain <code>fullchain.pem</code> and the private key file <code>privkey.pem</code>). Certbot will store these files in the default path (usually <code>/etc/letsencrypt/live/your-domain.com/</code>).</li>
</ul>
<p>During the process, Certbot might ask:</p>
<ul>
<li>Whether you agree to the terms of service and provide an email address (for renewal notifications).</li>
<li>Whether to automatically redirect HTTP traffic to HTTPS. <strong>It’s recommended to choose redirect</strong> so Certbot can automatically set up the 301 redirect rule for you to ensure users access the site via HTTPS.</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>tip</div><div class=admonitionContent_BuS1><p>If you're not using the <code>--nginx</code> plugin, you can also use the <code>certbot certonly --webroot</code> mode to manually obtain the certificate and then edit the Nginx configuration yourself. Using <code>--nginx</code> saves you from having to manually configure the settings.</div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=configuring-nginx-to-enable-https>Configuring Nginx to Enable HTTPS<a href=#configuring-nginx-to-enable-https class=hash-link aria-label="Direct link to Configuring Nginx to Enable HTTPS" title="Direct link to Configuring Nginx to Enable HTTPS">​</a></h2>
<p>Once the certificate has been issued, we need to enable HTTPS (SSL) in Nginx and load the certificate we just obtained.</p>
<p>Here’s an example configuration (assuming the default installation path for Certbot):</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"># In Nginx's configuration file (e.g., /etc/nginx/sites-available/your-domain.conf):</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># HTTP service on port 80, redirect all requests to HTTPS</span><br></span><span class=token-line style=color:#393A34><span class="token plain">server {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen 80;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen [::]:80;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    server_name your-domain.com www.your-domain.com;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Redirect HTTP requests permanently to HTTPS</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    return 301 https://$host$request_uri;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># HTTPS service on port 443</span><br></span><span class=token-line style=color:#393A34><span class="token plain">server {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen 443 ssl http2;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen [::]:443 ssl http2;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    server_name your-domain.com www.your-domain.com;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # SSL certificate file paths (issued by Certbot)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ssl_certificate      /etc/letsencrypt/live/your-domain.com/fullchain.pem;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ssl_certificate_key  /etc/letsencrypt/live/your-domain.com/privkey.pem;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # (Reverse proxy configuration example)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    location / {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        proxy_pass http://127.0.0.1:8000;  # Forward requests to the backend application (e.g., FastAPI running on port 8000)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        proxy_http_version 1.1;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        proxy_set_header Host $host;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        proxy_set_header X-Forwarded-Proto $scheme;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        proxy_intercept_errors on;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Explanation of each part:</p>
<ul>
<li>
<p><strong>HTTP service on port 80 (force redirect to HTTPS)</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">server {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen 80;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen [::]:80;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    server_name your-domain.com www.your-domain.com;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Redirect HTTP requests permanently to HTTPS</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    return 301 https://$host$request_uri;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Purpose of this block:</strong></p>
<ol>
<li>
<p><strong>Listen on HTTP (port 80)</strong></p>
<ul>
<li><code>listen 80;</code> : Nginx listens for IPv4 connections on port 80 (standard HTTP connection).</li>
<li><code>listen [::]:80;</code> : Allows IPv6 connections.</li>
</ul>
</li>
<li>
<p><strong>Set <code>server_name</code></strong></p>
<ul>
<li><code>server_name your-domain.com www.your-domain.com;</code></li>
<li>This tells Nginx that this configuration applies to <code>your-domain.com</code> and <code>www.your-domain.com</code>.</li>
<li>Ensures that both the <code>www</code> and non-<code>www</code> versions of the domain are correctly handled.</li>
</ul>
</li>
<li>
<p><strong>Force HTTP to HTTPS redirection</strong></p>
<ul>
<li><code>return 301 https://$host$request_uri;</code></li>
<li>This will redirect all HTTP requests to HTTPS using a 301 permanent redirect.</li>
<li><code>$host</code> represents the requested host (<code>your-domain.com</code> or <code>www.your-domain.com</code>).</li>
<li><code>$request_uri</code> represents the full URI of the request (e.g., <code>/about</code>).</li>
</ul>
</li>
</ol>
</li>
</ul>
<hr>
<ul>
<li>
<p><strong>HTTPS service on port 443</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">server {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen 443 ssl http2;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen [::]:443 ssl http2;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    server_name your-domain.com www.your-domain.com;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Purpose of this block:</strong></p>
<ol>
<li>
<p><strong>Listen on HTTPS (port 443)</strong></p>
<ul>
<li><code>listen 443 ssl http2;</code></li>
<li><code>ssl</code> : Enable SSL encryption.</li>
<li><code>http2</code> : Enable HTTP/2 for improved performance (reduces connection latency).</li>
<li><code>listen [::]:443 ssl http2;</code> : Allows IPv6 connections using HTTPS.</li>
</ul>
</li>
<li>
<p><strong>Set <code>server_name</code></strong></p>
<ul>
<li>Same as the HTTP configuration, it applies to <code>your-domain.com</code> and <code>www.your-domain.com</code>.</li>
</ul>
</li>
</ol>
</li>
</ul>
<hr>
<ul>
<li>
<p><strong>SSL certificate configuration</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">    # SSL certificate file paths (issued by Certbot)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ssl_certificate      /etc/letsencrypt/live/your-domain.com/fullchain.pem;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ssl_certificate_key  /etc/letsencrypt/live/your-domain.com/privkey.pem;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Purpose of this block:</strong></p>
<ul>
<li>These are the certificate paths automatically generated by <strong>Let’s Encrypt</strong>:<!-- -->
<ul>
<li><code>fullchain.pem</code> : The full certificate (including the intermediate CA certificates).</li>
<li><code>privkey.pem</code> : The private key used for SSL encryption.</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>
<p><strong>Reverse proxy to FastAPI</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">    location / {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        proxy_pass http://127.0.0.1:8000;  # Forward requests to the backend application (FastAPI)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        proxy_http_version 1.1;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        proxy_set_header Host $host;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        proxy_set_header X-Forwarded-Proto $scheme;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        # Let Nginx handle errors returned by FastAPI</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        proxy_intercept_errors on;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>Purpose of this block:</strong></p>
<ul>
<li>
<p><code>proxy_pass http://127.0.0.1:8000;</code></p>
<ul>
<li>Assumes that FastAPI is running on <code>127.0.0.1:8000</code> (command: <code>uvicorn --host 127.0.0.1 --port 8000</code>).</li>
<li>Forwards API requests to the FastAPI application running on the local server.</li>
</ul>
</li>
<li>
<p><strong>Proxy headers</strong></p>
<ul>
<li><code>proxy_set_header Host $host;</code> : Passes the original <code>Host</code> header.</li>
<li><code>proxy_set_header X-Real-IP $remote_addr;</code> : Passes the real client IP to the backend.</li>
<li><code>proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</code> : Records the entire proxy chain.</li>
<li><code>proxy_set_header X-Forwarded-Proto $scheme;</code> : Ensures the backend knows whether the original request was HTTP or HTTPS.</li>
</ul>
</li>
<li>
<p><strong>Error handling</strong></p>
<ul>
<li><code>proxy_intercept_errors on;</code>
<ul>
<li>Allows Nginx to intercept errors returned by the backend (e.g., 502, 503).</li>
<li>Custom error pages can be specified with <code>error_page</code>.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<p>After completing the configuration, reload Nginx to apply the changes:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo nginx -t  # Test Nginx configuration syntax for correctness</span><br></span><span class=token-line style=color:#393A34><span class="token plain">sudo systemctl reload nginx  # Apply configuration changes and reload the service</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=nginx-reverse-proxy-and-backend-services>Nginx Reverse Proxy and Backend Services<a href=#nginx-reverse-proxy-and-backend-services class=hash-link aria-label="Direct link to Nginx Reverse Proxy and Backend Services" title="Direct link to Nginx Reverse Proxy and Backend Services">​</a></h2>
<p>In the architecture described above, Nginx serves as both the HTTPS endpoint and reverse proxy.</p>
<p>Nginx handles the TLS handshake and encryption/decryption, meaning the SSL termination occurs at the Nginx layer. The backend application only needs to handle HTTP requests from Nginx, without needing to support HTTPS. Internal communication within the server remains lightweight, without the additional burden of encryption.</p>
<p>This setup simplifies the backend application's configuration and reduces the maintenance overhead related to HTTPS.</p>
<p>Additionally, when using Nginx as a reverse proxy, the backend application by default cannot directly access the client’s real IP address. Instead, it will only see Nginx's IP.</p>
<p>To resolve this, we need to pass important HTTP headers to the backend application via <code>proxy_set_header</code> to ensure the backend correctly identifies client information.</p>
<p>Key headers include:</p>
<ul>
<li><strong><code>X-Forwarded-For</code></strong> → Passes the original client’s IP address.</li>
<li><strong><code>Host</code></strong> → Retains the original host name of the request.</li>
<li><strong><code>X-Forwarded-Proto</code></strong> → Indicates the protocol used in the original request (<code>http</code> or <code>https</code>).</li>
</ul>
<p>Nginx configuration:</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">proxy_set_header Host $host;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">proxy_set_header X-Forwarded-Proto $scheme;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Assuming our backend is a Python-based FastAPI application, by default FastAPI will not parse the proxy-passed headers. Therefore, we need to enable the <code>proxy-headers</code> mode to correctly identify headers like <code>X-Forwarded-For</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">uvicorn app:app --host 127.0.0.1 --port 8000 --proxy-headers</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Alternatively, inside FastAPI, we can use <code>StarletteMiddleware.ProxyHeaders</code>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> fastapi </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> FastAPI</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> starlette</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">middleware</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">trustedhost </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> TrustedHostMiddleware</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> starlette</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">middleware</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">proxy_headers </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> ProxyHeadersMiddleware</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">app </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> FastAPI</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># Enable proxy header parsing</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">app</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">add_middleware</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">ProxyHeadersMiddleware</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">app</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">add_middleware</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">TrustedHostMiddleware</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> allowed_hosts</span><span class="token operator" style=color:#393A34>=</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>"*"</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>With this configuration, the backend application can correctly obtain the client’s real IP, request protocol, and other information, preventing misidentification.</p>
<p>Finally, to ensure security, FastAPI should only listen on the local interface to prevent direct external access to the HTTP service, reducing the risk of unauthorized access.</p>
<p>Best practice is:</p>
<ul>
<li>
<p><strong>FastAPI should listen on the local interface</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">uvicorn app:app --host 127.0.0.1 --port 8000</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Nginx <code>proxy_pass</code> should point to the local port</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">location / {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    proxy_pass http://127.0.0.1:8000;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ul>
<p>This way, external users cannot directly access the backend FastAPI application; they can only access it through Nginx as a proxy, enhancing security. Internal traffic remains unencrypted over HTTP, minimizing the additional burden of HTTPS and improving performance.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=configuring-automatic-certificate-renewal>Configuring Automatic Certificate Renewal<a href=#configuring-automatic-certificate-renewal class=hash-link aria-label="Direct link to Configuring Automatic Certificate Renewal" title="Direct link to Configuring Automatic Certificate Renewal">​</a></h2>
<p>Let's Encrypt certificates are only valid for 90 days. This short validity period is designed to enhance security and encourage website administrators to implement automated renewal mechanisms. Manual renewal might lead to certificate expiration, disrupting HTTPS connections on the site. Therefore, it’s recommended to use Certbot's automatic renewal feature to ensure the certificate remains valid at all times.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=certbots-automatic-renewal-mechanism>Certbot's Automatic Renewal Mechanism<a href=#certbots-automatic-renewal-mechanism class=hash-link aria-label="Direct link to Certbot's Automatic Renewal Mechanism" title="Direct link to Certbot's Automatic Renewal Mechanism">​</a></h3>
<p>Certbot uses different methods for automatic renewal depending on the system's initialization system (init system):</p>
<p>For systemd-based systems (most modern Linux distributions), Certbot uses a systemd timer to manage renewals, rather than a cron job.</p>
<p>You can check if the systemd timer is enabled:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">systemctl list-timers | grep certbot</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>If enabled, you should see something like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">certbot.timer               2025-02-13 02:00:00 UTC   12h left</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>You can also manually check the status of the systemd timer:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">systemctl status certbot.timer</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>systemd runs the renewal check twice a day via the <code>certbot.timer</code>. The actual renewal only occurs if the certificate is within <strong>30 days of expiry</strong>.</p>
<hr>
<p>For non-systemd systems, Certbot uses a cron job, typically located at <code>/etc/cron.d/certbot</code>.</p>
<p>The cron job might look like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">0 */12 * * * root test -x /usr/bin/certbot -a \! -d /run/systemd/system && perl -e 'sleep int(rand(43200))' && certbot -q renew --no-random-sleep-on-renew</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This means it runs every 12 hours. If the system is using systemd, the cron job will not be executed.</p>
<p>To avoid multiple renewals occurring simultaneously on the server, the cron job introduces a random delay of up to 12 hours.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=verifying-automatic-renewal>Verifying Automatic Renewal<a href=#verifying-automatic-renewal class=hash-link aria-label="Direct link to Verifying Automatic Renewal" title="Direct link to Verifying Automatic Renewal">​</a></h3>
<p>Whether using <strong>systemd timer</strong> or <strong>cron</strong>, you can manually test the renewal mechanism:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo certbot renew --dry-run</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>If there are no errors in the output, it means the automatic renewal mechanism is functioning correctly.</p>
<p>You can also check the installed certificates:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo certbot certificates</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This will list the expiration dates and file paths of all certificates, ensuring they are not expired.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=ensuring-the-new-certificate-takes-effect-after-renewal>Ensuring the New Certificate Takes Effect After Renewal<a href=#ensuring-the-new-certificate-takes-effect-after-renewal class=hash-link aria-label="Direct link to Ensuring the New Certificate Takes Effect After Renewal" title="Direct link to Ensuring the New Certificate Takes Effect After Renewal">​</a></h3>
<p>After Let's Encrypt renews a certificate, Nginx/Apache will still use the old certificate until it's reloaded.</p>
<p>To ensure the new certificate is loaded, you can use the following command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo systemctl reload nginx  # or systemctl reload apache2</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>You can also add a <code>--post-hook "systemctl reload nginx"</code> to the <code>certbot renew</code> command, so that Certbot automatically reloads the server after a successful renewal.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=verifying-successful-renewal-of-the-certificate>Verifying Successful Renewal of the Certificate<a href=#verifying-successful-renewal-of-the-certificate class=hash-link aria-label="Direct link to Verifying Successful Renewal of the Certificate" title="Direct link to Verifying Successful Renewal of the Certificate">​</a></h3>
<p>To check the current certificate expiration date:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo certbot certificates</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This will list all certificates managed by Certbot, including the expiration date and storage location. Make sure that after renewal, the expiration date has been updated.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=testing-and-verifying-https-configuration>Testing and Verifying HTTPS Configuration<a href=#testing-and-verifying-https-configuration class=hash-link aria-label="Direct link to Testing and Verifying HTTPS Configuration" title="Direct link to Testing and Verifying HTTPS Configuration">​</a></h2>
<p>After completing the HTTPS setup, perform the following tests to ensure everything is working correctly and meets security standards:</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=browser-test>Browser Test<a href=#browser-test class=hash-link aria-label="Direct link to Browser Test" title="Direct link to Browser Test">​</a></h3>
<p>Go to <code>https://your-domain.com</code> in your browser, ensuring that the secure lock icon 🔒 appears. Click on the certificate information to verify that the issuer is <strong>Let's Encrypt</strong> and that the certificate is valid and matches the domain.</p>
<p>Try accessing <code>http://your-domain.com</code>; it should automatically redirect to HTTPS.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=checking-http-to-https-redirection>Checking HTTP to HTTPS Redirection<a href=#checking-http-to-https-redirection class=hash-link aria-label="Direct link to Checking HTTP to HTTPS Redirection" title="Direct link to Checking HTTP to HTTPS Redirection">​</a></h3>
<p>Use <code>curl</code> to test:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">curl -I http://your-domain.com</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Ensure that it returns a <code>301 Moved Permanently</code> response, and the <code>Location</code> header should point to <code>https://your-domain.com/...</code>.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=ensuring-the-website-functions-correctly>Ensuring the Website Functions Correctly<a href=#ensuring-the-website-functions-correctly class=hash-link aria-label="Direct link to Ensuring the Website Functions Correctly" title="Direct link to Ensuring the Website Functions Correctly">​</a></h3>
<p>Check that the backend API/website works as expected, such as:</p>
<ul>
<li>Does the FastAPI API respond correctly?</li>
<li>Are internal HTTPS links on the website working?</li>
<li>Have you taken <code>X-Forwarded-Proto</code> into account for handling HTTPS redirects?</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=checking-nginx-logs>Checking Nginx Logs<a href=#checking-nginx-logs class=hash-link aria-label="Direct link to Checking Nginx Logs" title="Direct link to Checking Nginx Logs">​</a></h3>
<p>Review error and access logs to ensure there are no abnormalities:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo tail -f /var/log/nginx/access.log</span><br></span><span class=token-line style=color:#393A34><span class="token plain">sudo tail -f /var/log/nginx/error.log</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>If you encounter TLS connection errors, it may be due to outdated devices not supporting <strong>TLS 1.2</strong>. Adjust settings accordingly if necessary.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=conclusion>Conclusion<a href=#conclusion class=hash-link aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>We've accomplished a lot.</p>
<p>In this chapter, we successfully enabled HTTPS for Nginx, ensuring that all traffic is encrypted using a certificate issued by Let's Encrypt. We also forced HTTP traffic to be redirected to HTTPS, providing a more secure connection environment.</p>
<p>In addition to the basic HTTPS deployment, we used Nginx as a reverse proxy for FastAPI, ensuring that the front-end Nginx securely forwards requests to the backend service while preserving original request information such as client IP and protocol (HTTP/HTTPS). This ensures the integrity and traceability of the backend application.</p>
<p>Finally, we implemented an automatic certificate renewal mechanism, ensuring that Let's Encrypt certificates are updated automatically and take effect after renewal, keeping the website's HTTPS connection active at all times.</p>
<p>So, are the website's security standards complete?</p>
<p>Not quite yet. In the next chapter, we will explore advanced security configurations, such as HSTS, CSP headers, and how to prevent common website attacks.</div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col></div><div class="col lastUpdated_JAkA"><span class=theme-last-updated>Last updated<!-- --> on <b><time datetime=2025-02-28T01:10:00.000Z itemprop=dateModified>Feb 28, 2025</time></b> by <b>zephyr-sh</b></span></div></div><div style=margin-top:3rem> </div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/en/docs/nginx-notes/install-and-settings><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Nginx Configuration</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/en/docs/nginx-notes/security><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Nginx Security</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#installing-lets-encrypt class="table-of-contents__link toc-highlight">Installing Let's Encrypt</a><li><a href=#requesting-a-lets-encrypt-certificate class="table-of-contents__link toc-highlight">Requesting a Let's Encrypt Certificate</a><li><a href=#configuring-nginx-to-enable-https class="table-of-contents__link toc-highlight">Configuring Nginx to Enable HTTPS</a><li><a href=#nginx-reverse-proxy-and-backend-services class="table-of-contents__link toc-highlight">Nginx Reverse Proxy and Backend Services</a><li><a href=#configuring-automatic-certificate-renewal class="table-of-contents__link toc-highlight">Configuring Automatic Certificate Renewal</a><ul><li><a href=#certbots-automatic-renewal-mechanism class="table-of-contents__link toc-highlight">Certbot's Automatic Renewal Mechanism</a><li><a href=#verifying-automatic-renewal class="table-of-contents__link toc-highlight">Verifying Automatic Renewal</a><li><a href=#ensuring-the-new-certificate-takes-effect-after-renewal class="table-of-contents__link toc-highlight">Ensuring the New Certificate Takes Effect After Renewal</a><li><a href=#verifying-successful-renewal-of-the-certificate class="table-of-contents__link toc-highlight">Verifying Successful Renewal of the Certificate</a></ul><li><a href=#testing-and-verifying-https-configuration class="table-of-contents__link toc-highlight">Testing and Verifying HTTPS Configuration</a><ul><li><a href=#browser-test class="table-of-contents__link toc-highlight">Browser Test</a><li><a href=#checking-http-to-https-redirection class="table-of-contents__link toc-highlight">Checking HTTP to HTTPS Redirection</a><li><a href=#ensuring-the-website-functions-correctly class="table-of-contents__link toc-highlight">Ensuring the Website Functions Correctly</a><li><a href=#checking-nginx-logs class="table-of-contents__link toc-highlight">Checking Nginx Logs</a></ul><li><a href=#conclusion class="table-of-contents__link toc-highlight">Conclusion</a></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class=footer__links><a class=footer__link-item href=/en/docs>Projects</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/papers/intro>Papers</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/blog>Blog</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/terms-of-service>TermsOfUse</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/privacy-policy>Privacy Policy</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/become-an-author>Become an author</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/worklog>Worklog</a></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2024 DOCSAID.</div></div></div></footer></div>