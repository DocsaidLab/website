<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-nginx-notes/security" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>Nginx Security | DOCSAID</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:image content=https://docsaid.org/en/img/docsaid-social-card.jpg><meta data-rh=true name=twitter:image content=https://docsaid.org/en/img/docsaid-social-card.jpg><meta data-rh=true property=og:url content=https://docsaid.org/en/docs/nginx-notes/security><meta data-rh=true property=og:locale content=en><meta data-rh=true property=og:locale:alternate content=zh_hant><meta data-rh=true property=og:locale:alternate content=ja><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Nginx Security | DOCSAID"><meta data-rh=true name=description content="Due to its flexibility and efficiency, Nginx is widely used in modern network environments. However, without proper security configurations, your well-set-up website could become a target for attackers."><meta data-rh=true property=og:description content="Due to its flexibility and efficiency, Nginx is widely used in modern network environments. However, without proper security configurations, your well-set-up website could become a target for attackers."><link data-rh=true rel=icon href=/en/img/favicon.ico><link data-rh=true rel=canonical href=https://docsaid.org/en/docs/nginx-notes/security><link data-rh=true rel=alternate href=https://docsaid.org/docs/nginx-notes/security hreflang=zh-hant><link data-rh=true rel=alternate href=https://docsaid.org/en/docs/nginx-notes/security hreflang=en><link data-rh=true rel=alternate href=https://docsaid.org/ja/docs/nginx-notes/security hreflang=ja><link data-rh=true rel=alternate href=https://docsaid.org/docs/nginx-notes/security hreflang=x-default><link data-rh=true rel=preconnect href=https://S9NC0RYCHF-dsn.algolia.net crossorigin=anonymous><link rel=alternate type=application/rss+xml href=/en/blog/rss.xml title="DOCSAID RSS Feed"><link rel=alternate type=application/atom+xml href=/en/blog/atom.xml title="DOCSAID Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-RDF83L9R4M"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-RDF83L9R4M",{anonymize_ip:!0})</script><link rel=search type=application/opensearchdescription+xml title=DOCSAID href=/en/opensearch.xml><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css type=text/css integrity=sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM crossorigin=anonymous><link rel=stylesheet href=/en/assets/css/styles.488d6b0b.css><script src=/en/assets/js/runtime~main.a3456d20.js defer></script><script src=/en/assets/js/main.dd1041b0.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/en/img/docsaid_logo.png><link rel=preload as=image href=/en/img/docsaid_logo_white.png><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top navbarHideable_jvwV"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/en/><div class=navbar__logo><img src=/en/img/docsaid_logo.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/en/img/docsaid_logo_white.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/en/docs/>Projects</a><a class="navbar__item navbar__link" href=/en/papers/intro>Papers</a><a class="navbar__item navbar__link" href=/en/blog>Blog</a><a class="navbar__item navbar__link" href=/en/playground/intro>Playground</a><a class="navbar__item navbar__link" href=/en/services>Services</a><a class="navbar__item navbar__link" href=/en/aboutus>About Us</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg viewBox="0 0 24 24" width=20 height=20 aria-hidden=true class=iconLanguage_nlXk><path fill=currentColor d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>English</a><ul class=dropdown__menu><li><a href=/docs/nginx-notes/security target=_self rel="noopener noreferrer" class=dropdown__link lang=zh-hant>繁體中文</a><li><a href=/en/docs/nginx-notes/security target=_self rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=en>English</a><li><a href=/ja/docs/nginx-notes/security target=_self rel="noopener noreferrer" class=dropdown__link lang=ja>日本語</a></ul></div><div class=navbarSearchContainer_dCNk><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div><button type=button class="ant-btn css-7ny38l ant-btn-circle ant-btn-default ant-btn-color-default ant-btn-variant-outlined ant-btn-icon-only"><span class=ant-btn-icon><span role=img aria-label=user style=font-size:18px class="anticon anticon-user"><svg viewBox="64 64 896 896" focusable=false data-icon=user width=1em height=1em fill=currentColor aria-hidden=true><path d="M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"/></svg></span></span></button></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_eExm"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex=-1 class=sidebarLogo_isFc href=/en/><img src=/en/img/docsaid_logo.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/en/img/docsaid_logo_white.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"><b></b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/en/docs/>Open Source Projects</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/model-training-guide/>Model Training Guide</a><button aria-label="Expand sidebar category 'Model Training Guide'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/autotraderx/>AutoTraderX</a><button aria-label="Expand sidebar category 'AutoTraderX'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/capybara/>Capybara</a><button aria-label="Expand sidebar category 'Capybara'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/docaligner/>DocAligner</a><button aria-label="Expand sidebar category 'DocAligner'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/docclassifier/>DocClassifier</a><button aria-label="Expand sidebar category 'DocClassifier'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/gmailsummary/>GmailSummary</a><button aria-label="Expand sidebar category 'GmailSummary'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/mrzscanner/>MRZScanner</a><button aria-label="Expand sidebar category 'MRZScanner'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/en/docs/nginx-notes/>Nginx Notes</a><button aria-label="Collapse sidebar category 'Nginx Notes'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/docs/nginx-notes/intro>Nginx Introduction</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/docs/nginx-notes/install-and-settings>Nginx Configuration</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/docs/nginx-notes/https-settings>Nginx HTTPS Settings</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/en/docs/nginx-notes/security>Nginx Security</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/docs/nginx-notes/monitoring>Nginx Monitoring</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/docs/nginx-notes/static-file-server>Nginx Serving Static Resources</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/en/docs/category/補充資料>Supplementary</a><button aria-label="Expand sidebar category 'Supplementary'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/wordcanvas/>WordCanvas</a><button aria-label="Expand sidebar category 'WordCanvas'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav><button type=button title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_kv0_><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/en/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/en/docs/nginx-notes/><span itemprop=name>Nginx Notes</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Nginx Security</span><meta itemprop=position content=2></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Nginx Security</h1></header>
<p>Due to its flexibility and efficiency, Nginx is widely used in modern network environments. However, without proper security configurations, your well-set-up website could become a target for attackers.</p>
<p>Key security risks include:</p>
<ul>
<li><strong>Unhardened TLS configurations</strong>: Could lead to man-in-the-middle attacks and weak encryption vulnerabilities.</li>
<li><strong>Lack of HSTS mechanism</strong>: Could lead to users accidentally accessing the site via HTTP, reducing the security of HTTPS.</li>
<li><strong>Improperly configured HTTP security headers</strong>: Could make the website vulnerable to XSS, clickjacking, and other attacks.</li>
<li><strong>Lack of traffic limiting and DDoS protection</strong>: Could lead to server resource misuse, even causing service disruption.</li>
</ul>
<p>To ensure the security of the Nginx server, we must implement a series of hardening measures in the configuration.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=tls-security-hardening>TLS Security Hardening<a href=#tls-security-hardening class=hash-link aria-label="Direct link to TLS Security Hardening" title="Direct link to TLS Security Hardening">​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>tip</div><div class=admonitionContent_BuS1><p>The configurations for this section are within the <code>http</code> block, as TLS is a security extension based on the HTTP protocol. Therefore, these settings should be written in the main configuration file <code>/etc/nginx/nginx.conf</code>.</div></div>
<p>TLS, or Transport Layer Security, is a cryptographic protocol used to ensure the security of network communications.</p>
<p>In modern network environments, HTTPS encryption has become the standard for websites, and TLS is the core technology behind HTTPS. While HTTPS encrypts the traffic between the website and visitors, many unoptimized TLS configurations still have vulnerabilities, such as:</p>
<ul>
<li><strong>Using outdated TLS protocols (e.g., TLS 1.0/1.1)</strong> → Susceptible to attacks like BEAST and POODLE.</li>
<li><strong>Allowing weak encryption algorithms (e.g., RC4, 3DES)</strong> → Vulnerable to cracking.</li>
<li><strong>Lack of OCSP Stapling</strong> → Leads to performance degradation during certificate verification.</li>
<li><strong>Enabling Session Tickets</strong> → May allow attackers to reuse old encryption keys, leading to replay attacks.</li>
</ul>
<p>To ensure website security, we must properly configure Nginx and strengthen the TLS settings to prevent potential security risks such as man-in-the-middle (MITM) attacks, certificate forgery, and weak encryption attacks.</p>
<p>Here are several optimizations to consider:</p>
<ol>
<li>
<p><strong>Disable older TLS versions, allow only TLS 1.2 / 1.3</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">ssl_protocols TLSv1.2 TLSv1.3;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ul>
<li><strong>TLS 1.0 / 1.1 are no longer secure</strong> and are no longer supported by many browsers (like Chrome and Firefox).</li>
<li><strong>TLS 1.2 is still secure and widely supported</strong>.</li>
<li><strong>TLS 1.3 offers better performance and security</strong>, with support for "zero-latency handshakes," making it ideal for modern applications.</li>
</ul>
</li>
</ol>
<hr>
<ol start=2>
<li>
<p><strong>Use secure encryption algorithms</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384';</span><br></span><span class=token-line style=color:#393A34><span class="token plain">ssl_prefer_server_ciphers on;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>These cipher suites <strong>exclude weak encryption algorithms like RC4, 3DES, MD5</strong>, and ensure the server prefers its own secure cipher combinations.</p>
</li>
</ol>
<hr>
<ol start=3>
<li>
<p><strong>Enable OCSP Stapling to improve certificate validation speed</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">ssl_stapling on;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">ssl_stapling_verify on;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">resolver 8.8.8.8 1.1.1.1 valid=300s;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">resolver_timeout 5s;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>OCSP Stapling allows the server to cache the certificate status in advance, reducing the delay of querying the CA server every time a connection is made and improving performance.</p>
</li>
</ol>
<hr>
<ol start=4>
<li>
<p><strong>Disable Session Tickets to prevent key reuse</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">ssl_session_tickets off;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Session Tickets may lead to the reuse of keys, allowing attackers to steal tickets and reuse encrypted sessions.</p>
</li>
</ol>
<hr>
<ol start=5>
<li>
<p><strong>Set secure DH parameters</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">ssl_dhparam /etc/nginx/ssl/dhparam.pem;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Diffie-Hellman (DH) key exchange provides additional security, preventing certain types of attacks.</p>
<p>If no DH parameter file is available, you can generate it with OpenSSL:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo mkdir -p /etc/nginx/ssl</span><br></span><span class=token-line style=color:#393A34><span class="token plain">sudo openssl dhparam -out /etc/nginx/ssl/dhparam.pem 2048</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
</ol>
<hr>
<ol start=6>
<li>
<p><strong>Enable session caching to improve TLS connection performance</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">ssl_session_cache shared:SSL:10m;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">ssl_session_timeout 1h;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ul>
<li><strong>Allow TLS session reuse to enhance performance</strong>.</li>
<li><strong>Reduce CPU load and improve user experience</strong>.</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=advanced-hsts-configuration>Advanced HSTS Configuration<a href=#advanced-hsts-configuration class=hash-link aria-label="Direct link to Advanced HSTS Configuration" title="Direct link to Advanced HSTS Configuration">​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>tip</div><div class=admonitionContent_BuS1><p>This configuration should be placed in the <code>server</code> block, as HSTS is a security mechanism specific to individual websites. Therefore, the settings below should be written in the website configuration files, such as <code>/etc/nginx/sites-available/example.com</code>.</div></div>
<p>HSTS, or HTTP Strict Transport Security, is a security mechanism that forces browsers to only access websites over HTTPS.</p>
<p>While HTTPS has become the standard for website configurations, HTTPS alone cannot prevent downgrade attacks (Downgrade Attack) or man-in-the-middle attacks (MITM Attack). This is where HSTS becomes a key mechanism—it ensures that users are automatically redirected to HTTPS every time they connect, preventing the website from being exposed to insecure HTTP connections.</p>
<p>HSTS is defined by the <strong>RFC 6797</strong> standard and its core functions are:</p>
<ul>
<li><strong>Force the website to be accessed only via HTTPS</strong></li>
<li><strong>Prevent downgrade attacks (Downgrade Attack)</strong></li>
<li><strong>Block SSL stripping attacks (SSL Stripping Attack)</strong></li>
<li><strong>Improve website trustworthiness and SEO ranking</strong></li>
</ul>
<p>For example: if a website supports HTTPS but doesn't have HSTS enabled, attackers can perform a man-in-the-middle attack by tampering with the initial HTTP connection, forcing users to downgrade to HTTP, and intercepting all data traffic. At this point, all sensitive data such as login credentials and credit card information can be stolen, exposing users' privacy to risk.</p>
<p>Once HSTS is enabled:</p>
<ol>
<li>The browser will remember that the website only allows HTTPS connections after the first successful connection.</li>
<li>For all future connections, the browser will directly switch to HTTPS, even if the user types <code>http://example.com</code>, it will automatically be redirected to <code>https://example.com</code>.</li>
<li>Even if an attacker intercepts the initial HTTP connection, they won't be able to downgrade the website to HTTP.</li>
</ol>
<p>In Nginx, HSTS must only be applied to HTTPS servers, so it should be placed within the <code>server</code> block.</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">server {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen 443 ssl http2;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    server_name example.com www.example.com;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Enable HSTS and apply to all subdomains</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ul>
<li>
<p>The meanings of each parameter are as follows:</p>
<ul>
<li><code>max-age=31536000</code>: The duration of the HSTS setting (in seconds), here set to 1 year.</li>
<li><code>includeSubDomains</code>: Enforces HSTS for all subdomains, preventing subdomains from being exploited by attackers.</li>
<li><code>preload</code>: Allows the website to be added to the browser's HSTS preload list.</li>
<li><code>always</code>: Ensures Nginx adds the HSTS header to all responses, including error pages.</li>
</ul>
</li>
</ul>
<hr>
<p>When configuring, HSTS must only be enabled for HTTPS to ensure that HTTP connections are redirected with a 301 redirect to HTTPS, without including the HSTS header. Therefore, the following configuration should be added to the HTTP server:</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">server {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen 80;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    server_name example.com www.example.com;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Redirect to HTTPS but do not include the HSTS header</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    return 301 https://$host$request_uri;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This setup prevents attackers from exploiting the initial HTTP connection to bypass HSTS and ensures the browser records it correctly.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=other-security-headers>Other Security Headers<a href=#other-security-headers class=hash-link aria-label="Direct link to Other Security Headers" title="Direct link to Other Security Headers">​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>tip</div><div class=admonitionContent_BuS1><p>Since this is still related to headers, the following configurations should also be written in website configuration files such as <code>/etc/nginx/sites-available/example.com</code>.</div></div>
<p>When we talk about website security, most people first think of HTTPS encryption and firewalls, but these only address security at the transport layer.</p>
<p>In reality, many web attacks (such as XSS, clickjacking, MIME sniffing) are executed through browser vulnerabilities, and correctly configuring HTTP security headers is one of the best ways to prevent such attacks.</p>
<p>HTTP security headers can effectively defend against:</p>
<ul>
<li><strong>XSS (Cross-Site Scripting)</strong></li>
<li><strong>Clickjacking</strong></li>
<li><strong>MIME Sniffing</strong></li>
<li><strong>Cookie theft and hijacking</strong></li>
</ul>
<p>Even if your website has HTTPS enabled, these headers need to be correctly configured to fully enhance security.</p>
<hr>
<p>Within Nginx's <code>server</code> block, we can add these headers using the <code>add_header</code> directive.</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">server {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen 443 ssl http2;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    server_name example.com www.example.com;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Enhance security</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add_header X-Frame-Options "DENY" always;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add_header X-XSS-Protection "1; mode=block" always;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add_header X-Content-Type-Options "nosniff" always;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add_header Referrer-Policy "strict-origin-when-cross-origin" always;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add_header Permissions-Policy "geolocation=(), microphone=()" always;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add_header Content-Security-Policy "default-src 'self'; script-src 'self' https://trusted-cdn.com;" always;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    root /var/www/html;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    index index.html index.htm;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Let's go over the usage of these security headers:</p>
<ol>
<li>
<p><strong>X-Frame-Options: Prevent Clickjacking Attacks</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">add_header X-Frame-Options "DENY" always;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Prevents the website from being embedded in an <code>iframe</code>, blocking attackers from tricking users into clicking malicious buttons through hidden frames.</p>
<p>The options can be <code>DENY</code> (completely disallow embedding) or <code>SAMEORIGIN</code> (allow embedding only from the same origin). It is recommended to use <code>DENY</code> unless your website needs to be embedded in an iframe.</p>
</li>
</ol>
<hr>
<ol start=2>
<li>
<p><strong>X-XSS-Protection: Prevent XSS Attacks</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">add_header X-XSS-Protection "1; mode=block" always;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Enables the browser's built-in XSS filter to prevent attackers from injecting malicious scripts into the site. <code>1; mode=block</code> means the browser will block the page from loading if an XSS attack is detected.</p>
<p>While CSP (Content Security Policy) is a stronger XSS defense mechanism, <code>X-XSS-Protection</code> serves as an additional safeguard.</p>
</li>
</ol>
<hr>
<ol start=3>
<li>
<p><strong>X-Content-Type-Options: Prevent MIME Type Sniffing Attacks</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">add_header X-Content-Type-Options "nosniff" always;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Prevents browsers from guessing the MIME type for unknown content, stopping attackers from uploading malicious files (like changing <code>.js</code> to <code>.jpg</code>). Ensures all downloaded content is parsed according to the MIME type set by the server, reducing vulnerability risks.</p>
<p>This is one of the mandatory security headers recommended by OWASP.</p>
</li>
</ol>
<hr>
<ol start=4>
<li>
<p><strong>Referrer-Policy: Protect User Privacy</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">add_header Referrer-Policy "strict-origin-when-cross-origin" always;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Controls how the <code>Referer</code> header is sent, preventing external websites from obtaining complete URL information. The setting <code>strict-origin-when-cross-origin</code> means full <code>Referer</code> is sent for same-origin requests, while only the origin (<code>origin</code>) is sent for cross-origin requests, and the <code>Referer</code> is not sent when downgrading from HTTPS to HTTP.</p>
<p>This reduces privacy leakage risk while maintaining website analytics data.</p>
</li>
</ol>
<hr>
<ol start=5>
<li>
<p><strong>Permissions-Policy (Feature Policy): Restrict Browser Features</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">add_header Permissions-Policy "geolocation=(), microphone=()" always;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Restricts browser features available to the website, preventing abuse of user permissions (such as access to camera, microphone, or geolocation). The above configuration disables access to geolocation and microphone.</p>
<p>This is critical for modern privacy protection, especially for websites subject to GDPR or privacy regulations.</p>
</li>
</ol>
<hr>
<ol start=6>
<li>
<p><strong>Content-Security-Policy (CSP): The Strongest Defense Against XSS</strong></p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">add_header Content-Security-Policy "default-src 'self'; script-src 'self' https://trusted-cdn.com;" always;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>CSP is the strongest defense against XSS, limiting the sources from which resources can be loaded on the site. <code>default-src 'self'</code> means only resources from the same origin are allowed by default. <code>script-src 'self' https://trusted-cdn.com;</code> means only JavaScript from the same site and the specified trusted CDN are allowed.</p>
<p>CSP effectively prevents XSS attacks and enhances the overall security of the website.</p>
</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=main-configuration-file-setup>Main Configuration File Setup<a href=#main-configuration-file-setup class=hash-link aria-label="Direct link to Main Configuration File Setup" title="Direct link to Main Configuration File Setup">​</a></h2>
<p>In the previous chapters, we reviewed the main configuration file but skipped modifying it for now.</p>
<p>Now, let's take a closer look. Generally speaking, global configurations such as TLS settings, HTTP security headers, and request rate limits should be placed in <code>nginx.conf</code>, while site-specific configurations such as HSTS and redirects to HTTPS should go into site configuration files like <code>sites-available/default</code>.</p>
<p>Based on the discussion earlier, we can make some adjustments to the default <code>nginx.conf</code> to suit our needs.</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_Ktv7>/etc/nginx/nginx.conf</div><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">user www-data;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">worker_processes auto;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">pid /run/nginx.pid;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># Error log settings</span><br></span><span class=token-line style=color:#393A34><span class="token plain">error_log /var/log/nginx/error.log warn;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">include /etc/nginx/modules-enabled/*.conf;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">events {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    worker_connections 1024;  # Increase the maximum number of concurrent connections (default is 768)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    multi_accept on;          # Allow worker processes to accept multiple new connections simultaneously</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">http {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Basic settings</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    sendfile on;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    tcp_nopush on;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    types_hash_max_size 2048;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    server_tokens off;  # Hide Nginx version info to prevent attack information leakage</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # SSL settings</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ssl_protocols TLSv1.2 TLSv1.3;  # Disable TLS 1.0/1.1 for increased security</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384';</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ssl_prefer_server_ciphers on;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ssl_session_cache shared:SSL:10m;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ssl_session_timeout 1d;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ssl_session_tickets off;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ssl_stapling on;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ssl_stapling_verify on;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    resolver 8.8.8.8 1.1.1.1 valid=300s;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    resolver_timeout 5s;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ssl_dhparam /etc/nginx/ssl/dhparam.pem;  # Enhance DH parameters (manual generation required)</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Log settings</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    log_format main '$remote_addr - $remote_user [$time_local] '</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                    '"$request" $status $body_bytes_sent '</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                    '"$http_referer" "$http_user_agent"';</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    access_log /var/log/nginx/access.log main;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Gzip compression</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    gzip on;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    gzip_vary on;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    gzip_proxied any;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    gzip_comp_level 6;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    gzip_buffers 16 8k;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    gzip_http_version 1.1;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # HTTP security headers (apply site-wide, but can be overridden by individual servers)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add_header X-Frame-Options "DENY" always;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add_header X-XSS-Protection "1; mode=block" always;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add_header X-Content-Type-Options "nosniff" always;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add_header Referrer-Policy "strict-origin-when-cross-origin" always;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add_header Permissions-Policy "geolocation=(), microphone=()" always;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add_header Content-Security-Policy "default-src 'self'; script-src 'self' https://trusted-cdn.com;" always;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Virtual host configurations</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    include /etc/nginx/conf.d/*.conf;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    include /etc/nginx/sites-enabled/*;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Global DDoS defense variables (specific settings within `server` block)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    map $http_user_agent $bad_bot {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        default 0;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        "~*(nikto|curl|wget|python)" 1;  # Block malicious crawlers and scanning tools</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    limit_req_zone $binary_remote_addr zone=general:10m rate=5r/s;  # Limit requests per IP to 5 requests per second</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    limit_conn_zone $binary_remote_addr zone=connlimit:10m;         # Limit simultaneous connections per IP</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=site-configuration-file>Site Configuration File<a href=#site-configuration-file class=hash-link aria-label="Direct link to Site Configuration File" title="Direct link to Site Configuration File">​</a></h2>
<p>In the site configuration files, we can further configure security settings specific to individual websites.</p>
<p>Below is a simple example; in practice, you may need to configure more settings depending on the characteristics of the website.</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_Ktv7>/etc/nginx/sites-available/example.com</div><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">server {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen 80 default_server;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen [::]:80 default_server;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    server_name example.com www.example.com;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Force all HTTP traffic to be redirected to HTTPS</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    return 301 https://$host$request_uri;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">server {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen 443 ssl http2;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen [::]:443 ssl http2;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    server_name example.com www.example.com;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    root /var/www/html;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    index index.html index.htm;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # SSL Certificate (Let's Encrypt)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # HSTS (Only includeSubDomains if all subdomains are HTTPS enabled)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add_header Strict-Transport-Security "max-age=31536000; preload" always;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Site-specific DDoS defense</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    limit_req zone=general burst=10 nodelay;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    limit_conn connlimit 20;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Main route handling</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    location / {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        try_files $uri $uri/ =404;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # PHP parsing (Only enable on sites that require PHP to avoid security issues)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    location ~ \.php$ {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        try_files $uri =404;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        include snippets/fastcgi-php.conf;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        fastcgi_pass unix:/run/php/php7.4-fpm.sock;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        include fastcgi_params;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Deny access to hidden files and sensitive files (preserve Let's Encrypt)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    location ~ /\.(?!well-known).* {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        deny all;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    location ^~ /.well-known/acme-challenge/ {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        allow all;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<hr>
<p>Another example, based on the API deployment scenario we discussed earlier, assumes our API endpoint is:</p>
<ul>
<li><code>https://temp_api.example.com/test</code></li>
</ul>
<p>We can configure Nginx to secure this API endpoint:</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_Ktv7>/etc/nginx/sites-available/temp_api.example.com</div><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">server {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen 80 default_server;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen [::]:80 default_server;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    server_name temp_api.example.com;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Redirect all HTTP requests to HTTPS</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    return 301 https://$host$request_uri;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">server {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen 443 ssl http2;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    listen [::]:443 ssl http2;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    server_name temp_api.example.com;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # SSL certificate paths depend on your certificate location</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ssl_certificate /etc/letsencrypt/live/temp_api.example.com/fullchain.pem; # Managed by Certbot</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ssl_certificate_key /etc/letsencrypt/live/temp_api.example.com/privkey.pem; # Managed by Certbot</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # HTTP Security Headers</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add_header Strict-Transport-Security "max-age=63072000; includeSubdomains; preload" always;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Limit request body size (Prevent DDoS)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    client_max_body_size 10M;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Site-specific request limits</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    limit_req zone=general burst=10 nodelay;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    limit_conn connlimit 20;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Proxy requests to FastAPI app</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    location /test {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      proxy_pass http://127.0.0.1:8000;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      proxy_http_version 1.1;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      proxy_set_header Host $host;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      proxy_set_header X-Forwarded-Proto $scheme;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      proxy_cache_bypass $http_cache_control;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      proxy_no_cache $http_cache_control;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      # Let Nginx handle FastAPI's error responses</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      proxy_intercept_errors on;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      # Restrict to only allow GET, POST, HEAD</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      limit_except GET POST HEAD {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          deny all;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # Block malicious User-Agents</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ##</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    if ($bad_bot) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return 403;  # Block common scanners' User-Agent</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=conclusion>Conclusion<a href=#conclusion class=hash-link aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>As the saying goes, "The higher the road, the taller the devil." In the online environment, security is always an ongoing issue.</p>
<p>While these security measures cannot guarantee absolute safety, they can significantly reduce the risk of attacks on your website:</p>
<blockquote>
<p><strong>Attackers tend to choose softer targets. When they see that your website has security measures in place, they may not waste time attacking it and instead look for easier targets. (If your website is of exceptionally high value, that may be a different case.)</strong></p>
</blockquote>
<p>For regular users, enabling these security measures not only protects the website but also improves SEO rankings and user trust, making it a worthwhile investment.</p>
<p>Although the entire process can be tedious and may leave you feeling frustrated and exhausted, don't give up. The internet environment is full of malicious actors, and a small lapse in attention can lead to significant losses.</p>
<p>Take a break for now, and in the next chapter, we will learn how to use Fail2Ban for Nginx security monitoring.</div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col></div><div class="col lastUpdated_JAkA"><span class=theme-last-updated>Last updated<!-- --> on <b><time datetime=2025-02-28T01:10:00.000Z itemprop=dateModified>Feb 28, 2025</time></b> by <b>zephyr-sh</b></span></div></div><div style=margin-top:3rem> </div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/en/docs/nginx-notes/https-settings><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Nginx HTTPS Settings</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/en/docs/nginx-notes/monitoring><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Nginx Monitoring</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#tls-security-hardening class="table-of-contents__link toc-highlight">TLS Security Hardening</a><li><a href=#advanced-hsts-configuration class="table-of-contents__link toc-highlight">Advanced HSTS Configuration</a><li><a href=#other-security-headers class="table-of-contents__link toc-highlight">Other Security Headers</a><li><a href=#main-configuration-file-setup class="table-of-contents__link toc-highlight">Main Configuration File Setup</a><li><a href=#site-configuration-file class="table-of-contents__link toc-highlight">Site Configuration File</a><li><a href=#conclusion class="table-of-contents__link toc-highlight">Conclusion</a></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class=footer__links><a class=footer__link-item href=/en/docs>Projects</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/papers/intro>Papers</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/blog>Blog</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/terms-of-service>TermsOfUse</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/privacy-policy>Privacy Policy</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/become-an-author>Become an author</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/worklog>Worklog</a></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2024 DOCSAID.</div></div></div></footer></div>