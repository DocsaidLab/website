<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-nginx-notes/monitoring" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.8.1"><title data-rh=true>Nginx Monitoring | DOCSAID</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:image content=https://docsaid.org/en/img/docsaid-social-card.jpg><meta data-rh=true name=twitter:image content=https://docsaid.org/en/img/docsaid-social-card.jpg><meta data-rh=true property=og:url content=https://docsaid.org/en/docs/nginx-notes/monitoring><meta data-rh=true property=og:locale content=en><meta data-rh=true property=og:locale:alternate content=zh_hant><meta data-rh=true property=og:locale:alternate content=ja><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Nginx Monitoring | DOCSAID"><meta data-rh=true name=description content="Once we expose the API to the public, we immediately start receiving malicious requests from all directions."><meta data-rh=true property=og:description content="Once we expose the API to the public, we immediately start receiving malicious requests from all directions."><link data-rh=true rel=icon href=/en/img/favicon.ico><link data-rh=true rel=canonical href=https://docsaid.org/en/docs/nginx-notes/monitoring><link data-rh=true rel=alternate href=https://docsaid.org/docs/nginx-notes/monitoring hreflang=zh-hant><link data-rh=true rel=alternate href=https://docsaid.org/en/docs/nginx-notes/monitoring hreflang=en><link data-rh=true rel=alternate href=https://docsaid.org/ja/docs/nginx-notes/monitoring hreflang=ja><link data-rh=true rel=alternate href=https://docsaid.org/docs/nginx-notes/monitoring hreflang=x-default><link data-rh=true rel=preconnect href=https://S9NC0RYCHF-dsn.algolia.net crossorigin=anonymous><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://docsaid.org/en/docs/nginx-notes/","name":"Nginx Notes","position":1},{"@type":"ListItem","item":"https://docsaid.org/en/docs/nginx-notes/monitoring","name":"Nginx Monitoring","position":2}]}</script><link rel=alternate type=application/rss+xml href=/en/blog/rss.xml title="DOCSAID RSS Feed"><link rel=alternate type=application/atom+xml href=/en/blog/atom.xml title="DOCSAID Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-RDF83L9R4M"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-RDF83L9R4M",{anonymize_ip:!0})</script><link rel=search type=application/opensearchdescription+xml title=DOCSAID href=/en/opensearch.xml><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css type=text/css integrity=sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM crossorigin=anonymous><link rel=stylesheet href=/en/assets/css/styles.e52f1f88.css><script src=/en/assets/js/runtime~main.7747fe92.js defer></script><script src=/en/assets/js/main.46218941.js defer></script><body class=navigation-with-keyboard><svg xmlns=http://www.w3.org/2000/svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light",e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top navbarHideable_jvwV"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/en/><div class=navbar__logo><img src=/en/img/docsaid_logo.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/en/img/docsaid_logo_white.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/en/docs/>Projects</a><a class="navbar__item navbar__link" href=/en/papers/intro>Papers</a><a class="navbar__item navbar__link" href=/en/blog>Blog</a><a class="navbar__item navbar__link" href=/en/playground/intro>Playground</a><a class="navbar__item navbar__link" href=/en/services>Services</a><a class="navbar__item navbar__link" href=/en/aboutus>About Us</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg viewBox="0 0 24 24" width=20 height=20 aria-hidden=true class=iconLanguage_nlXk><path fill=currentColor d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>English</a><ul class=dropdown__menu><li><a href=/docs/nginx-notes/monitoring target=_self rel="noopener noreferrer" class=dropdown__link lang=zh-hant>繁體中文</a><li><a href=/en/docs/nginx-notes/monitoring target=_self rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=en>English</a><li><a href=/ja/docs/nginx-notes/monitoring target=_self rel="noopener noreferrer" class=dropdown__link lang=ja>日本語</a></ul></div><div class=navbarSearchContainer_dCNk><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div><button type=button class="ant-btn css-mc1tut ant-btn-circle ant-btn-default ant-btn-color-default ant-btn-variant-outlined ant-btn-icon-only"><span class=ant-btn-icon><span role=img aria-label=user style=font-size:18px class="anticon anticon-user"><svg viewBox="64 64 896 896" focusable=false data-icon=user width=1em height=1em fill=currentColor aria-hidden=true><path d="M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"/></svg></span></span></button></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_eExm"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex=-1 class=sidebarLogo_isFc href=/en/><img src=/en/img/docsaid_logo.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/en/img/docsaid_logo_white.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"><b></b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/en/docs/>Open Source Projects</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/model-training-guide/>Model Training Guide</a><button aria-label="Expand sidebar category 'Model Training Guide'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/autotraderx/>AutoTraderX</a><button aria-label="Expand sidebar category 'AutoTraderX'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/capybara/>Capybara</a><button aria-label="Expand sidebar category 'Capybara'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/docaligner/>DocAligner</a><button aria-label="Expand sidebar category 'DocAligner'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/docclassifier/>DocClassifier</a><button aria-label="Expand sidebar category 'DocClassifier'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/gmailsummary/>GmailSummary</a><button aria-label="Expand sidebar category 'GmailSummary'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/mrzscanner/>MRZScanner</a><button aria-label="Expand sidebar category 'MRZScanner'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/en/docs/nginx-notes/>Nginx Notes</a><button aria-label="Collapse sidebar category 'Nginx Notes'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/docs/nginx-notes/intro>Nginx Introduction</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/docs/nginx-notes/install-and-settings>Nginx Configuration</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/docs/nginx-notes/https-settings>Nginx HTTPS Settings</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/docs/nginx-notes/security>Nginx Security</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/en/docs/nginx-notes/monitoring>Nginx Monitoring</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/docs/nginx-notes/static-file-server>Nginx Serving Static Resources</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/en/docs/category/補充資料>Supplementary</a><button aria-label="Expand sidebar category 'Supplementary'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/wordcanvas/>WordCanvas</a><button aria-label="Expand sidebar category 'WordCanvas'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav><button type=button title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_kv0_><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/en/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/en/docs/nginx-notes/><span>Nginx Notes</span></a><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Nginx Monitoring</span></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Nginx Monitoring</h1></header>
<p>Once we expose the API to the public, we immediately start receiving malicious requests from all directions.</p>
<p>If you have looked at the log records, you should not have trouble noticing that various IP addresses are repeatedly attempting to log into your server with different usernames and passwords. This is a common brute force attack, where attackers use automated tools to continuously try logging in until they find the correct password.</p>
<p>Although we can make the password complexity sky-high, constantly worrying about this is not a solution.</p>
<p>So, we use the tool Fail2ban to block those IP addresses.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=what-is-fail2ban>What is Fail2ban?<a href=#what-is-fail2ban class=hash-link aria-label="Direct link to What is Fail2ban?" title="Direct link to What is Fail2ban?">​</a></h2>
<p>Fail2ban is an open-source intrusion prevention tool, mainly used to monitor server logs and block malicious IPs based on predefined rules. It effectively defends against brute force attacks, such as malicious behaviors targeting SSH, HTTP, and other network services.</p>
<p>The operation of Fail2ban is based on two key concepts: <strong>filters</strong> and <strong>jails</strong>:</p>
<ul>
<li><strong>Filters</strong>: Used to define suspicious behavior patterns that should be looked for in the logs.</li>
<li><strong>Jails</strong>: Responsible for combining filters with blocking mechanisms. When abnormal behavior is detected, jails automatically perform the corresponding action.</li>
</ul>
<p>In the context of Nginx, Fail2ban monitors Nginx's access log and error log to identify suspicious requests, such as:</p>
<ul>
<li><strong>Frequent 404 errors</strong> (potential scanning attacks)</li>
<li><strong>Continuous login failures</strong> (brute force attacks)</li>
<li><strong>High-frequency requests within a short time</strong> (DDoS or malicious bots)</li>
</ul>
<p>Once abnormal behavior is detected, Fail2ban, based on the configuration, automatically blocks the source IP via iptables or nftables, preventing further attacks on the Nginx server.</p>
<p>In an Ubuntu environment, the Nginx logs are stored by default at:</p>
<ul>
<li><strong>Access log</strong>: <code>/var/log/nginx/access.log</code></li>
<li><strong>Error log</strong>: <code>/var/log/nginx/error.log</code></li>
</ul>
<p>Fail2ban can be configured to monitor these logs and match the log content with predefined or custom filter rule templates. When log entries match malicious behavior patterns, Fail2ban adds the related IPs to the blocklist.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>info</div><div class=admonitionContent_BuS1><p>Rule templates are usually located in <code>/etc/fail2ban/filter.d/</code></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>tip</div><div class=admonitionContent_BuS1><p>In addition to protecting Nginx, Fail2ban can also be applied to SSH, FTP, mail servers, and other services, providing extensive server security protection. This guide mainly focuses on defense configurations related to Nginx.</div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=basic-fail2ban-configuration>Basic Fail2ban Configuration<a href=#basic-fail2ban-configuration class=hash-link aria-label="Direct link to Basic Fail2ban Configuration" title="Direct link to Basic Fail2ban Configuration">​</a></h2>
<p>On Ubuntu, Fail2ban can be installed directly via the APT package manager, as it is included in the official software repository. Follow these steps to install and start Fail2ban:</p>
<ol>
<li>
<p><strong>Update the system package repository</strong>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo apt update</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Install Fail2ban</strong>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo apt install -y fail2ban</span><br></span></code></pre></div></div>
<p>This will automatically download and install Fail2ban and its dependencies. After installation, Fail2ban will start automatically and be set to run on boot.</p>
</li>
<li>
<p><strong>Check the status of the Fail2ban service</strong>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo systemctl status fail2ban</span><br></span></code></pre></div></div>
<p>If the installation is successful, it should show <code>active (running)</code>, indicating that Fail2ban is running correctly.</p>
</li>
<li>
<p><strong>Check the Fail2ban version and status</strong>:</p>
<ul>
<li>
<p>Display the currently installed Fail2ban version:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">fail2ban-client --version</span><br></span></code></pre></div></div>
</li>
<li>
<p>Check the currently enabled jails:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo fail2ban-client status</span><br></span></code></pre></div></div>
<p>By default, Fail2ban may only have SSH protection enabled. Additional configuration is required for Nginx-related defenses.</p>
</li>
</ul>
</li>
</ol>
<hr>
<p>The main configuration file for Fail2ban is <code>/etc/fail2ban/jail.conf</code>, but it is recommended by the official documentation: <strong>"Do not modify this file directly"</strong> to avoid overwriting your settings during software updates.</p>
<p>Therefore, we create a local configuration file <code>jail.local</code> to override the default values.</p>
<ol>
<li>
<p><strong>Copy <code>jail.conf</code> to <code>jail.local</code></strong>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Edit <code>jail.local</code></strong>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo vim /etc/fail2ban/jail.local</span><br></span></code></pre></div></div>
</li>
</ol>
<p>Find the <code>[DEFAULT]</code> section and set key parameters, such as trusted IPs, ban time, monitoring time, and maximum retry attempts:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">[DEFAULT]</span><br></span><span class=token-line style=color:#393A34><span class="token plain">ignoreip = 127.0.0.1/8 ::1    # Set trusted IP addresses that will not be blocked</span><br></span><span class=token-line style=color:#393A34><span class="token plain">bantime  = 1h                 # Default ban time, can be set in seconds or time units (e.g., 1h, 10m)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">findtime = 10m                # Within this period...</span><br></span><span class=token-line style=color:#393A34><span class="token plain">maxretry = 5                  # If failed more than maxretry times, the IP will be banned</span><br></span></code></pre></div></div>
<p>The meanings of these settings are as follows:</p>
<ul>
<li><strong>ignoreip</strong>: Specifies which IPs will not be blocked, such as the local IP (<code>127.0.0.1</code>) or other management IPs.</li>
<li><strong>bantime</strong>: The duration of the ban, by default 1 hour (<code>1h</code>). During this time, the IP will be blocked from accessing the server.</li>
<li><strong>findtime</strong>: The observation time range, for example, <code>10m</code> means that failed attempts within 10 minutes will be counted.</li>
<li><strong>maxretry</strong>: The maximum number of retries, for example, <code>5</code> means that the same IP will be banned after triggering the rule 5 times within <code>findtime</code>.</li>
</ul>
<p>These parameters are global settings and apply to all jails. We will later configure a separate blocking strategy for Nginx to ensure more effective interception of malicious attacks.</p>
<p>Once the settings are complete, restart Fail2ban to apply the new configuration:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo systemctl restart fail2ban</span><br></span></code></pre></div></div>
<p>At this point, the basic installation and global configuration of Fail2ban have been completed.</p>
<p>Next, we will further configure Fail2ban to monitor Nginx logs to prevent malicious requests.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=monitoring-common-attack-types>Monitoring Common Attack Types<a href=#monitoring-common-attack-types class=hash-link aria-label="Direct link to Monitoring Common Attack Types" title="Direct link to Monitoring Common Attack Types">​</a></h2>
<p>Here, we will configure Fail2ban to monitor and automatically block several common attack types against Nginx. Each type of attack usually has clear characteristics in the Nginx logs, so we first define "filter rules" to detect them and apply the corresponding blocking strategies.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=preventing-malicious-crawlers>Preventing Malicious Crawlers<a href=#preventing-malicious-crawlers class=hash-link aria-label="Direct link to Preventing Malicious Crawlers" title="Direct link to Preventing Malicious Crawlers">​</a></h3>
<p>Many malicious crawlers or attack tools use specific User-Agent strings, such as:</p>
<ul>
<li><code>Java</code></li>
<li><code>Python-urllib</code></li>
<li><code>Curl</code></li>
<li><code>sqlmap</code></li>
<li><code>Wget</code></li>
<li><code>360Spider</code></li>
<li><code>MJ12bot</code></li>
</ul>
<p>These User-Agents mostly come from automated scanning tools and do not belong to legitimate users. Therefore, we can block such User-Agents in real-time.</p>
<p>First, create a new filter file in the <code>/etc/fail2ban/filter.d/</code> directory:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo vim /etc/fail2ban/filter.d/nginx-badbots.conf</span><br></span></code></pre></div></div>
<p>Add the following content:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">[Definition]</span><br></span><span class=token-line style=color:#393A34><span class="token plain">failregex = &lt;HOST> -.* "(GET|POST).*HTTP.*" .* "(?:Java|Python-urllib|Curl|sqlmap|Wget|360Spider|MJ12bot)"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">ignoreregex =</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># failregex is the regular expression used to match malicious requests</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - &lt;HOST> represents the IP address, and the placeholder is parsed by Fail2Ban</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - "(GET|POST).*HTTP.*" restricts to HTTP GET or POST requests</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - .* matches the request content</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - "(?:Java|Python-urllib|Curl|sqlmap|Wget|360Spider|MJ12bot)"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - These are common crawlers, scanners, or attack tools:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#     - Java: Typically from Java-based crawlers</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#     - Python-urllib: Python's built-in URL request library</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#     - Curl: Command-line HTTP request tool</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#     - sqlmap: Automated SQL injection tool</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#     - Wget: Download tool, also used for crawling websites</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#     - 360Spider: 360 Search engine crawler</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#     - MJ12bot: Majestic SEO crawler</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ignoreregex is used to exclude certain requests with regular expressions</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - Leave it empty to not exclude any requests</span><br></span></code></pre></div></div>
<p>Then configure the Jail by adding the following to the <code>jail.local</code> file:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">[nginx-badbots]</span><br></span><span class=token-line style=color:#393A34><span class="token plain">enabled  = true</span><br></span><span class=token-line style=color:#393A34><span class="token plain">port     = http,https</span><br></span><span class=token-line style=color:#393A34><span class="token plain">filter   = nginx-badbots</span><br></span><span class=token-line style=color:#393A34><span class="token plain">logpath  = /var/log/nginx/access.log</span><br></span><span class=token-line style=color:#393A34><span class="token plain">maxretry = 1</span><br></span><span class=token-line style=color:#393A34><span class="token plain">bantime  = 86400</span><br></span></code></pre></div></div>
<p>This will immediately block any requests with these User-Agents for 24 hours.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=preventing-404-scan-attacks>Preventing 404 Scan Attacks<a href=#preventing-404-scan-attacks class=hash-link aria-label="Direct link to Preventing 404 Scan Attacks" title="Direct link to Preventing 404 Scan Attacks">​</a></h3>
<p>This type of attack involves brute-forcing nonexistent pages, typically generating a large number of requests within a short period.</p>
<p>Attackers may use scripts to repeatedly access non-existent pages on the website in an attempt to discover vulnerabilities or sensitive files, causing a large number of HTTP 404 errors.</p>
<p>Create a new filter file:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo vim /etc/fail2ban/filter.d/nginx-404.conf</span><br></span></code></pre></div></div>
<p>Add the following content:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">[Definition]</span><br></span><span class=token-line style=color:#393A34><span class="token plain">failregex = &lt;HOST> -.* "(GET|POST).*HTTP.*" 404</span><br></span><span class=token-line style=color:#393A34><span class="token plain">ignoreregex =</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># failregex is the regular expression used to match specific log patterns</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - &lt;HOST> represents the IP address (Fail2Ban will automatically replace it with the actual source IP)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - "(GET|POST).*HTTP.*":</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - Restricts to GET or POST requests</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - .* matches the URL and HTTP protocol version (e.g., HTTP/1.1)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - "404" specifies matching HTTP 404 status code (indicating the requested resource was not found)</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># This rule is used to block IPs that frequently trigger 404 errors, such as crawlers or attackers scanning non-existent pages</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># Suitable for web servers (such as Nginx, Apache) log analysis</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ignoreregex is used to exclude certain requests from matching</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - Leave it empty to not exclude any requests</span><br></span></code></pre></div></div>
<p>Then configure the Jail by adding the following to the <code>jail.local</code> file:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">[nginx-404]</span><br></span><span class=token-line style=color:#393A34><span class="token plain">enabled  = true</span><br></span><span class=token-line style=color:#393A34><span class="token plain">port     = http,https</span><br></span><span class=token-line style=color:#393A34><span class="token plain">filter   = nginx-404</span><br></span><span class=token-line style=color:#393A34><span class="token plain">logpath  = /var/log/nginx/access.log</span><br></span><span class=token-line style=color:#393A34><span class="token plain">findtime = 10m</span><br></span><span class=token-line style=color:#393A34><span class="token plain">maxretry = 5</span><br></span><span class=token-line style=color:#393A34><span class="token plain">bantime  = 86400</span><br></span></code></pre></div></div>
<p>This will block any IPs that trigger 5 HTTP 404 errors within 10 minutes for 24 hours.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=preventing-ddos-attacks>Preventing DDoS Attacks<a href=#preventing-ddos-attacks class=hash-link aria-label="Direct link to Preventing DDoS Attacks" title="Direct link to Preventing DDoS Attacks">​</a></h3>
<p>When an IP sends a large number of requests in a short period, it could be a DDoS attack or malicious crawling.</p>
<p>Create a new filter file:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo vim /etc/fail2ban/filter.d/nginx-limitreq.conf</span><br></span></code></pre></div></div>
<p>Add the following content:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">[Definition]</span><br></span><span class=token-line style=color:#393A34><span class="token plain">failregex = limiting requests, excess: .* by zone .* client: &lt;HOST></span><br></span><span class=token-line style=color:#393A34><span class="token plain">ignoreregex =</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># failregex is used to match rate limiting events in Nginx logs</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - "limiting requests, excess: .* by zone .* client: &lt;HOST>"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - "limiting requests, excess:" indicates that the request exceeded the configured limit (e.g., Nginx's limit_req_zone limit)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - .* allows matching any data (such as the number of requests or details of the excess)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - "by zone .*" represents the rate limiting zone configured in Nginx</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - "client: &lt;HOST>" is where Fail2Ban will replace with the actual client IP address</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ignoreregex is used to exclude specific matching patterns</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - Leave it empty to exclude no requests</span><br></span></code></pre></div></div>
<p>This <code>failregex</code> is primarily used to match Nginx rate-limiting (limit_req_zone) log entries, such as:</p>
<div class="language-log codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-log codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">2024/02/15 12:34:56 [error] 1234#5678: *90123 limiting requests, excess: 20.000 by zone "api_limit" client: 192.168.1.100, server: example.com, request: "GET /api/v1/data HTTP/1.1"</span><br></span></code></pre></div></div>
<p>The corresponding Nginx configuration might look like:</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">server {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    location /api/ {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        limit_req zone=api_limit burst=20 nodelay;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre></div></div>
<p>With this setup, when an IP sends too many requests in a short period, Nginx will log the message <code>"limiting requests, excess: ... client: &lt;IP>"</code>, and Fail2Ban will use the <code>failregex</code> to match and block that IP.</p>
<p>Next, configure the Jail by adding the following to <code>jail.local</code>:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">[nginx-limitreq]</span><br></span><span class=token-line style=color:#393A34><span class="token plain">enabled  = true</span><br></span><span class=token-line style=color:#393A34><span class="token plain">port     = http,https</span><br></span><span class=token-line style=color:#393A34><span class="token plain">filter   = nginx-limitreq</span><br></span><span class=token-line style=color:#393A34><span class="token plain">logpath  = /var/log/nginx/error.log</span><br></span><span class=token-line style=color:#393A34><span class="token plain">findtime = 10m</span><br></span><span class=token-line style=color:#393A34><span class="token plain">maxretry = 10</span><br></span><span class=token-line style=color:#393A34><span class="token plain">bantime  = 86400</span><br></span></code></pre></div></div>
<p>This will block any IPs that trigger rate limiting more than 10 times within 10 minutes for 24 hours.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=preventing-brute-force-login-attacks>Preventing Brute Force Login Attacks<a href=#preventing-brute-force-login-attacks class=hash-link aria-label="Direct link to Preventing Brute Force Login Attacks" title="Direct link to Preventing Brute Force Login Attacks">​</a></h3>
<p>If your site provides a login feature, attackers might try brute-forcing the username and password.</p>
<p>Create a new filter file:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo vim /etc/fail2ban/filter.d/nginx-login.conf</span><br></span></code></pre></div></div>
<p>Add the following content:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">[Definition]</span><br></span><span class=token-line style=color:#393A34><span class="token plain">failregex = &lt;HOST> -.* "(POST|GET) /(admin|wp-login.php) HTTP.*"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">ignoreregex =</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># failregex is used to match malicious requests targeting common admin login pages</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - &lt;HOST> represents the IP address (Fail2Ban will automatically replace it with the actual source IP)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - "(POST|GET) /(admin|wp-login.php) HTTP.*"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - "(POST|GET)" indicates the HTTP method (attackers might try to log in with either GET or POST)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - "/admin" is a common path for site admin dashboards</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - "/wp-login.php" is the WordPress login page</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - "HTTP.*" is used to match different HTTP versions, such as HTTP/1.1 or HTTP/2</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ignoreregex is used to exclude specific requests</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - Leave it empty to exclude no requests</span><br></span></code></pre></div></div>
<p>This rule will match login attempts to WordPress or typical website admin login pages.</p>
<p>Next, configure the Jail by adding the following to <code>jail.local</code>:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">[nginx-login]</span><br></span><span class=token-line style=color:#393A34><span class="token plain">enabled  = true</span><br></span><span class=token-line style=color:#393A34><span class="token plain">port     = http,https</span><br></span><span class=token-line style=color:#393A34><span class="token plain">filter   = nginx-login</span><br></span><span class=token-line style=color:#393A34><span class="token plain">logpath  = /var/log/nginx/access.log</span><br></span><span class=token-line style=color:#393A34><span class="token plain">findtime = 5m</span><br></span><span class=token-line style=color:#393A34><span class="token plain">maxretry = 5</span><br></span><span class=token-line style=color:#393A34><span class="token plain">bantime  = 86400</span><br></span></code></pre></div></div>
<p>This will block any IPs that fail to log in more than 5 times within 5 minutes for 24 hours.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=attempting-to-access-sensitive-data>Attempting to Access Sensitive Data<a href=#attempting-to-access-sensitive-data class=hash-link aria-label="Direct link to Attempting to Access Sensitive Data" title="Direct link to Attempting to Access Sensitive Data">​</a></h3>
<p>Malicious attackers may attempt to access sensitive paths such as <code>/etc/passwd</code>, <code>/.git</code>, or <code>/.env</code>.</p>
<p>Create a new filter file:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo vim /etc/fail2ban/filter.d/nginx-sensitive.conf</span><br></span></code></pre></div></div>
<p>Add the following content:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">[Definition]</span><br></span><span class=token-line style=color:#393A34><span class="token plain">failregex = &lt;HOST> -.* "(GET|POST) /(etc/passwd|\.git|\.env) HTTP.*"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">ignoreregex =</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># failregex is used to match malicious requests attempting to access sensitive files</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - &lt;HOST> represents the IP address (Fail2Ban will automatically replace it with the actual source IP)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - "(GET|POST) /(etc/passwd|\.git|\.env) HTTP.*"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - "(GET|POST)" indicates the HTTP method, attackers may try GET or POST to probe files</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - "/etc/passwd" is a password file on Linux systems, attackers may attempt to read it</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - "/.git" is a directory that may contain source code and sensitive information, attackers may try to download the `.git` folder</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - "/.env" is an environment variables file that may contain **database passwords, API keys, secrets**</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - "HTTP.*" matches different HTTP versions (e.g., HTTP/1.1, HTTP/2)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ignoreregex is used to exclude specific requests</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - Leave it empty to exclude no requests</span><br></span></code></pre></div></div>
<p>This rule is designed to prevent directory traversal attacks, protect Git directories, block attempts to probe <code>.env</code> files, and guard against web scanners.</p>
<p>Next, configure the Jail by adding the following to <code>jail.local</code>:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">[nginx-sensitive]</span><br></span><span class=token-line style=color:#393A34><span class="token plain">enabled  = true</span><br></span><span class=token-line style=color:#393A34><span class="token plain">port     = http,https</span><br></span><span class=token-line style=color:#393A34><span class="token plain">filter   = nginx-sensitive</span><br></span><span class=token-line style=color:#393A34><span class="token plain">logpath  = /var/log/nginx/access.log</span><br></span><span class=token-line style=color:#393A34><span class="token plain">maxretry = 1</span><br></span><span class=token-line style=color:#393A34><span class="token plain">bantime  = 86400</span><br></span></code></pre></div></div>
<p>This will immediately block any IP attempting to access these sensitive files for 24 hours.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=attacks-targeting-apis>Attacks Targeting APIs<a href=#attacks-targeting-apis class=hash-link aria-label="Direct link to Attacks Targeting APIs" title="Direct link to Attacks Targeting APIs">​</a></h3>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>tip</div><div class=admonitionContent_BuS1><p>Remember to adjust the filter based on your specific API endpoints.</div></div>
<p>For brute force attacks targeting API endpoints like <code>/api/login</code>, <code>/api/register</code>, it is important to limit request frequency.</p>
<p>Create a new filter file:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo vim /etc/fail2ban/filter.d/nginx-api.conf</span><br></span></code></pre></div></div>
<p>Add the following content:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">[Definition]</span><br></span><span class=token-line style=color:#393A34><span class="token plain">failregex = &lt;HOST> -.* "(POST) /api/(login|register) HTTP.*"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">ignoreregex =</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># failregex is used to match malicious requests targeting API login and registration</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - &lt;HOST> represents the IP address (Fail2Ban will automatically replace it with the actual source IP)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - "(POST) /api/(login|register) HTTP.*"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - "(POST)" restricts to HTTP POST requests (to prevent brute force login or abuse of registration)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - "/api/login" is the login API, which may become a target for brute force attacks</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - "/api/register" is the registration API, which attackers may try to abuse for mass account creation (e.g., bot registrations)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#   - "HTTP.*" matches HTTP versions (e.g., HTTP/1.1, HTTP/2)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">#</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ignoreregex is used to exclude specific requests</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># - Leave it empty to exclude no requests</span><br></span></code></pre></div></div>
<p>This rule is designed to prevent brute force login attacks, automated registration abuse, and enhance API security.</p>
<p>Next, configure the Jail by adding the following to <code>jail.local</code>:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">[nginx-api]</span><br></span><span class=token-line style=color:#393A34><span class="token plain">enabled  = true</span><br></span><span class=token-line style=color:#393A34><span class="token plain">port     = http,https</span><br></span><span class=token-line style=color:#393A34><span class="token plain">filter   = nginx-api</span><br></span><span class=token-line style=color:#393A34><span class="token plain">logpath  = /var/log/nginx/access.log</span><br></span><span class=token-line style=color:#393A34><span class="token plain">findtime = 1m</span><br></span><span class=token-line style=color:#393A34><span class="token plain">maxretry = 10</span><br></span><span class=token-line style=color:#393A34><span class="token plain">bantime  = 86400</span><br></span></code></pre></div></div>
<p>This will block any IP that exceeds 10 login attempts within 1 minute for 24 hours.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=apply-new-rules>Apply New Rules<a href=#apply-new-rules class=hash-link aria-label="Direct link to Apply New Rules" title="Direct link to Apply New Rules">​</a></h3>
<p>Once the configuration is complete, restart Fail2ban:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo systemctl restart fail2ban</span><br></span></code></pre></div></div>
<p>And check the status of the jails:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo fail2ban-client status</span><br></span></code></pre></div></div>
<p>If you want to check the status of a specific jail, use:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo fail2ban-client status nginx-404 # Replace with your jail name</span><br></span></code></pre></div></div>
<p>At this point, we have configured Fail2ban to defend against common attack types targeting Nginx, ensuring the security of the website.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=testing-defense-effectiveness>Testing Defense Effectiveness<a href=#testing-defense-effectiveness class=hash-link aria-label="Direct link to Testing Defense Effectiveness" title="Direct link to Testing Defense Effectiveness">​</a></h2>
<p>After completing the Fail2ban Nginx defense configuration, we will perform a simple test.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=simulate-attacks-using-curl>Simulate Attacks Using <code>curl</code><a href=#simulate-attacks-using-curl class=hash-link aria-label="Direct link to simulate-attacks-using-curl" title="Direct link to simulate-attacks-using-curl">​</a></h3>
<p>You can use <code>curl</code> on the local machine or another computer to send malicious requests to trigger Fail2ban's blocking mechanism.</p>
<p>Note: Do not send requests from <code>localhost</code> (127.0.0.1) during testing, as <code>127.0.0.1</code> may be excluded by the <code>ignoreip</code> setting, and Fail2ban will not block it. You can use another computer or server in a different network environment to perform the test, or temporarily clear the <code>ignoreip</code> setting.</p>
<ul>
<li>
<p><strong>1. Test 404 Scan Interception</strong></p>
<p>Simulate an attacker randomly scanning for non-existent pages:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">for i in $(seq 1 6); do</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    curl -I http://&lt;your-server-IP-or-domain>/nonexistentpage_$i ;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">done</span><br></span></code></pre></div></div>
<p>This will consecutively request 6 non-existent pages, generating HTTP 404 errors. If your rule is set to block after 5 404 errors, Fail2ban should block the IP on the 5th or 6th attempt.</p>
<p>After the block, running the <code>curl</code> command again should result in a failed connection (e.g., timeout or connection refused).</p>
</li>
</ul>
<hr>
<ul>
<li>
<p><strong>2. Test Sensitive URL Interception</strong></p>
<p>Attackers often try to access system-sensitive files, such as <code>/etc/passwd</code>, to check if the server has vulnerabilities:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">curl -I http://&lt;your-server>/etc/passwd</span><br></span></code></pre></div></div>
<p>If Fail2ban's <code>nginx-sensitive</code> filter is configured correctly, this request should be detected and the IP should be immediately blocked (if <code>maxretry = 1</code>).</p>
</li>
</ul>
<hr>
<ul>
<li>
<p><strong>3. Test User-Agent Interception</strong></p>
<p>Simulate a malicious crawler tool, such as <code>sqlmap</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">curl -A "sqlmap/1.5.2#stable" http://&lt;your-server>/</span><br></span></code></pre></div></div>
<p>If your rule includes the <code>sqlmap</code> User-Agent, Fail2ban should immediately block the IP.</p>
</li>
</ul>
<hr>
<ul>
<li>
<p><strong>4. Test Brute Force Login Attack</strong></p>
<p>Send multiple requests to WordPress or other login pages to simulate an attacker attempting brute-force login:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">for i in $(seq 1 6); do</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    curl -X POST -d "username=admin&password=wrongpassword" http://&lt;your-server>/wp-login.php ;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">done</span><br></span></code></pre></div></div>
<p>If your <code>nginx-login</code> filter is configured to block after 5 failed attempts, Fail2ban should block the IP on the 5th or 6th attempt.</p>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=verify-status-and-logs>Verify Status and Logs<a href=#verify-status-and-logs class=hash-link aria-label="Direct link to Verify Status and Logs" title="Direct link to Verify Status and Logs">​</a></h3>
<p>You can check the status of the jail using the following command. For example, to check the <code>nginx-sensitive</code> jail:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo fail2ban-client status nginx-sensitive</span><br></span></code></pre></div></div>
<p>Expected output:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">Status for the jail: nginx-sensitive</span><br></span><span class=token-line style=color:#393A34><span class="token plain">|- Filter</span><br></span><span class=token-line style=color:#393A34><span class="token plain">|  |- Currently failed: 0</span><br></span><span class=token-line style=color:#393A34><span class="token plain">|  |- Total failed: 9</span><br></span><span class=token-line style=color:#393A34><span class="token plain">|  `- File list: /var/log/nginx/access.log /var/log/nginx/error.log</span><br></span><span class=token-line style=color:#393A34><span class="token plain">`- Actions</span><br></span><span class=token-line style=color:#393A34><span class="token plain">   |- Currently banned: 1</span><br></span><span class=token-line style=color:#393A34><span class="token plain">   |- Total banned: 2</span><br></span><span class=token-line style=color:#393A34><span class="token plain">   `- Banned IP list: 203.0.113.45</span><br></span></code></pre></div></div>
<ul>
<li><strong>Currently banned</strong>: The number of currently banned IPs.</li>
<li><strong>Total failed</strong>: The total number of malicious requests detected.</li>
<li><strong>Banned IP list</strong>: Shows the current banned IPs (e.g., <code>203.0.113.45</code>).</li>
</ul>
<hr>
<p>Next, you can check Fail2ban's log to confirm the block records:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo tail -n 20 /var/log/fail2ban.log</span><br></span></code></pre></div></div>
<p>Expected output example:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">fail2ban.actions [INFO] Ban 203.0.113.45 on nginx-sensitive</span><br></span></code></pre></div></div>
<p>This indicates that the IP <code>203.0.113.45</code> was banned for triggering the <code>nginx-sensitive</code> rule.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=unblocking-an-ip>Unblocking an IP<a href=#unblocking-an-ip class=hash-link aria-label="Direct link to Unblocking an IP" title="Direct link to Unblocking an IP">​</a></h3>
<p>During testing or regular management, you might need to manually block or unblock a specific IP.</p>
<p>You can manually block an IP:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo fail2ban-client set nginx-sensitive banip 203.0.113.45</span><br></span></code></pre></div></div>
<p>This will immediately block <code>203.0.113.45</code>, and it will be added to the <code>nginx-sensitive</code> block list.</p>
<p>If you find that an IP has been mistakenly blocked, you can unblock it:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo fail2ban-client set nginx-sensitive unbanip 203.0.113.45</span><br></span></code></pre></div></div>
<p>After running this command, you can verify whether the IP has been removed from the block list by using:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo fail2ban-client status nginx-sensitive</span><br></span></code></pre></div></div>
<hr>
<p>Finally, you can check the firewall rules (<code>iptables</code> / <code>nftables</code>) to ensure they are correctly set.</p>
<p>Fail2ban primarily uses <code>iptables</code> (or <code>nftables</code>) to block IPs, so you can directly check the firewall rules:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">sudo iptables -L -n --line-numbers</span><br></span></code></pre></div></div>
<p>If the block rule is active, you should see something like:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">Chain f2b-nginx-sensitive (1 references)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">num  target     prot opt source               destination</span><br></span><span class=token-line style=color:#393A34><span class="token plain">1    REJECT     all  --  203.0.113.45          0.0.0.0/0   reject-with icmp-port-unreachable</span><br></span></code></pre></div></div>
<p>This indicates that <code>203.0.113.45</code> is blocked, and all traffic from this IP is being rejected.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=conclusion>Conclusion<a href=#conclusion class=hash-link aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>With this, we have completed the basic Fail2ban setup for Nginx, setting up defenses against common attacks.</p>
<p>Be sure to adjust the parameters according to your actual needs, such as splitting different types of attacks into separate jails, setting different <code>maxretry</code>/<code>findtime</code>, and carefully configuring the <code>ignoreip</code> whitelist to avoid mistakenly blocking critical IPs.</p>
<p>After deployment, it is important to continue monitoring Fail2ban logs to ensure it is functioning properly and effectively defending against malicious attacks.</div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col></div><div class="col lastUpdated_JAkA"><span class=theme-last-updated>Last updated<!-- --> on <b><time datetime=2025-02-28T01:10:00.000Z itemprop=dateModified>Feb 28, 2025</time></b> by <b>zephyr-sh</b></span></div></div><div style=margin-top:3rem> </div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/en/docs/nginx-notes/security><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Nginx Security</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/en/docs/nginx-notes/static-file-server><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Nginx Serving Static Resources</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#what-is-fail2ban class="table-of-contents__link toc-highlight">What is Fail2ban?</a><li><a href=#basic-fail2ban-configuration class="table-of-contents__link toc-highlight">Basic Fail2ban Configuration</a><li><a href=#monitoring-common-attack-types class="table-of-contents__link toc-highlight">Monitoring Common Attack Types</a><ul><li><a href=#preventing-malicious-crawlers class="table-of-contents__link toc-highlight">Preventing Malicious Crawlers</a><li><a href=#preventing-404-scan-attacks class="table-of-contents__link toc-highlight">Preventing 404 Scan Attacks</a><li><a href=#preventing-ddos-attacks class="table-of-contents__link toc-highlight">Preventing DDoS Attacks</a><li><a href=#preventing-brute-force-login-attacks class="table-of-contents__link toc-highlight">Preventing Brute Force Login Attacks</a><li><a href=#attempting-to-access-sensitive-data class="table-of-contents__link toc-highlight">Attempting to Access Sensitive Data</a><li><a href=#attacks-targeting-apis class="table-of-contents__link toc-highlight">Attacks Targeting APIs</a><li><a href=#apply-new-rules class="table-of-contents__link toc-highlight">Apply New Rules</a></ul><li><a href=#testing-defense-effectiveness class="table-of-contents__link toc-highlight">Testing Defense Effectiveness</a><ul><li><a href=#simulate-attacks-using-curl class="table-of-contents__link toc-highlight">Simulate Attacks Using <code>curl</code></a><li><a href=#verify-status-and-logs class="table-of-contents__link toc-highlight">Verify Status and Logs</a><li><a href=#unblocking-an-ip class="table-of-contents__link toc-highlight">Unblocking an IP</a></ul><li><a href=#conclusion class="table-of-contents__link toc-highlight">Conclusion</a></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class=footer__links><a class=footer__link-item href=/en/docs>Projects</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/papers/intro>Papers</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/blog>Blog</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/terms-of-service>TermsOfUse</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/privacy-policy>Privacy Policy</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/become-an-author>Become an author</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/worklog>Worklog</a></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2024 DOCSAID.</div></div></div></footer></div>