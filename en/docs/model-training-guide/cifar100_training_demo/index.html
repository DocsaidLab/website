<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-model-training-guide/cifar100_training_demo" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.8.1"><title data-rh=true>CIFAR-100 | DOCSAID</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:image content=https://docsaid.org/en/img/docsaid-social-card.jpg><meta data-rh=true name=twitter:image content=https://docsaid.org/en/img/docsaid-social-card.jpg><meta data-rh=true property=og:url content=https://docsaid.org/en/docs/model-training-guide/cifar100_training_demo><meta data-rh=true property=og:locale content=en><meta data-rh=true property=og:locale:alternate content=zh_hant><meta data-rh=true property=og:locale:alternate content=ja><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="CIFAR-100 | DOCSAID"><meta data-rh=true name=description content="Sleepless Nights of Overfitting"><meta data-rh=true property=og:description content="Sleepless Nights of Overfitting"><link data-rh=true rel=icon href=/en/img/favicon.ico><link data-rh=true rel=canonical href=https://docsaid.org/en/docs/model-training-guide/cifar100_training_demo><link data-rh=true rel=alternate href=https://docsaid.org/docs/model-training-guide/cifar100_training_demo hreflang=zh-hant><link data-rh=true rel=alternate href=https://docsaid.org/en/docs/model-training-guide/cifar100_training_demo hreflang=en><link data-rh=true rel=alternate href=https://docsaid.org/ja/docs/model-training-guide/cifar100_training_demo hreflang=ja><link data-rh=true rel=alternate href=https://docsaid.org/docs/model-training-guide/cifar100_training_demo hreflang=x-default><link data-rh=true rel=preconnect href=https://S9NC0RYCHF-dsn.algolia.net crossorigin=anonymous><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://docsaid.org/en/docs/model-training-guide/","name":"Model Training Guide","position":1},{"@type":"ListItem","item":"https://docsaid.org/en/docs/model-training-guide/cifar100_training_demo","name":"CIFAR-100","position":2}]}</script><link rel=alternate type=application/rss+xml href=/en/blog/rss.xml title="DOCSAID RSS Feed"><link rel=alternate type=application/atom+xml href=/en/blog/atom.xml title="DOCSAID Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-RDF83L9R4M"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-RDF83L9R4M",{anonymize_ip:!0})</script><link rel=search type=application/opensearchdescription+xml title=DOCSAID href=/en/opensearch.xml><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css type=text/css integrity=sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM crossorigin=anonymous><link rel=stylesheet href=/en/assets/css/styles.e52f1f88.css><script src=/en/assets/js/runtime~main.7c428b09.js defer></script><script src=/en/assets/js/main.a90830bf.js defer></script><body class=navigation-with-keyboard><svg xmlns=http://www.w3.org/2000/svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light",e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top navbarHideable_jvwV"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/en/><div class=navbar__logo><img src=/en/img/docsaid_logo.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/en/img/docsaid_logo_white.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/en/docs/>Projects</a><a class="navbar__item navbar__link" href=/en/papers/intro>Papers</a><a class="navbar__item navbar__link" href=/en/blog>Blog</a><a class="navbar__item navbar__link" href=/en/playground/intro>Playground</a><a class="navbar__item navbar__link" href=/en/services>Services</a><a class="navbar__item navbar__link" href=/en/aboutus>About Us</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg viewBox="0 0 24 24" width=20 height=20 aria-hidden=true class=iconLanguage_nlXk><path fill=currentColor d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>English</a><ul class=dropdown__menu><li><a href=/docs/model-training-guide/cifar100_training_demo target=_self rel="noopener noreferrer" class=dropdown__link lang=zh-hant>繁體中文</a><li><a href=/en/docs/model-training-guide/cifar100_training_demo target=_self rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=en>English</a><li><a href=/ja/docs/model-training-guide/cifar100_training_demo target=_self rel="noopener noreferrer" class=dropdown__link lang=ja>日本語</a></ul></div><div class=navbarSearchContainer_dCNk><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div><button type=button class="ant-btn css-mc1tut ant-btn-circle ant-btn-default ant-btn-color-default ant-btn-variant-outlined ant-btn-icon-only"><span class=ant-btn-icon><span role=img aria-label=user style=font-size:18px class="anticon anticon-user"><svg viewBox="64 64 896 896" focusable=false data-icon=user width=1em height=1em fill=currentColor aria-hidden=true><path d="M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"/></svg></span></span></button></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_eExm"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex=-1 class=sidebarLogo_isFc href=/en/><img src=/en/img/docsaid_logo.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/en/img/docsaid_logo_white.png alt="Docsaid Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"><b></b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/en/docs/>Open Source Projects</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/en/docs/model-training-guide/>Model Training Guide</a><button aria-label="Collapse sidebar category 'Model Training Guide'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/en/docs/model-training-guide/cifar100_training_demo>CIFAR-100</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/en/docs/model-training-guide/otter-style>Otter Style</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/autotraderx/>AutoTraderX</a><button aria-label="Expand sidebar category 'AutoTraderX'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/capybara/>Capybara</a><button aria-label="Expand sidebar category 'Capybara'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/docaligner/>DocAligner</a><button aria-label="Expand sidebar category 'DocAligner'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/docclassifier/>DocClassifier</a><button aria-label="Expand sidebar category 'DocClassifier'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/gmailsummary/>GmailSummary</a><button aria-label="Expand sidebar category 'GmailSummary'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/mrzscanner/>MRZScanner</a><button aria-label="Expand sidebar category 'MRZScanner'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/nginx-notes/>Nginx Notes</a><button aria-label="Expand sidebar category 'Nginx Notes'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/en/docs/wordcanvas/>WordCanvas</a><button aria-label="Expand sidebar category 'WordCanvas'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav><button type=button title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_kv0_><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/en/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/en/docs/model-training-guide/><span>Model Training Guide</span></a><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>CIFAR-100</span></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>CIFAR-100</h1></header>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=sleepless-nights-of-overfitting>Sleepless Nights of Overfitting<a href=#sleepless-nights-of-overfitting class=hash-link aria-label="Direct link to Sleepless Nights of Overfitting" title="Direct link to Sleepless Nights of Overfitting">​</a></h2>
<p>This project provides a concise PyTorch training example using the CIFAR-100 image classification task, allowing beginners to quickly get started. It also includes flexible adjustment and extension sample code, making it easier for you to adapt to different experimental needs.</p>
<p>Without further ado, let's get started.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>info</div><div class=admonitionContent_BuS1><p>The code for this project is available on GitHub: <a href=https://github.com/DocsaidLab/cifar100_training_demo target=_blank rel="noopener noreferrer"><strong>cifar100_training_demo</strong></a>.</div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=download-this-project>Download This Project<a href=#download-this-project class=hash-link aria-label="Direct link to Download This Project" title="Direct link to Download This Project">​</a></h2>
<p>The initial preparation is complete. Please use the following command to get the code:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">git clone https://github.com/DocsaidLab/cifar100-training-demo.git</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=build-the-training-environment-ubuntu-22042404>Build the Training Environment (Ubuntu 22.04/24.04)<a href=#build-the-training-environment-ubuntu-22042404 class=hash-link aria-label="Direct link to Build the Training Environment (Ubuntu 22.04/24.04)" title="Direct link to Build the Training Environment (Ubuntu 22.04/24.04)">​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>tip</div><div class=admonitionContent_BuS1><p><strong>Why Use Docker?</strong><ol>
<li><strong>Consistency</strong>: Ensures "it works on my machine, it works on yours."</li>
<li><strong>No Pollution</strong>: All dependencies are packaged inside the image, so it won't mess up your existing Python/conda setup.</li>
<li><strong>Easy Reproducibility</strong>: If something goes wrong, <code>docker rm</code> + <code>docker run</code> resets the entire environment instantly.
(If you are more familiar with venv/conda, you can set up the environment yourself; this project primarily uses Docker.)</li>
</ol></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=setting-up-docker-environment>Setting Up Docker Environment<a href=#setting-up-docker-environment class=hash-link aria-label="Direct link to Setting Up Docker Environment" title="Direct link to Setting Up Docker Environment">​</a></h3>
<p>This section is detailed in our basic toolbox project. Please refer to:</p>
<ul>
<li><a href=https://docsaid.org/en/docs/capybara/advance target=_blank rel="noopener noreferrer"><strong>Docsaid Capybara #Advanced</strong></a></li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=download-and-build-the-image>Download and Build the Image<a href=#download-and-build-the-image class=hash-link aria-label="Direct link to Download and Build the Image" title="Direct link to Download and Build the Image">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">cd cifar100-training-demo</span><br></span><span class=token-line style=color:#393A34><span class="token plain">bash docker/build.bash</span><br></span></code></pre></div></div>
<ul>
<li>Base image: <code>nvcr.io/nvidia/pytorch:25.03-py3</code></li>
<li>Version details: <a href=https://docs.nvidia.com/deeplearning/frameworks/pytorch-release-notes/rel-25-03.html#rel-25-03 target=_blank rel="noopener noreferrer"><strong>PyTorch Release 25.03</strong></a></li>
<li>The first build downloads about ~20 GB and takes roughly 5–20 minutes, depending on your internet speed.</li>
</ul>
<p>After completion, you can verify the image with:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">docker images | grep cifar100_train</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=constructing-the-dataset>Constructing the Dataset<a href=#constructing-the-dataset class=hash-link aria-label="Direct link to Constructing the Dataset" title="Direct link to Constructing the Dataset">​</a></h2>
<p>In PyTorch, the CIFAR-100 dataset is already built into <code>torchvision</code>, so we can use it directly:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>from</span><span class="token plain"> torchvision</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">datasets </span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> CIFAR100</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">train_dataset </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> CIFAR100</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">root</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>'data/'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> train</span><span class="token operator" style=color:#393A34>=</span><span class="token boolean" style=color:#36acaa>True</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> download</span><span class="token operator" style=color:#393A34>=</span><span class="token boolean" style=color:#36acaa>True</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">test_dataset </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> CIFAR100</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">root</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>'data/'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> train</span><span class="token operator" style=color:#393A34>=</span><span class="token boolean" style=color:#36acaa>False</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> download</span><span class="token operator" style=color:#393A34>=</span><span class="token boolean" style=color:#36acaa>True</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre></div></div>
<p>But wait!</p>
<p>Since this is for practice, why not try downloading and constructing the dataset yourself? This way, you can better control the data processing flow.</p>
<p>First, download the CIFAR-100 dataset from the official website and unzip it:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">wget https://www.cs.toronto.edu/\~kriz/cifar-100-python.tar.gz</span><br></span><span class=token-line style=color:#393A34><span class="token plain">tar xvf cifar-100-python.tar.gz</span><br></span></code></pre></div></div>
<p>After running this, you will see a folder named <code>cifar-100-python</code> in your working directory containing training and testing data.</p>
<p>The folder structure looks roughly like this:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">cifar-100-python/</span><br></span><span class=token-line style=color:#393A34><span class="token plain">├── train</span><br></span><span class=token-line style=color:#393A34><span class="token plain">├── test</span><br></span><span class=token-line style=color:#393A34><span class="token plain">├── meta</span><br></span><span class=token-line style=color:#393A34><span class="token plain">└── file.txt~</span><br></span></code></pre></div></div>
<p>These are not image files but Python pickle files packed for easy loading. Therefore, when using them, we need to load the data with the <code>pickle</code> module.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=writing-the-dataset-class>Writing the Dataset Class<a href=#writing-the-dataset-class class=hash-link aria-label="Direct link to Writing the Dataset Class" title="Direct link to Writing the Dataset Class">​</a></h2>
<p>Once you have the dataset, we need to write a PyTorch dataset class to read this data.</p>
<p>Here is a simple implementation of a <code>CIFAR100DatasetSimple</code> class:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> pickle</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> capybara </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> cb</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> numpy </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> np</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">DIR </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> cb</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">get_curdir</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">__file__</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>class</span><span class="token plain"> </span><span class="token class-name">CIFAR100DatasetSimple</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>__init__</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        self</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        root</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token operator" style=color:#393A34>=</span><span class="token boolean" style=color:#36acaa>None</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        mode</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>'train'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        image_size</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>32</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return_tensor</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token operator" style=color:#393A34>=</span><span class="token boolean" style=color:#36acaa>False</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        image_aug_ratio</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>0.5</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> mode </span><span class="token keyword" style=color:#00009f>not</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>in</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>'train'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'test'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>raise</span><span class="token plain"> ValueError</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"mode must be either 'train' or 'test'"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> root </span><span class="token keyword" style=color:#00009f>is</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>None</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">root </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> DIR </span><span class="token operator" style=color:#393A34>/</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'cifar-100-python'</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>else</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">root </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> root</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">image_size </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> image_size</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">return_tensor </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> return_tensor</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token comment" style=color:#999988;font-style:italic># Load data file</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string-interpolation string" style=color:#e3116c>f'</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>.</span><span class="token string-interpolation interpolation">root</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>}</span><span class="token string-interpolation string" style=color:#e3116c>/</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>{</span><span class="token string-interpolation interpolation">mode</span><span class="token string-interpolation interpolation punctuation" style=color:#393A34>}</span><span class="token string-interpolation string" style=color:#e3116c>'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'rb'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> f</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            data </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> pickle</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">load</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">f</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> encoding</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>'bytes'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">images </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> data</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>b'data'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">labels </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> data</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>b'fine_labels'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">filenames </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> data</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>b'filenames'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token comment" style=color:#999988;font-style:italic># reshape: (N, 3, 32, 32)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">images </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">images</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">reshape</span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>3</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>32</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>32</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>__len__</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">labels</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>__getitem__</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> idx</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        img </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">images</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">idx</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        label </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">labels</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">idx</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        img </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> np</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">transpose</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">img</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic># (C, H, W) -> (H, W, C)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        img </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> cb</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">imresize</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">img</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> size</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">image_size</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">return_tensor</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            img </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> np</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">transpose</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">img</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>2</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic># (H, W, C) -> (C, H, W)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            img </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> img</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">astype</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">np</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">float32</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>/</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>255.</span><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic># Simple normalization to [0, 1]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            label </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> np</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">array</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">label</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> dtype</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">np</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">int64</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> img</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> label</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> img</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> label</span><br></span></code></pre></div></div>
<p>This class has several features:</p>
<ol>
<li>You can specify the output image size (<code>image_size</code>), default is 32.</li>
<li>You can choose whether to convert images to PyTorch Tensor format (<code>return_tensor</code>).</li>
<li>You can specify the dataset mode (<code>mode</code>), either training (<code>train</code>) or testing (<code>test</code>).</li>
</ol>
<p>More complex features can be added later. For now, let's train the first baseline model.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=first-model-acc--4426>First Model: Acc = 44.26%<a href=#first-model-acc--4426 class=hash-link aria-label="Direct link to First Model: Acc = 44.26%" title="Direct link to First Model: Acc = 44.26%">​</a></h2>
<p>You can find some preset configuration files in the <code>config</code> folder. We use these config files to control the training process. The first config file we use is <code>resnet18_baseline.yaml</code>, which uses the well-known ResNet-18 as the base model.</p>
<p>Before training, go back to the parent directory:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">cd ..</span><br></span></code></pre></div></div>
<p>Then you can start training with the following command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">bash cifar100-training-demo/docker/train.bash resnet18_baseline</span><br></span></code></pre></div></div>
<p>Since this is the first model, let's take a close look at the parameter configuration.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=key-configuration-explanation>Key Configuration Explanation<a href=#key-configuration-explanation class=hash-link aria-label="Direct link to Key Configuration Explanation" title="Direct link to Key Configuration Explanation">​</a></h3>
<p>In <code>config/resnet18_baseline.yaml</code>, the main configurations are as follows:</p>
<ol>
<li>
<p><strong>Batch Size</strong>: Set to 250, which evenly divides the 50,000 training samples, simplifying the training cycle.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>tip</div><div class=admonitionContent_BuS1><p>Generally, we choose batch sizes that are multiples of 32 to better utilize GPU computing resources. However, since we are working with a small dataset, we can ignore this constraint and directly use 250. This way, each epoch only requires 200 iterations (50,000 / 250 = 200).</div></div>
</li>
<li>
<p><strong>Image Size</strong>: Set to 32, matching the original CIFAR-100 image size. Unless otherwise specified, this size will be used in subsequent experiments.</p>
</li>
<li>
<p><strong>Model Configuration</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>model</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> CIFAR100ModelBaseline</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>backbone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> Backbone</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>options</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> timm_resnet18</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>pretrained</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>False</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>features_only</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>True</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>head</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> Baseline</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>options</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>num_classes</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>100</span><br></span></code></pre></div></div>
<ul>
<li>Uses <code>timm_resnet18</code> without pretrained weights (<code>pretrained=False</code>), making it easier to understand the model’s learning process from scratch.</li>
<li>The <code>Baseline</code> head converts backbone outputs into predictions for 100 classes.</li>
</ul>
</li>
<li>
<p><strong>Training Epochs</strong>: Set to 200. Multiple trials showed minimal improvement beyond 200 epochs.</p>
</li>
<li>
<p><strong>Optimizer</strong>: Uses <code>AdamW</code> with a learning rate (<code>lr</code>) of 0.001, yielding relatively stable overall training performance.</p>
</li>
<li>
<p><strong>Weight Decay</strong>: Set to 0.0001; since the small model already has some inherent regularization, this value is moderately low.</p>
</li>
</ol>
<hr>
<p>Ultimately, this model reached 44.26% test accuracy at epoch 186.</p>
<p>However, the training accuracy already hit 100%, which is a classic sign of overfitting.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=adjusting-training-hyperparameters>Adjusting Training Hyperparameters<a href=#adjusting-training-hyperparameters class=hash-link aria-label="Direct link to Adjusting Training Hyperparameters" title="Direct link to Adjusting Training Hyperparameters">​</a></h2>
<p>“Overfitting” means the model memorizes the training data perfectly but fails to generalize to other data.</p>
<p>This phenomenon is especially common on small datasets like CIFAR-100 because of many classes but few samples; the model easily memorizes details instead of learning general rules.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=common-solutions-include>Common solutions include:<a href=#common-solutions-include class=hash-link aria-label="Direct link to Common solutions include:" title="Direct link to Common solutions include:">​</a></h3>
<ol>
<li><strong>Reducing Model Capacity</strong>: Use a smaller model to lower the risk of overfitting.</li>
<li><strong>Data Augmentation</strong>: Random cropping, flipping, brightness adjustment, etc., so the model sees more diverse images and improves generalization.</li>
<li><strong>Regularization</strong>: Apply Dropout, Weight Decay, and other techniques to keep the model “restrained” during learning.</li>
<li><strong>Early Stopping</strong>: Stop training early when validation accuracy stops improving to avoid overfitting.</li>
<li><strong>Using Pretrained Models</strong>: If allowed, fine-tune models pretrained on large datasets (e.g., ImageNet) instead of training from scratch.</li>
<li><strong>Adjust Learning Rate and Batch Size</strong>: Both overly high or low learning rates and batch sizes can destabilize training.</li>
</ol>
<hr>
<p>We won’t discuss Early Stopping here; we simply run all 200 epochs and report the best score.</p>
<p>Data augmentation is a common technique, so let’s try that next.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=data-augmentation-acc--3648>Data Augmentation: Acc = 36.48%<a href=#data-augmentation-acc--3648 class=hash-link aria-label="Direct link to Data Augmentation: Acc = 36.48%" title="Direct link to Data Augmentation: Acc = 36.48%">​</a></h2>
<p>We try improving the model’s generalization using data augmentation.</p>
<p>Here we introduce the <code>albumentations</code> library and apply some basic augmentations:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>import</span><span class="token plain"> albumentations </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> A</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>class</span><span class="token plain"> </span><span class="token class-name">DefaultImageAug</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>__init__</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> p</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>0.5</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">aug </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> A</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">OneOf</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            A</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">ShiftScaleRotate</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            A</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">CoarseDropout</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            A</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">ColorJitter</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            A</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">HorizontalFlip</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            A</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">VerticalFlip</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> p</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">p</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>__call__</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> img</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> np</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">ndarray</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        img </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">aug</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">image</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">img</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>'image'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> img</span><br></span></code></pre></div></div>
<p>The selected augmentations include:</p>
<ul>
<li><strong>ShiftScaleRotate</strong>: Randomly translate, scale, and rotate the image.</li>
<li><strong>CoarseDropout</strong>: Randomly mask parts of the image to simulate missing data.</li>
<li><strong>ColorJitter</strong>: Randomly adjust brightness, contrast, and saturation.</li>
<li><strong>HorizontalFlip</strong>: Random horizontal flip.</li>
<li><strong>VerticalFlip</strong>: Random vertical flip.</li>
</ul>
<p>Experience shows these augmentations effectively improve model generalization.</p>
<p>Then, we add this augmentation to <code>config/resnet18_augment.yaml</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>dataset</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>train_options</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> CIFAR100AugDataset</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>options</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>mode</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> train</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>return_tensor</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>True</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>image_aug_ratio</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1.0</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>valid_options</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> CIFAR100AugDataset</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>options</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>mode</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> test</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>return_tensor</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>True</span><br></span></code></pre></div></div>
<p>However, the result was disappointing.</p>
<p>The test accuracy dropped to only 36.48%, much lower than the previous 44.26%.</p>
<p>This is because, for low-resolution 32×32 images like CIFAR-100, applying too strong augmentations at once (e.g., ±45° rotation, large occlusions, or vertical flips) severely distorts the original semantics, preventing the model from stably learning basic features.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=strong-regularization-acc--4012>Strong Regularization: Acc = 40.12%<a href=#strong-regularization-acc--4012 class=hash-link aria-label="Direct link to Strong Regularization: Acc = 40.12%" title="Direct link to Strong Regularization: Acc = 40.12%">​</a></h2>
<p>Next, we try improving generalization via regularization.</p>
<p>Generally, CNNs already have some built-in regularization due to convolution’s translation invariance and parameter sharing. Compared to Transformers, which tend to overfit early in training, CNNs usually don’t require strong extra regularization.</p>
<p>Still, we give it a try.</p>
<p>We increase <code>weight_decay</code> to 0.1 to observe its effect on learning and generalization.</p>
<p>In <code>config/resnet18_baseline_wd01.yaml</code>, modify <code>weight_decay</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>optimizer</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> AdamW</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>options</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>lr</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0.001</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>betas</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>0.9</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0.999</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>weight_decay</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0.1</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>amsgrad</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>False</span><br></span></code></pre></div></div>
<p>As expected, test accuracy dropped to 40.12%, below the original 44.26%.</p>
<p>This reflects a common phenomenon:</p>
<ul>
<li>For small datasets like CIFAR-100, overly strong regularization can suppress the model’s ability to fit the training distribution sufficiently, causing it to converge prematurely before learning discriminative features, ultimately hurting generalization.</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=label-smoothing-acc--4481>Label Smoothing: Acc = 44.81%<a href=#label-smoothing-acc--4481 class=hash-link aria-label="Direct link to Label Smoothing: Acc = 44.81%" title="Direct link to Label Smoothing: Acc = 44.81%">​</a></h2>
<p>Now we try Label Smoothing to improve generalization.</p>
<p>Label Smoothing converts one-hot class labels into smoothed distributions to reduce overfitting.</p>
<p>We configure this in <code>config/resnet18_baseline_lbsmooth.yaml</code>:</p>
<p>It’s simple to use—just add <code>label_smoothing</code> to the loss function:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">loss_fn </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> nn</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">CrossEntropyLoss</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">label_smoothing</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>0.1</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre></div></div>
<p>Experiment results show the model reached 44.81% test accuracy at epoch 59, surpassing the previous 44.26%, and achieving this accuracy more than 100 epochs earlier.</p>
<p>This shows Label Smoothing effectively reduces overfitting and improves generalization for this task.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=ultimately-data-is-still-insufficient>Ultimately, Data Is Still Insufficient<a href=#ultimately-data-is-still-insufficient class=hash-link aria-label="Direct link to Ultimately, Data Is Still Insufficient" title="Direct link to Ultimately, Data Is Still Insufficient">​</a></h2>
<p>By this point in the experiments, we can draw a realistic conclusion:</p>
<blockquote>
<p><strong>Some problems cannot be solved by model design or hyperparameter tuning alone.</strong></p>
</blockquote>
<p>Take CIFAR-100 as an example: although it has a decent number of samples, the resolution is low, semantic information is sparse, and each class has limited samples. These data characteristics make it difficult for the model to learn discriminative features with strong generalization ability.</p>
<p>From a practical perspective, the most direct solution is: <strong>increase the data.</strong></p>
<p>However, data collection is often a costly endeavor.</p>
<p>In many application scenarios, data is hard to obtain, and labeling is time-consuming and labor-intensive. This has long been a core bottleneck for deep learning deployment. Therefore, a more common and pragmatic choice in practice is: <strong>Transfer Learning</strong>.</p>
<p>Through transfer learning, we do not need to train a model from scratch. Instead, we leverage models pretrained on large-scale datasets (such as ImageNet) as backbones, then fine-tune them on the target task.</p>
<p>This strategy has multiple advantages:</p>
<ul>
<li><strong>Faster Convergence</strong>: Initial weights already contain semantic features, helping the model quickly find a learning direction.</li>
<li><strong>Improved Performance</strong>: Even with limited target data, the model can fully utilize general representations.</li>
<li><strong>Reduced Overfitting</strong>: Pretrained models provide a stable starting point, resulting in better generalization.</li>
</ul>
<p>Next, we will test using pretrained models provided by <code>timm</code> to see how this works in practice.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>info</div><div class=admonitionContent_BuS1><p><strong>What is timm?</strong><p>This package is well-known in the deep learning community.<p><code>timm</code> is a PyTorch model library that offers a large collection of pretrained models and utilities, enabling users to quickly implement various deep learning tasks. It includes many state-of-the-art model architectures and training techniques, especially suitable for image classification, object detection, and related tasks.<ul>
<li><a href=https://github.com/huggingface/pytorch-image-models target=_blank rel="noopener noreferrer"><strong>Timm GitHub</strong></a></li>
</ul></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=pretrained-weights-acc--5670>Pretrained Weights: Acc = 56.70%<a href=#pretrained-weights-acc--5670 class=hash-link aria-label="Direct link to Pretrained Weights: Acc = 56.70%" title="Direct link to Pretrained Weights: Acc = 56.70%">​</a></h2>
<p>Continuing from the Baseline settings, we temporarily avoid using <code>label_smoothing</code> or other regularization techniques, focusing solely on the backbone’s pretrained weights.</p>
<p>This time, we use the <code>resnet18_pretrained.yaml</code> configuration file, where the main adjustment is in the backbone section by setting <code>pretrained</code> to <code>True</code> to enable ImageNet pretrained weights.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>model</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> CIFAR100ModelBaseline</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>backbone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> Backbone</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>options</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> timm_resnet18</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>pretrained</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>True</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>features_only</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>True</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>head</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> Baseline</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>options</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>num_classes</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>100</span><br></span></code></pre></div></div>
<p>At epoch 112, the model achieved 56.70% accuracy on the test set, an improvement of <strong>12.44%</strong> compared to the original 44.26%.</p>
<p>This is a significant effect and more effective than all previous hyperparameter tuning tricks!</p>
<p>However, transfer learning is not a panacea. When the pretrained data and target task differ greatly, the model may fail to transfer effectively and even cause so-called "<strong>Negative Transfer</strong>." For example, applying an image pretrained model to natural language tasks yields almost no positive benefit.</p>
<p>In our case, CIFAR-100 is a standard image classification task closely related to ImageNet’s context, so transfer learning performs quite well.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=margin-loss-acc--5792>Margin Loss: Acc = 57.92%<a href=#margin-loss-acc--5792 class=hash-link aria-label="Direct link to Margin Loss: Acc = 57.92%" title="Direct link to Margin Loss: Acc = 57.92%">​</a></h2>
<p>At this point, our strategy must shift.</p>
<p>If relying on the conventional cross-entropy loss no longer improves accuracy, we can try <strong>actively increasing training difficulty</strong> to force the model to learn more discriminative feature representations. This is exactly the problem Margin Loss addresses.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=why-margin>Why Margin?<a href=#why-margin class=hash-link aria-label="Direct link to Why Margin?" title="Direct link to Why Margin?">​</a></h3>
<p>In traditional classification, cross-entropy encourages the model to raise the logit score of the correct class but <strong>does not enforce a sufficient margin (gap) between the correct and incorrect class scores</strong>. In other words, as long as the correct class is highest, it doesn’t matter by how much.</p>
<p>While sufficient for classification, this design often leads to ambiguous decision boundaries and unstable generalization when samples are close, data noisy, or classes similar.</p>
<p>Margin Loss is designed to solve this:</p>
<blockquote>
<p><strong>Not only be correct, but be confidently correct.</strong></p>
</blockquote>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=what-is-margin-loss>What is Margin Loss?<a href=#what-is-margin-loss class=hash-link aria-label="Direct link to What is Margin Loss?" title="Direct link to What is Margin Loss?">​</a></h3>
<p>The core idea of Margin Loss is:</p>
<blockquote>
<p><strong>In logit or feature space, increase the distance between positive and negative samples while reducing intra-class variance.</strong></p>
</blockquote>
<p>Common Margin Losses include:</p>
<ul>
<li><strong>Large Margin Softmax (L-Softmax)</strong></li>
<li><strong>ArcFace / CosFace / SphereFace</strong></li>
<li><strong>Triplet Loss / Contrastive Loss</strong></li>
</ul>
<p>These methods typically add an angular or magnitude margin before softmax, encouraging embeddings with clearer class boundaries. Below is a conceptual illustration of angular margin:</p>
<p><img decoding=async loading=lazy alt=margin_loss src=/en/assets/images/margin_loss-b283f3b59c90cefaf835e28158d95e28.jpg width=1224 height=344 class=img_ev3q></p>
<p>The figure shows Margin Loss pulling features of the same class closer and pushing different classes farther apart, improving classification confidence and stability.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=relation-to-geometric-space>Relation to Geometric Space<a href=#relation-to-geometric-space class=hash-link aria-label="Direct link to Relation to Geometric Space" title="Direct link to Relation to Geometric Space">​</a></h3>
<p>When implementing these losses, features are often projected onto a unit hypersphere by applying L2 normalization, constraining embeddings to lie on a sphere of radius 1.</p>
<p>Benefits include:</p>
<ul>
<li><strong>Removing feature length interference to focus on direction (angle)</strong></li>
<li><strong>Easier to control margin’s effect on angle</strong></li>
<li><strong>Mathematically converting classification to an angular classification problem</strong></li>
</ul>
<p>Hence, many Margin-based methods apply margin on cosine similarity rather than raw logits.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=experimental-results>Experimental Results<a href=#experimental-results class=hash-link aria-label="Direct link to Experimental Results" title="Direct link to Experimental Results">​</a></h3>
<p>Using the pretrained ResNet-18 backbone, we add Margin Loss settings in <code>config/resnet18_pretrained_arcface.yaml</code>.</p>
<p>We tested two implementations, <code>ArcFace</code> and <code>CosFace</code>, with different margin settings.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>class</span><span class="token plain"> </span><span class="token class-name">ArcFace</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">nn</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Module</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>__init__</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> s</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>64.0</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> m</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>0.5</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token builtin">super</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">ArcFace</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> self</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">__init__</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">s </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> s</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">margin </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> m</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">cos_m </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> math</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">cos</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">m</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">sin_m </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> math</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">sin</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">m</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">theta </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> math</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">cos</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">math</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">pi </span><span class="token operator" style=color:#393A34>-</span><span class="token plain"> m</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">sinmm </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> math</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">sin</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">math</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">pi </span><span class="token operator" style=color:#393A34>-</span><span class="token plain"> m</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> m</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">easy_margin </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>False</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>forward</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> logits</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Tensor</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> labels</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Tensor</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        index </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">where</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">labels </span><span class="token operator" style=color:#393A34>!=</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        target_logit </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> logits</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">index</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> labels</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">index</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">view</span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>with</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">no_grad</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            target_logit</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">arccos_</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            logits</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">arccos_</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            final_target_logit </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> target_logit </span><span class="token operator" style=color:#393A34>+</span><span class="token plain"> self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">margin</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            logits</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">index</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> labels</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">index</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">view</span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> final_target_logit</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            logits</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">cos_</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        logits </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> logits </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">s</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> logits</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>class</span><span class="token plain"> </span><span class="token class-name">CosFace</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">nn</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Module</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>__init__</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> s</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>64.0</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> m</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>0.40</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token builtin">super</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">CosFace</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> self</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">__init__</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">s </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> s</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">m </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> m</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>def</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>forward</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">self</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> logits</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Tensor</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> labels</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Tensor</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        index </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> torch</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">where</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">labels </span><span class="token operator" style=color:#393A34>!=</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        logits</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">index</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> labels</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">index</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">view</span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>-=</span><span class="token plain"> self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">m</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        logits </span><span class="token operator" style=color:#393A34>*=</span><span class="token plain"> self</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">s</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> logits</span><br></span></code></pre></div></div>
<p>After several experiments, we found little difference in performance between them, but ArcFace scored slightly higher.</p>
<p>Therefore, we report ArcFace results: at epoch 199, the model achieved 57.92% accuracy on the test set. This is a 1.22% improvement over the standard Softmax loss.</p>
<p>This shows Margin Loss has real value in enhancing the model’s discriminative power, especially when classes are similar, effectively reducing overfitting and improving generalization.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=enlarged-input-images-acc--7957>Enlarged Input Images: Acc = 79.57%<a href=#enlarged-input-images-acc--7957 class=hash-link aria-label="Direct link to Enlarged Input Images: Acc = 79.57%" title="Direct link to Enlarged Input Images: Acc = 79.57%">​</a></h2>
<p>Maintaining the Margin Loss settings, we next try enlarging the input image size to see if accuracy can be further improved.</p>
<p>In <code>config/resnet18_pretrained_arcface_224x224.yaml</code>, we set <code>image_size</code> to 224:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>global_settings</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>image_size</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>224</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>224</span><span class="token punctuation" style=color:#393A34>]</span><br></span></code></pre></div></div>
<p>With larger input images, the test set accuracy reached a peak of 79.57% at epoch 29, improving <strong>21.65%</strong> over the previous 57.92%.</p>
<p>This result is surprising:</p>
<ul>
<li><strong>Simply enlarging the original <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mn>32</mn><mo>×</mo><mn>32</mn></mrow><annotation encoding=application/x-tex>32 \times 32</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.7278em;vertical-align:-0.0833em></span><span class=mord>32</span><span class=mspace style=margin-right:0.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:0.2222em></span></span><span class=base><span class=strut style=height:0.6444em></span><span class=mord>32</span></span></span></span> images to <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mn>224</mn><mo>×</mo><mn>224</mn></mrow><annotation encoding=application/x-tex>224 \times 224</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.7278em;vertical-align:-0.0833em></span><span class=mord>224</span><span class=mspace style=margin-right:0.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:0.2222em></span></span><span class=base><span class=strut style=height:0.6444em></span><span class=mord>224</span></span></span></span> can greatly boost model performance?</strong></li>
</ul>
<p>Reasons include:</p>
<ol>
<li>
<p><strong>Resolution Aligned with Pretraining Habits</strong></p>
<p>ResNet-50 and most ImageNet models are pretrained on <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mn>224</mn><mo>×</mo><mn>224</mn></mrow><annotation encoding=application/x-tex>224 \times 224</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.7278em;vertical-align:-0.0833em></span><span class=mord>224</span><span class=mspace style=margin-right:0.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:0.2222em></span></span><span class=base><span class=strut style=height:0.6444em></span><span class=mord>224</span></span></span></span> inputs. Feeding <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mn>32</mn><mo>×</mo><mn>32</mn></mrow><annotation encoding=application/x-tex>32 \times 32</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.7278em;vertical-align:-0.0833em></span><span class=mord>32</span><span class=mspace style=margin-right:0.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:0.2222em></span></span><span class=base><span class=strut style=height:0.6444em></span><span class=mord>32</span></span></span></span> directly means convolution kernels “see through” the entire image at once, compressing hierarchical features and making details indistinguishable. Enlarging resolution lets convolutions extract textures and local structures at appropriate receptive fields.</p>
</li>
<li>
<p><strong>Spatial Sampling Points Greatly Increase</strong></p>
<p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msup><mn>32</mn><mn>2</mn></msup></mrow><annotation encoding=application/x-tex>32^2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.8141em></span><span class=mord>3</span><span class=mord><span class=mord>2</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:0.8141em><span style=top:-3.063em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> → <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msup><mn>224</mn><mn>2</mn></msup></mrow><annotation encoding=application/x-tex>224^2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.8141em></span><span class=mord>22</span><span class=mord><span class=mord>4</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:0.8141em><span style=top:-3.063em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> means a <strong>49-fold</strong> increase in pixels. Even after bilinear interpolation smoothing, the model captures more edges, textures, and color distributions, enhancing discriminative signals.</p>
</li>
<li>
<p><strong>Avoid Early Signal Distortion and Aliasing</strong></p>
<p>At low resolution, object details are averaged out by multiple stride/pooling layers; enlarging images preserves key features before downsampling. Higher resolution reduces improper folding of high-frequency signals caused by convolution strides, maintaining feature stability.</p>
</li>
</ol>
<hr>
<p>Although accuracy significantly improves, some issues remain.</p>
<p>First, computation greatly increases: training time rises from about 3 minutes to roughly 2 hours (on RTX 4090).</p>
<p>Second, the model reaches about 80% accuracy within the first 30 epochs, indicating it learns most features early on. Subsequent gains are minor, suggesting the dataset information is largely exhausted, and further hundreds of epochs yield little new value.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=enlarged-model-capacity-acc--6176>Enlarged Model Capacity: Acc = 61.76%<a href=#enlarged-model-capacity-acc--6176 class=hash-link aria-label="Direct link to Enlarged Model Capacity: Acc = 61.76%" title="Direct link to Enlarged Model Capacity: Acc = 61.76%">​</a></h2>
<p>What if we keep the input image size the same but increase the model capacity?</p>
<p>Generally, larger models can theoretically learn richer features but are also more prone to overfitting.</p>
<p>Since we introduced Margin Loss earlier, which should reduce overfitting risk, we can try increasing the model capacity. Here, we use the <code>resnet50_pretrained_arcface.yaml</code> config, changing the backbone to ResNet-50 while keeping the input image size at 32×32.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>model</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> CIFAR100ModelMargin</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>backbone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> Backbone</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>options</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> timm_resnet50</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>pretrained</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>True</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>features_only</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>True</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>head</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> MarginHead</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>options</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>hid_dim</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>512</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>num_classes</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>100</span><br></span></code></pre></div></div>
<p>Training results show that at epoch 199, the model reached 61.76% test accuracy—an improvement of 3.84% over the previous 57.92%—at the cost of nearly doubling the number of parameters.</p>
<p>This suggests that when input size cannot be increased, enlarging model capacity still effectively boosts performance, especially with Margin Loss helping the model better learn class boundaries.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=enlarged-input-image-acc--8121>Enlarged Input Image: Acc = 81.21%<a href=#enlarged-input-image-acc--8121 class=hash-link aria-label="Direct link to Enlarged Input Image: Acc = 81.21%" title="Direct link to Enlarged Input Image: Acc = 81.21%">​</a></h2>
<p>Finally, we enlarged both the model and the input image size to see if further gains are possible.</p>
<p>In <code>config/resnet50_pretrained_arcface_224x224.yaml</code>, we set <code>image_size</code> to 224:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>global_settings</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>image_size</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>224</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>224</span><span class="token punctuation" style=color:#393A34>]</span><br></span></code></pre></div></div>
<p>With larger input images, the model reached over 80% accuracy within the first five epochs, ultimately achieving 81.21% test accuracy at epoch 174.</p>
<p>This is close to the ResNet-18 + 224×224 result but with nearly double the parameters. Evidently, this dataset has reached a saturation point where increasing model capacity no longer brings significant performance gains.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=knowledge-distillation-acc--5737>Knowledge Distillation: Acc = 57.37%<a href=#knowledge-distillation-acc--5737 class=hash-link aria-label="Direct link to Knowledge Distillation: Acc = 57.37%" title="Direct link to Knowledge Distillation: Acc = 57.37%">​</a></h2>
<p>Keeping ResNet-18 and input size at 32×32, to further improve performance, knowledge distillation (KD) can be applied to transfer the discriminative ability learned by a large teacher model trained at high resolution to a lightweight student model.</p>
<p>The core idea is to use the teacher model’s learned knowledge during training to guide the student model, improving its generalization and convergence efficiency.</p>
<p>Unlike traditional supervised learning, KD not only relies on hard labels (ground truth) but also uses the teacher’s output probability distributions (soft labels) as additional supervision. These soft labels encode relative relationships between classes, helping the student learn a more discriminative feature space.</p>
<p>The distillation loss is defined as:</p>
<span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><msub><mi mathvariant=script>L</mi><mtext>distill</mtext></msub><mo>=</mo><mo stretchy=false>(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy=false>)</mo><mtext> </mtext><msub><mi mathvariant=script>L</mi><mtext>CE</mtext></msub><mo stretchy=false>(</mo><mi>y</mi><mo separator=true>,</mo><msub><mi>p</mi><mi>s</mi></msub><mo stretchy=false>)</mo><mo>+</mo><mi>α</mi><msup><mi>T</mi><mn>2</mn></msup><mo>⋅</mo><mrow><mi mathvariant=normal>K</mi><mi mathvariant=normal>L</mi></mrow><mo stretchy=false>(</mo><msubsup><mi>p</mi><mi>t</mi><mrow><mo stretchy=false>(</mo><mi>T</mi><mo stretchy=false>)</mo></mrow></msubsup><mtext> </mtext><mi mathvariant=normal>∣</mi><mi mathvariant=normal>∣</mi><mtext> </mtext><msubsup><mi>p</mi><mi>s</mi><mrow><mo stretchy=false>(</mo><mi>T</mi><mo stretchy=false>)</mo></mrow></msubsup><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>\mathcal{L}_{\text{distill}} = (1 - \alpha)\,\mathcal{L}_{\text{CE}}(y, p_s) + \alpha T^2 \cdot \mathrm{KL}(p_t^{(T)} \,||\, p_s^{(T)})</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.8333em;vertical-align:-0.15em></span><span class=mord><span class="mord mathcal">L</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3361em><span style=top:-2.55em;margin-left:0em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">distill</span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:0.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:0.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-0.25em></span><span class=mopen>(</span><span class=mord>1</span><span class=mspace style=margin-right:0.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:0.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-0.25em></span><span class="mord mathnormal" style=margin-right:0.0037em>α</span><span class=mclose>)</span><span class=mspace style=margin-right:0.1667em></span><span class=mord><span class="mord mathcal">L</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3283em><span style=top:-2.55em;margin-left:0em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">CE</span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em><span></span></span></span></span></span></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:0.03588em>y</span><span class=mpunct>,</span><span class=mspace style=margin-right:0.1667em></span><span class=mord><span class="mord mathnormal">p</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.1514em><span style=top:-2.55em;margin-left:0em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em><span></span></span></span></span></span></span><span class=mclose>)</span><span class=mspace style=margin-right:0.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:0.2222em></span></span><span class=base><span class=strut style=height:0.8641em></span><span class="mord mathnormal" style=margin-right:0.0037em>α</span><span class=mord><span class="mord mathnormal" style=margin-right:0.13889em>T</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:0.8641em><span style=top:-3.113em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace style=margin-right:0.2222em></span><span class=mbin>⋅</span><span class=mspace style=margin-right:0.2222em></span></span><span class=base><span class=strut style=height:1.2948em;vertical-align:-0.25em></span><span class=mord><span class="mord mathrm">KL</span></span><span class=mopen>(</span><span class=mord><span class="mord mathnormal">p</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.0448em><span style=top:-2.4542em;margin-left:0em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span><span style=top:-3.2198em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style=margin-right:0.13889em>T</span><span class="mclose mtight">)</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.2458em><span></span></span></span></span></span></span><span class=mspace style=margin-right:0.1667em></span><span class=mord>∣∣</span><span class=mspace style=margin-right:0.1667em></span><span class=mord><span class="mord mathnormal">p</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.938em><span style=top:-2.453em;margin-left:0em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span><span style=top:-3.113em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style=margin-right:0.13889em>T</span><span class="mclose mtight">)</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.247em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span></span>
<ul>
<li><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi mathvariant=script>L</mi><mtext>CE</mtext></msub></mrow><annotation encoding=application/x-tex>\mathcal{L}_{\text{CE}}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.8333em;vertical-align:-0.15em></span><span class=mord><span class="mord mathcal">L</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3283em><span style=top:-2.55em;margin-left:0em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">CE</span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em><span></span></span></span></span></span></span></span></span></span>: Cross-entropy loss between student predictions and true labels.</li>
<li><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi mathvariant=normal>K</mi><mi mathvariant=normal>L</mi></mrow><annotation encoding=application/x-tex>\mathrm{KL}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.6833em></span><span class=mord><span class="mord mathrm">KL</span></span></span></span></span>: Kullback–Leibler divergence between teacher and student probability distributions at temperature <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.6833em></span><span class="mord mathnormal" style=margin-right:0.13889em>T</span></span></span></span>.</li>
<li><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>α</mi></mrow><annotation encoding=application/x-tex>\alpha</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.4306em></span><span class="mord mathnormal" style=margin-right:0.0037em>α</span></span></span></span>: Balancing factor between true labels and distillation signal (commonly 0.5–0.9).</li>
<li><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.6833em></span><span class="mord mathnormal" style=margin-right:0.13889em>T</span></span></span></span>: Temperature parameter, which smooths logits to highlight inter-class differences.</li>
</ul>
<hr>
<p>In this experiment, the teacher model is a ResNet-50 pretrained and trained on 224×224 inputs, and the student model is ResNet-18 with the original CIFAR-100 size 32×32. The teacher is frozen during training, providing soft labels as auxiliary supervision only.</p>
<p>Training architecture and flow:</p>
<div align=center><figure style=width:60%><p><img decoding=async loading=lazy alt=teacher-student src=/en/assets/images/teacher_student-679db074dcb29b820f92030ae5b29e21.jpg width=2177 height=1521 class=img_ev3q></figure></div>
<ol>
<li>Pretrain the teacher model and obtain its logit outputs.</li>
<li>Apply softmax with temperature on both teacher and student logits to get soft labels.</li>
<li>Train the student model using the KD loss.</li>
<li>During deployment, only keep the student model; the teacher is not involved.</li>
</ol>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=experimental-results-1>Experimental Results<a href=#experimental-results-1 class=hash-link aria-label="Direct link to Experimental Results" title="Direct link to Experimental Results">​</a></h3>
<p>In <code>config/resnet18_pretrained_arcface_kd.yaml</code>, KD parameters are set. We load the pretrained ResNet-50 teacher model trained with 224×224 inputs:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>common</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>batch_size</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>250</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>image_size</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>32</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>32</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>is_restore</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>True</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>restore_ind</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"2025-05-26-00-49-22"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>restore_ckpt</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"epoch=177-step=35600.ckpt"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>preview_batch</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1000</span><br></span></code></pre></div></div>
<p>Results show accuracy around 57.37%, similar to Margin Loss baseline.</p>
<p>The teacher model was not as helpful as expected on this dataset.</p>
<p>Possible reasons include:</p>
<ol>
<li><strong>Insufficient Student Capacity</strong>: ResNet-18’s representational space is much smaller than ResNet-50’s, and mimicking the teacher’s fine-grained decision boundaries may be too challenging.</li>
<li><strong>Input Resolution Gap</strong>: The teacher was trained on 224×224 inputs, but the student only sees 32×32, making it hard for the student to capture teacher-learned features.</li>
</ol>
<p>There may be other factors, but these two are the main considerations.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=experiment-and-results-summary>Experiment and Results Summary<a href=#experiment-and-results-summary class=hash-link aria-label="Direct link to Experiment and Results Summary" title="Direct link to Experiment and Results Summary">​</a></h2>
<p>Below is a table summarizing each experiment’s configuration and final accuracy on the CIFAR-100 test set:</p>
<div style=white-space:nowrap;overflow-x:auto;font-size:1rem;line-height:0.8;justify-content:center;display:flex><table><thead><tr><th>Config File<th>Accuracy<th>Description<tbody><tr><td><code>resnet18_baseline.yaml</code><td>44.26%<td>ResNet-18, no pretraining, AdamW (lr=0.001), WD=0.0001<tr><td><code>resnet18_augment.yaml</code><td>36.48%<td>Added Albumentations data augmentation (rotation, dropout, flips)<tr><td><code>resnet18_baseline_wd01.yaml</code><td>40.12%<td>ResNet-18, no pretraining, weight decay set to 0.1<tr><td><code>resnet18_baseline_lbsmooth.yaml</code><td>44.81%<td>ResNet-18, no pretraining, label smoothing=0.1<tr><td><code>resnet18_pretrained.yaml</code><td>56.70%<td>ResNet-18, <strong>with ImageNet pretrained weights</strong><tr><td><code>resnet18_pretrained_arcface.yaml</code><td>57.92%<td>ResNet-18 pretrained + Margin Loss (ArcFace)<tr><td><code>resnet18_pretrained_arcface_224x224.yaml</code><td>79.57%<td>ResNet-18 pretrained + Margin Loss, input enlarged to 224 × 224<tr><td><code>resnet50_pretrained_arcface.yaml</code><td>61.76%<td>ResNet-50 pretrained + Margin Loss, input size remains 32 × 32<tr><td><code>resnet50_pretrained_arcface_224x224.yaml</code><td>81.21%<td>ResNet-50 pretrained + Margin Loss, 224 × 224 input<tr><td><code>resnet18_pretrained_arcface_kd.yaml</code><td>57.37%<td>Knowledge Distillation (Teacher: ResNet-50 224 × 224; Student: ResNet-18 32 × 32)</table></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=and-more>And More<a href=#and-more class=hash-link aria-label="Direct link to And More" title="Direct link to And More">​</a></h2>
<p>So far, we focused on experiments based on ResNet-18 with fixed input size 32×32.</p>
<p>However, improving CIFAR-100 accuracy is not limited to these approaches. In fact, the <a href=https://paperswithcode.com/sota/image-classification-on-cifar-100 target=_blank rel="noopener noreferrer">Paper with Code</a> leaderboard shows top CIFAR-100 results exceeding 96%.</p>
<p>These models often combine several strategies such as:</p>
<ul>
<li>Using large-scale Vision Transformer (ViT) architectures or custom CNNs</li>
<li>High-resolution inputs</li>
<li>Pretrained transfer learning and advanced augmentation techniques (e.g., RandAugment, MixUp, CutMix)</li>
<li>Longer training schedules with Cosine Annealing or One-Cycle learning rate policies</li>
<li>Modern regularization methods like Label Smoothing and Sharpness-Aware Minimization</li>
<li>Multi-model distillation and ensemble methods for final inference</li>
</ul>
<p>These techniques may not be feasible for every development scenario, especially in resource-constrained deployments. But one clear takeaway is:</p>
<blockquote>
<p><strong>Performance limits stem from the overall training strategy design, not just the model itself.</strong></p>
</blockquote>
<p>If you are also using CIFAR-100 for experiments, don’t hesitate to try different architectures and strategy combinations.</p>
<p>Finally, wishing you great success and joy on your deep learning journey!</div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col></div><div class="col lastUpdated_JAkA"><span class=theme-last-updated>Last updated<!-- --> on <b><time datetime=2025-07-17T01:41:49.000Z itemprop=dateModified>Jul 17, 2025</time></b> by <b>zephyr-sh</b></span></div></div><div style=margin-top:3rem> </div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/en/docs/model-training-guide/><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Model Training Guide</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/en/docs/model-training-guide/otter-style><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Otter Style</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#sleepless-nights-of-overfitting class="table-of-contents__link toc-highlight">Sleepless Nights of Overfitting</a><li><a href=#download-this-project class="table-of-contents__link toc-highlight">Download This Project</a><li><a href=#build-the-training-environment-ubuntu-22042404 class="table-of-contents__link toc-highlight">Build the Training Environment (Ubuntu 22.04/24.04)</a><ul><li><a href=#setting-up-docker-environment class="table-of-contents__link toc-highlight">Setting Up Docker Environment</a><li><a href=#download-and-build-the-image class="table-of-contents__link toc-highlight">Download and Build the Image</a></ul><li><a href=#constructing-the-dataset class="table-of-contents__link toc-highlight">Constructing the Dataset</a><li><a href=#writing-the-dataset-class class="table-of-contents__link toc-highlight">Writing the Dataset Class</a><li><a href=#first-model-acc--4426 class="table-of-contents__link toc-highlight">First Model: Acc = 44.26%</a><ul><li><a href=#key-configuration-explanation class="table-of-contents__link toc-highlight">Key Configuration Explanation</a></ul><li><a href=#adjusting-training-hyperparameters class="table-of-contents__link toc-highlight">Adjusting Training Hyperparameters</a><ul><li><a href=#common-solutions-include class="table-of-contents__link toc-highlight">Common solutions include:</a></ul><li><a href=#data-augmentation-acc--3648 class="table-of-contents__link toc-highlight">Data Augmentation: Acc = 36.48%</a><li><a href=#strong-regularization-acc--4012 class="table-of-contents__link toc-highlight">Strong Regularization: Acc = 40.12%</a><li><a href=#label-smoothing-acc--4481 class="table-of-contents__link toc-highlight">Label Smoothing: Acc = 44.81%</a><li><a href=#ultimately-data-is-still-insufficient class="table-of-contents__link toc-highlight">Ultimately, Data Is Still Insufficient</a><li><a href=#pretrained-weights-acc--5670 class="table-of-contents__link toc-highlight">Pretrained Weights: Acc = 56.70%</a><li><a href=#margin-loss-acc--5792 class="table-of-contents__link toc-highlight">Margin Loss: Acc = 57.92%</a><ul><li><a href=#why-margin class="table-of-contents__link toc-highlight">Why Margin?</a><li><a href=#what-is-margin-loss class="table-of-contents__link toc-highlight">What is Margin Loss?</a><li><a href=#relation-to-geometric-space class="table-of-contents__link toc-highlight">Relation to Geometric Space</a><li><a href=#experimental-results class="table-of-contents__link toc-highlight">Experimental Results</a></ul><li><a href=#enlarged-input-images-acc--7957 class="table-of-contents__link toc-highlight">Enlarged Input Images: Acc = 79.57%</a><li><a href=#enlarged-model-capacity-acc--6176 class="table-of-contents__link toc-highlight">Enlarged Model Capacity: Acc = 61.76%</a><li><a href=#enlarged-input-image-acc--8121 class="table-of-contents__link toc-highlight">Enlarged Input Image: Acc = 81.21%</a><li><a href=#knowledge-distillation-acc--5737 class="table-of-contents__link toc-highlight">Knowledge Distillation: Acc = 57.37%</a><ul><li><a href=#experimental-results-1 class="table-of-contents__link toc-highlight">Experimental Results</a></ul><li><a href=#experiment-and-results-summary class="table-of-contents__link toc-highlight">Experiment and Results Summary</a><li><a href=#and-more class="table-of-contents__link toc-highlight">And More</a></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class=footer__links><a class=footer__link-item href=/en/docs>Projects</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/papers/intro>Papers</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/blog>Blog</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/terms-of-service>TermsOfUse</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/privacy-policy>Privacy Policy</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/become-an-author>Become an author</a><span class=footer__link-separator>·</span><a class=footer__link-item href=/en/worklog>Worklog</a></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2024 DOCSAID.</div></div></div></footer></div>