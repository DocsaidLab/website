"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[7394],{785:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>c,frontMatter:()=>o,metadata:()=>a,toc:()=>d});var s=i(74848),t=i(28453);const o={},r="[20.04] Longformer",a={id:"language-model/longformer/index",title:"[20.04] Longformer",description:"Long Attention Mechanism",source:"@site/i18n/en/docusaurus-plugin-content-docs-papers/current/language-model/2004-longformer/index.md",sourceDirName:"language-model/2004-longformer",slug:"/language-model/longformer/",permalink:"/en/papers/language-model/longformer/",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"zephyr-sh",lastUpdatedAt:1722907975e3,frontMatter:{},sidebar:"papersSidebar",previous:{title:"[20.01] Scaling Laws",permalink:"/en/papers/language-model/scaling_laws/"},next:{title:"[20.05] GPT-3",permalink:"/en/papers/language-model/gpt_3/"}},l={},d=[{value:"Long Attention Mechanism",id:"long-attention-mechanism",level:2},{value:"Problem Definition",id:"problem-definition",level:2},{value:"Solution",id:"solution",level:2},{value:"Model Architecture",id:"model-architecture",level:3},{value:"Autoregressive Modeling",id:"autoregressive-modeling",level:3},{value:"Autoencoding Modeling",id:"autoencoding-modeling",level:3},{value:"Discussion",id:"discussion",level:2},{value:"Autoregressive Experiment Results",id:"autoregressive-experiment-results",level:3},{value:"Autoencoding Experiment Results",id:"autoencoding-experiment-results",level:3},{value:"Autoregressive Ablation Experiments",id:"autoregressive-ablation-experiments",level:3},{value:"Autoencoding Ablation Experiments",id:"autoencoding-ablation-experiments",level:3},{value:"Conclusion",id:"conclusion",level:2}];function h(e){const n={a:"a",admonition:"admonition",annotation:"annotation",blockquote:"blockquote",h1:"h1",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",math:"math",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",msup:"msup",ol:"ol",p:"p",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"2004-longformer",children:"[20.04] Longformer"}),"\n",(0,s.jsx)(n.h2,{id:"long-attention-mechanism",children:"Long Attention Mechanism"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"https://arxiv.org/pdf/2004.05150",children:"Longformer: The Long-Document Transformer"})})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"The following content has been compiled by ChatGPT-4 and manually proofread, edited, and supplemented."})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["The computational complexity of the Transformer\u2019s self-attention mechanism is ",(0,s.jsxs)(n.span,{className:"katex",children:[(0,s.jsx)(n.span,{className:"katex-mathml",children:(0,s.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,s.jsxs)(n.semantics,{children:[(0,s.jsxs)(n.mrow,{children:[(0,s.jsx)(n.mi,{children:"O"}),(0,s.jsx)(n.mo,{stretchy:"false",children:"("}),(0,s.jsxs)(n.msup,{children:[(0,s.jsx)(n.mi,{children:"n"}),(0,s.jsx)(n.mn,{children:"2"})]}),(0,s.jsx)(n.mo,{stretchy:"false",children:")"})]}),(0,s.jsx)(n.annotation,{encoding:"application/x-tex",children:"O(n^2)"})]})})}),(0,s.jsx)(n.span,{className:"katex-html","aria-hidden":"true",children:(0,s.jsxs)(n.span,{className:"base",children:[(0,s.jsx)(n.span,{className:"strut",style:{height:"1.0641em",verticalAlign:"-0.25em"}}),(0,s.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"O"}),(0,s.jsx)(n.span,{className:"mopen",children:"("}),(0,s.jsxs)(n.span,{className:"mord",children:[(0,s.jsx)(n.span,{className:"mord mathnormal",children:"n"}),(0,s.jsx)(n.span,{className:"msupsub",children:(0,s.jsx)(n.span,{className:"vlist-t",children:(0,s.jsx)(n.span,{className:"vlist-r",children:(0,s.jsx)(n.span,{className:"vlist",style:{height:"0.8141em"},children:(0,s.jsxs)(n.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,s.jsx)(n.span,{className:"pstrut",style:{height:"2.7em"}}),(0,s.jsx)(n.span,{className:"sizing reset-size6 size3 mtight",children:(0,s.jsx)(n.span,{className:"mord mtight",children:"2"})})]})})})})})]}),(0,s.jsx)(n.span,{className:"mclose",children:")"})]})})]}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Whenever an algorithm exhibits such computational complexity, it indicates a significant room for optimization."}),"\n",(0,s.jsx)(n.p,{children:"Wait, does this introduction sound familiar?"}),"\n",(0,s.jsx)(n.h2,{id:"problem-definition",children:"Problem Definition"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Previous Related Research",src:i(5112).A+"",width:"996",height:"572"})}),"\n",(0,s.jsx)(n.p,{children:"To address the computational complexity issue of the original Transformer, researchers have continuously sought optimization methods."}),"\n",(0,s.jsxs)(n.p,{children:["One approach is adopting the design principles of ",(0,s.jsx)(n.strong,{children:"Transformer-XL"}),", which handles long documents using a sliding window mechanism combined with an additional memory segment."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/en/papers/language-model/transformer-xl/",children:(0,s.jsx)(n.strong,{children:"Transformer-XL: Attentive to Longer Contexts"})})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"However, the sliding window design has inherent limitations in bidirectional attention mechanisms."}),"\n",(0,s.jsxs)(n.p,{children:["Another approach is sparse attention mechanisms, such as the ",(0,s.jsx)(n.strong,{children:"Sparse Transformer"})," proposed a year before this paper."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/en/papers/language-model/sparse-transformer/",children:(0,s.jsx)(n.strong,{children:"Sparse Transformer: Sparse Attention Mechanism"})})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Previous studies on sparse attention mechanisms did not explore pre-training models and their generalization across various downstream tasks."}),"\n",(0,s.jsx)(n.p,{children:"The motivation for this paper becomes clear:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Using \u201csparse attention mechanisms\u201d for long contexts is a promising approach."}),"\n",(0,s.jsx)(n.li,{children:"However, the design of the attention pattern needs optimization."}),"\n",(0,s.jsx)(n.li,{children:"Moreover, pre-training frameworks should be introduced, and generalization across more downstream tasks should be tested."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"solution",children:"Solution"}),"\n",(0,s.jsx)(n.h3,{id:"model-architecture",children:"Model Architecture"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Longformer Architecture",src:i(85095).A+"",width:"1584",height:"338"})}),"\n",(0,s.jsx)(n.p,{children:"This paper is relatively straightforward to understand because the image above summarizes the core ideas."}),"\n",(0,s.jsx)(n.p,{children:"The description is clear: the authors propose three types of sparse architectures to test the ability to handle long documents:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The figure (a) shows the original attention mechanism, where each token attends to all other tokens."}),"\n",(0,s.jsx)(n.li,{children:"The figure (b) depicts Sliding Window Attention, where each token attends to a fixed range of tokens before and after it."}),"\n",(0,s.jsx)(n.li,{children:"The figure (c) illustrates Dilated Sliding Window Attention, where each token attends to tokens at fixed intervals before and after it."}),"\n",(0,s.jsxs)(n.li,{children:["The figure (d) demonstrates Global+Sliding Window Attention, where, in addition to each token attending to a fixed range of tokens, a few \u201cspecific\u201d tokens attend to all other tokens mutually.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"In the figure, the \u201cspecific\u201d tokens are the 1st, 2nd, 6th, and 16th tokens. Of course, the actual design can be adjusted."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"autoregressive-modeling",children:"Autoregressive Modeling"}),"\n",(0,s.jsx)(n.p,{children:"This paper uses the Dilated Sliding Window Attention mechanism, i.e., the design shown in figure (c). Following previous studies, different dilation rates are applied to different layers."}),"\n",(0,s.jsx)(n.p,{children:"Specifically, smaller dilation rates are used in the lower layers, while larger dilation rates are used in the higher layers, allowing the model to have different receptive fields at different levels."}),"\n",(0,s.jsx)(n.p,{children:"Some training techniques are also employed. Instead of directly using ultra-long contexts from the beginning, the context length is gradually increased, making it easier for the model to converge."}),"\n",(0,s.jsx)(n.p,{children:"Starting from shorter sequence lengths and window sizes in the initial stage helps the model quickly learn to capture local details. In subsequent stages, the system doubles the window size and sequence length while halving the learning rate. This training method accelerates the training process and prepares the model for handling longer sequences."}),"\n",(0,s.jsx)(n.p,{children:"The model is trained in five stages. In these five stages, the model gradually adapts to processing increasingly long sequences."}),"\n",(0,s.jsx)(n.p,{children:"The final stage starts with a sequence length of 2,048 and increases to 23,040. This gradual increase allows the model to handle large-scale data without exceeding memory limits."}),"\n",(0,s.jsx)(n.h3,{id:"autoencoding-modeling",children:"Autoencoding Modeling"}),"\n",(0,s.jsx)(n.p,{children:"In addition to comparing autoregressive models, the authors also compare with autoencoding models like BERT."}),"\n",(0,s.jsx)(n.p,{children:"Due to the high cost of training BERT, the authors choose to fine-tune a pre-trained RoBERTa model using MLM while modifying the original attention mechanism to the Longformer design."}),"\n",(0,s.jsx)(n.p,{children:"Here, the Sliding Window Attention mechanism is used, as shown in figure (b)."}),"\n",(0,s.jsx)(n.p,{children:"Due to the sparse attention mechanism, the context length can be increased from 512 to 4,096 compared to the original RoBERTa."}),"\n",(0,s.jsx)(n.p,{children:"Additionally, some specific tasks require global attention mechanisms, such as the [CLS] token for text classification and all question tokens for QA tasks. In these cases, the authors use the Global+Sliding Window Attention design, as shown in figure (d)."}),"\n",(0,s.jsx)(n.h2,{id:"discussion",children:"Discussion"}),"\n",(0,s.jsx)(n.h3,{id:"autoregressive-experiment-results",children:"Autoregressive Experiment Results"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Autoregressive Experiment Results",src:i(17354).A+"",width:"3116",height:"2475"})}),"\n",(0,s.jsx)(n.p,{children:"Referencing Table 2 in the paper, experimental results show that on smaller models, Longformer achieves the best performance."}),"\n",(0,s.jsx)(n.p,{children:"Referencing Table 3 in the paper, on larger models of the same scale, Longformer performs on par with other state-of-the-art models."}),"\n",(0,s.jsx)(n.h3,{id:"autoencoding-experiment-results",children:"Autoencoding Experiment Results"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Autoencoding Experiment Results",src:i(83548).A+"",width:"1224",height:"212"})}),"\n",(0,s.jsx)(n.p,{children:"The table above summarizes the results of all fine-tuning experiments."}),"\n",(0,s.jsx)(n.p,{children:"The authors observe that Longformer consistently outperforms the RoBERTa baseline."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"For tasks requiring long contexts (e.g., WikiHop and Hyperpartisan), the performance improvement is particularly significant."}),"\n",(0,s.jsx)(n.li,{children:"For TriviaQA, the improvement is smaller because local context is usually sufficient to answer the questions."}),"\n",(0,s.jsx)(n.li,{children:"For HotpotQA, supporting fact supervision allows the model to easily find relevant context and then focus on the local context, resulting in smaller gains."}),"\n",(0,s.jsx)(n.li,{children:"WikiHop only includes distant supervision for intermediate reasoning chains, and Longformer excels by reasoning over the entire context."}),"\n",(0,s.jsx)(n.li,{children:"On the IMDB and OntoNotes datasets, the performance improvement is smaller. For IMDB, most of the dataset consists of short documents, so the baseline handling smaller chunks can stitch mentions into coreference chains without considering cross-chunk interactions."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"autoregressive-ablation-experiments",children:"Autoregressive Ablation Experiments"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Autoregressive Ablation Experiments",src:i(54073).A+"",width:"916",height:"348"})}),"\n",(0,s.jsx)(n.p,{children:"The authors conducted two sets of ablation experiments on autoregressive models."}),"\n",(0,s.jsx)(n.p,{children:"The first set tests the sliding window design:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Decreasing w (from 512 to 32), meaning gradually reducing the sliding window size from the bottom layer."}),"\n",(0,s.jsx)(n.li,{children:"Fixed w (=230), meaning using the same sliding window size from start to finish."}),"\n",(0,s.jsx)(n.li,{children:"Increasing w (from 32 to 512), meaning gradually increasing the sliding window size from the bottom layer."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Results show that the design with Increasing w performs best, aligning with intuition as it allows the model to have different receptive fields at different levels."}),"\n",(0,s.jsx)(n.p,{children:"The second set tests whether to use the dilated sliding window mechanism. Results show that using the dilated sliding window design on two heads of the multi-head attention yields the best results."}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsx)(n.p,{children:"Regarding the second ablation experiment, the authors' original text states:"}),(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Adding some dilation to two heads leads to some improvement compared with no dilation at all."}),"\n"]}),(0,s.jsx)(n.p,{children:"We assume the \u201cheads\u201d refer to two of the heads in the multi-head attention mechanism. If this understanding is incorrect, please let us know."})]}),"\n",(0,s.jsx)(n.h3,{id:"autoencoding-ablation-experiments",children:"Autoencoding Ablation Experiments"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Autoencoding Ablation Experiments",src:i(51851).A+"",width:"1224",height:"636"})}),"\n",(0,s.jsx)(n.p,{children:"The authors conducted a series of ablation experiments on the autoencoding model."}),"\n",(0,s.jsx)(n.p,{children:"First, all experiments were conducted using the Longformer-base model. Unless otherwise specified, all experiments use the same hyperparameters and fine-tune for five epochs."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Benefits of Long Sequences"}),": Longformer benefits from longer sequences, enhancing model performance."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Impact of Global Attention"}),": Global attention and its separate projection matrix positively impact model performance."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Impact of Pretraining"}),": MLM pretraining helps improve model performance."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Impact of Training Time"}),": Longer training times contribute to performance improvement."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Comparison with RoBERTa-base"}),": When Longformer\u2019s configuration matches RoBERTa-base (seqlen: 512 and n2 attention), Longformer\u2019s performance is slightly inferior to RoBERTa-base, confirming that the performance improvement is not due to additional pretraining."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Impact of Unfreezing Position Embeddings Only"}),": Using a pretrained RoBERTa model and unfreezing only the added position embeddings slightly reduces performance. This indicates that Longformer can effectively learn and utilize long-range context in task-specific fine-tuning with large training datasets (e.g., WikiHop)."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,s.jsx)(n.p,{children:"We believe the focus of this paper is on the design of sparse attention mechanisms."}),"\n",(0,s.jsx)(n.p,{children:"Longformer\u2019s global attention mechanism is determined by downstream tasks to decide which tokens should have a global view. In contrast, the earlier Sparse Transformer used fixed intervals to achieve \u201cpseudo\u201d global attention."}),"\n",(0,s.jsx)(n.p,{children:"As for which design is better, Longformer indeed outperforms other previous sparse architectures based on the experimental results. However, the differences are not substantial."}),"\n",(0,s.jsx)(n.p,{children:"Therefore, the choice depends on the user\u2019s needs (or trying out each architecture could also be considered)."})]})}function c(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},5112:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/img1-0d50bf22af8221227c8274d60a2f37ed.jpg"},85095:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/img2-22a5c307ae918d7c8c9e00abca2dc37c.jpg"},17354:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/img3-3fbcd90c5a1c514cd24a5d4c48a1913a.jpg"},54073:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/img4-477f67acb3efef7b7b39b31afd2a0003.jpg"},83548:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/img5-242c1a13b588349d0c7a52e8d17e1edf.jpg"},51851:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/img6-ae95b569f7644e0125fd74c239984209.jpg"},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var s=i(96540);const t={},o=s.createContext(t);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);