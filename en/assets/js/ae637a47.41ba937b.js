"use strict";(self.webpackChunkdocsaid_website=self.webpackChunkdocsaid_website||[]).push([["12640"],{7144:function(e,n,o){o.r(n),o.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>c,frontMatter:()=>s,metadata:()=>t,toc:()=>d});var t=o(73257),i=o(74848),l=o(84429);let s={slug:"download-from-google-drive-using-python",title:"Download Files from Google Drive Using Python",authors:"Z. Yuan",image:"/en/img/2025/0219.webp",tags:["python","google-drive","download"],description:"Small files, large files, all can be downloaded."},a,r={authorsImageUrls:[void 0]},d=[{value:"Why Do We Only Get HTML?",id:"why-do-we-only-get-html",level:2},{value:"Solution: Two-Step Request",id:"solution-two-step-request",level:2},{value:"Code Implementation",id:"code-implementation",level:2},{value:"How to Use",id:"how-to-use",level:2},{value:"Command-Line Tool",id:"command-line-tool",level:2}];function h(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"We wrote a Python script to download files from Google Drive, but sometimes it works fine, while other times it only gives us a strange HTML file...?"}),"\n",(0,i.jsx)(n.p,{children:"The script must be the problem, so we need to fix it."}),"\n",(0,i.jsx)(n.h2,{id:"why-do-we-only-get-html",children:"Why Do We Only Get HTML?"}),"\n",(0,i.jsx)(n.p,{children:"When we send a GET request to Google Drive to download a file, if the file is small (usually less than 100MB), Google may respond directly with the file content, allowing us to download it successfully."}),"\n",(0,i.jsx)(n.p,{children:'However, if the file is larger, Google will show a "virus scan warning" page before the download, notifying the user that the file has not been fully scanned for viruses and offering a button to confirm the download.'}),"\n",(0,i.jsx)(n.p,{children:"If you're using a browser, you can manually click the button to download the file. However, when using a Python script, unless there's an additional mechanism to simulate the button click or parse the download link from the HTML page, you'll only get the HTML of the warning page itself instead of the actual file."}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsx)(n.p,{children:"The unexpected HTML file might look something like this:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'<!DOCTYPE html>\n<html>\n  <head>\n    <title>Google Drive - Virus scan warning</title>\n    <meta http-equiv="content-type" content="text/html; charset=utf-8" />\n   ... \x3c!-- other HTML content --\x3e\n</html>\n'})})]}),"\n",(0,i.jsx)(n.h2,{id:"solution-two-step-request",children:"Solution: Two-Step Request"}),"\n",(0,i.jsx)(n.p,{children:"Now that we understand the issue, we can fix it with the following steps:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"First request"}),": Send a GET request to ",(0,i.jsx)(n.code,{children:"https://docs.google.com/uc?export=download"})," with the file ID."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Check the response"}),": If the HTTP header contains ",(0,i.jsx)(n.code,{children:"content-disposition"}),", then we have the file content, and we can download it directly. If not, it means we are still on the virus scan warning page, so we need to send another request."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Extract the confirmation token"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"From cookies"}),": Google may place a ",(0,i.jsx)(n.code,{children:"download_warning_xxxxx"})," key in the cookies, which contains the token. For example: ",(0,i.jsx)(n.code,{children:"token = session.cookies.get('download_warning_xxxxx')"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"From HTML"}),": Sometimes, Google may not place the token in the cookies but in the HTML form. For example:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'<form\n  id="download-form"\n  action="https://drive.usercontent.google.com/download"\n  method="get"\n>\n  <input type="hidden" name="confirm" value="t" />\n  ...\n</form>\n'})}),"\n","In this case, we can use ",(0,i.jsx)(n.a,{href:"https://www.crummy.com/software/BeautifulSoup/",children:(0,i.jsx)(n.strong,{children:"BeautifulSoup"})})," to scrape all the hidden fields, including parameters like ",(0,i.jsx)(n.code,{children:"confirm"})," or ",(0,i.jsx)(n.code,{children:"uuid"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Combine the two requests"}),": After obtaining the ",(0,i.jsx)(n.code,{children:"token"}),", include it in the request, or directly use the form\u2019s ",(0,i.jsx)(n.code,{children:"action"})," URL and corresponding hidden parameters, then send the second request to begin the download."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"code-implementation",children:"Code Implementation"}),"\n",(0,i.jsx)(n.p,{children:"First, install the necessary packages:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pip install requests tqdm beautifulsoup4\n"})}),"\n",(0,i.jsx)(n.p,{children:"Then use the following Python function, providing the file ID, the name you want to save the file as, and the target directory to automatically determine whether a second request is needed and download the file successfully:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="download_from_google.py"',children:'import os\nimport re\nimport requests\nfrom tqdm import tqdm\nfrom bs4 import BeautifulSoup\n\ndef download_from_google(file_id: str, file_name: str, target: str = "."):\n    """\n    Downloads a file from Google Drive, handling potential confirmation tokens for large files.\n\n    Args:\n        file_id (str):\n            The ID of the file to download from Google Drive.\n        file_name (str):\n            The name to save the downloaded file as.\n        target (str, optional):\n            The directory to save the file in. Defaults to the current directory (".").\n\n    Raises:\n        Exception: If the download fails or the file cannot be created.\n\n    Notes:\n        This function handles both small and large files. For large files, it automatically processes\n        Google\'s confirmation token to bypass warnings about virus scans or file size limits.\n\n    Example:\n        Download a file to the current directory:\n            download_from_google(\n                file_id="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",\n                file_name="example_file.txt"\n            )\n\n        Download a file to a specific directory:\n            download_from_google(\n                file_id="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",\n                file_name="example_file.txt",\n                target="./downloads"\n            )\n    """\n    # First try: docs.google.com/uc?export=download&id=FileID\n    base_url = "https://docs.google.com/uc"\n    session = requests.Session()\n    params = {\n        "export": "download",\n        "id": file_id\n    }\n    response = session.get(base_url, params=params, stream=True)\n\n    # If Content-Disposition is present, the file is directly available\n    if "content-disposition" not in response.headers:\n        # Try to get the token from cookies\n        token = None\n        for k, v in response.cookies.items():\n            if k.startswith("download_warning"):\n                token = v\n                break\n\n        # If no token in cookies, extract it from the HTML\n        if not token:\n            soup = BeautifulSoup(response.text, "html.parser")\n            # Common case: HTML contains a form with id="download-form"\n            download_form = soup.find("form", {"id": "download-form"})\n            if download_form and download_form.get("action"):\n                # Extract action URL, which might be drive.usercontent.google.com/download\n                download_url = download_form["action"]\n                # Collect all hidden inputs\n                hidden_inputs = download_form.find_all("input", {"type": "hidden"})\n                form_params = {}\n                for inp in hidden_inputs:\n                    if inp.get("name") and inp.get("value") is not None:\n                        form_params[inp["name"]] = inp["value"]\n\n                # Re-send the GET request with these parameters\n                response = session.get(download_url, params=form_params, stream=True)\n            else:\n                # Otherwise, search for confirm=xxx in HTML\n                match = re.search(r\'confirm=([0-9A-Za-z-_]+)\', response.text)\n                if match:\n                    token = match.group(1)\n                    # Include the confirm token in the request\n                    params["confirm"] = token\n                    response = session.get(base_url, params=params, stream=True)\n                else:\n                    raise Exception("Unable to find the download link or confirmation token in the response. Download failed.")\n\n        else:\n            # Use the token obtained from cookies and resend the request\n            params["confirm"] = token\n            response = session.get(base_url, params=params, stream=True)\n\n    # Ensure the download directory exists\n    os.makedirs(target, exist_ok=True)\n    file_path = os.path.join(target, file_name)\n\n    # Start downloading the file in chunks, with a progress bar\n    try:\n        total_size = int(response.headers.get(\'content-length\', 0))\n        with open(file_path, "wb") as f, tqdm(\n            desc=file_name,\n            total=total_size,\n            unit="B",\n            unit_scale=True,\n            unit_divisor=1024,\n        ) as bar:\n            for chunk in response.iter_content(chunk_size=32768):\n                if chunk:\n                    f.write(chunk)\n                    bar.update(len(chunk))\n\n        print(f"File successfully downloaded to: {file_path}")\n\n    except Exception as e:\n        raise Exception(f"File download failed: {e}")\n'})}),"\n",(0,i.jsx)(n.h2,{id:"how-to-use",children:"How to Use"}),"\n",(0,i.jsxs)(n.p,{children:["Assuming you have a file ID: ",(0,i.jsx)(n.code,{children:"YOUR_FILE_ID"}),", you want to download it as ",(0,i.jsx)(n.code,{children:"big_model.onnx"})," and store it in the ",(0,i.jsx)(n.code,{children:"./models"})," directory, just call it like this:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'download_from_google(\n    file_id="YOUR_FILE_ID",\n    file_name="big_model.onnx",\n    target="./models"\n)\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Once done, you'll find the successfully downloaded ",(0,i.jsx)(n.code,{children:"big_model.onnx"})," in the ",(0,i.jsx)(n.code,{children:"./models"})," folder, and you\u2019ll see the download progress in the terminal."]}),"\n",(0,i.jsx)(n.h2,{id:"command-line-tool",children:"Command-Line Tool"}),"\n",(0,i.jsx)(n.p,{children:"If you'd prefer to use the command line directly, we can add a wrapper for you:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="download_from_google_cli.py"',children:'from download_from_google import download_from_google\nimport argparse\n\ndef main():\n    parser = argparse.ArgumentParser(description="Download files from Google Drive.")\n    parser.add_argument("--file-id", required=True, help="Google Drive file ID.")\n    parser.add_argument("--file-name", required=True, help="Output file name.")\n    parser.add_argument("--target", default=".", help="Output directory. Defaults to current folder.")\n    args = parser.parse_args()\n\n    download_from_google(file_id=args.file_id, file_name=args.file_name, target=args.target)\n\nif __name__ == "__main__":\n    main()\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Save the code above as ",(0,i.jsx)(n.code,{children:"download_from_google_cli.py"}),", then run it from the command line:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"python download_from_google_cli.py \\\n --file-id YOUR_FILE_ID \\\n --file-name big_model.onnx \\\n --target ./models\n"})}),"\n",(0,i.jsx)(n.p,{children:"If all goes well, the file will start downloading and show a progress bar."}),"\n",(0,i.jsx)(n.p,{children:"We've tested with files of 70MB and 900MB, both working fine. As for a 900GB file... (\u{1F914} \u{1F914} \u{1F914})"}),"\n",(0,i.jsx)(n.p,{children:"We haven't tested that, and we don't have a file that large at hand, so we\u2019ll update when we try it next time!"})]})}function c(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},84429:function(e,n,o){o.d(n,{R:()=>s,x:()=>a});var t=o(96540);let i={},l=t.createContext(i);function s(e){let n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(l.Provider,{value:n},e.children)}},73257:function(e){e.exports=JSON.parse('{"permalink":"/en/blog/download-from-google-drive-using-python","source":"@site/i18n/en/docusaurus-plugin-content-blog/2025/02-19-download-from-google-drive-by-python/index.md","title":"Download Files from Google Drive Using Python","description":"Small files, large files, all can be downloaded.","date":"2025-02-19T00:00:00.000Z","tags":[{"inline":true,"label":"python","permalink":"/en/blog/tags/python"},{"inline":true,"label":"google-drive","permalink":"/en/blog/tags/google-drive"},{"inline":true,"label":"download","permalink":"/en/blog/tags/download"}],"readingTime":5.64,"hasTruncateMarker":true,"authors":[{"name":"Z. Yuan","title":"Dosaid maintainer, Full-Stack AI Engineer","url":"https://github.com/zephyr-sh","socials":{"github":"https://github.com/zephyr-sh","linkedin":"https://www.linkedin.com/in/ze-yuan-sh7/"},"imageURL":"https://github.com/zephyr-sh.png","key":"Z. Yuan","page":null}],"frontMatter":{"slug":"download-from-google-drive-using-python","title":"Download Files from Google Drive Using Python","authors":"Z. Yuan","image":"/en/img/2025/0219.webp","tags":["python","google-drive","download"],"description":"Small files, large files, all can be downloaded."},"unlisted":false,"prevItem":{"title":"Setting Up Amazon SES DNS on Namecheap","permalink":"/en/blog/amazon-ses-setting-dns-on-namecheap"},"nextItem":{"title":"Mounting a USB Drive on Ubuntu","permalink":"/en/blog/mount-disk-on-ubuntu"}}')}}]);