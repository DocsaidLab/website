"use strict";(self.webpackChunkdocsaid_website=self.webpackChunkdocsaid_website||[]).push([["46313"],{52176:function(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var s=t(326),i=t(85893),r=t(50065);let o={slug:"ubuntu-github-runner-systemd",title:"Auto-Run GitHub Runner",authors:"Z. Yuan",tags:["github-action","runner"],image:"/en/img/2023/0910.webp",description:"Run and automatically start in the background using Ubuntu Systemd."},a=void 0,l={authorsImageUrls:[void 0]},c=[{value:"Problem Description",id:"problem-description",level:2},{value:"Configuration Process",id:"configuration-process",level:2},{value:"Check the Status",id:"check-the-status",level:2},{value:"Reconfigure",id:"reconfigure",level:2}];function u(e){let n={admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"When collaborating with GitHub, we often use private hosts for CI/CD tasks."}),"\n",(0,i.jsx)(n.p,{children:"GitHub provides documentation to guide users through the initial installation steps, and following the steps will successfully configure the setup."}),"\n",(0,i.jsxs)("div",{align:"center",children:[(0,i.jsx)("figure",{style:{width:"80%"},children:(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"github_set_runner",src:t(7995).Z+"",width:"2048",height:"1173"})})}),(0,i.jsx)("figcaption",{children:"Documentation"})]}),"\n",(0,i.jsx)(n.h2,{id:"problem-description",children:"Problem Description"}),"\n",(0,i.jsx)(n.p,{children:"However, your host will often need to reboot. If no configuration is set up, the Runner service will fall asleep indefinitely. This issue can be forgotten until someone notices there\u2019s no response or receives a complaint, which may have already been days later."}),"\n",(0,i.jsx)(n.p,{children:"This kind of problem can happen repeatedly and become very annoying!"}),"\n",(0,i.jsx)(n.p,{children:"Therefore, we need to make it run automatically!"}),"\n",(0,i.jsx)(n.h2,{id:"configuration-process",children:"Configuration Process"}),"\n",(0,i.jsx)(n.p,{children:"To automatically run a task after the host boots, we can use systemd."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Create a new systemd service file:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo vim /etc/systemd/system/actions-runner.service\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Paste the following content into the file:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",metastring:'{7-9} title="/etc/systemd/system/actions-runner.service"',children:"[Unit]\nDescription=GitHub Action Runner\nAfter=network.target\n\n[Service]\nType=simple\nUser=your-username\nWorkingDirectory=/home/your-username/actions-runner\nExecStart=/home/your-username/actions-runner/run.sh\nRestart=always\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,i.jsx)(n.p,{children:"Pay attention to the highlighted areas:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"User"}),", ",(0,i.jsx)(n.code,{children:"ExecStart"}),", and ",(0,i.jsx)(n.code,{children:"WorkingDirectory"})," should be changed to your own username."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Tell systemd to reload the new service configuration:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl daemon-reload\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Enable the service so it starts automatically when the host boots:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl enable actions-runner.service\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Now you can manually start the service or reboot to test it:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl start actions-runner.service\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"With this method, the actions-runner will automatically run in the background when your host boots."}),"\n",(0,i.jsx)(n.p,{children:"If you want to stop the service, you can use the following command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl stop actions-runner.service\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["Make sure that ",(0,i.jsx)(n.code,{children:"run.sh"})," has executable permissions."]})}),"\n",(0,i.jsx)(n.h2,{id:"check-the-status",children:"Check the Status"}),"\n",(0,i.jsx)(n.p,{children:"When managing a service with systemd, you can check the logs to understand its current status."}),"\n",(0,i.jsx)(n.p,{children:"Use the following command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo journalctl -u actions-runner.service -f\n"})}),"\n",(0,i.jsx)(n.p,{children:"Explanation of the parameters:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"-u actions-runner.service"}),": Only show logs for the service named actions-runner."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"-f"}),": This option makes journalctl follow the latest logs, so you can see the new output in real time."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Additionally, if you want to check the current status of the service, you can use:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl status actions-runner.service\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This will display the current status of the ",(0,i.jsx)(n.code,{children:"actions-runner"})," service, including whether it's running and the most recent log output:"]}),"\n",(0,i.jsx)("div",{align:"center",children:(0,i.jsx)("figure",{style:{width:"80%"},children:(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"action-service",src:t(13821).Z+"",width:"2048",height:"831"})})})}),"\n",(0,i.jsx)(n.h2,{id:"reconfigure",children:"Reconfigure"}),"\n",(0,i.jsx)(n.p,{children:"This part is off-topic and unrelated to auto-running."}),"\n",(0,i.jsx)(n.p,{children:"If the original Runner is missing (usually due to switching a repository between Public and Private), or the Runner hasn\u2019t been invoked in a long time and got lost!"}),"\n",(0,i.jsx)(n.p,{children:"In this case, you\u2019ll need to reconfigure:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Obtain a new Token from your GitHub account."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Go to your actions-runner folder (or another folder you named) and delete the ",(0,i.jsx)(n.code,{children:".runner"})," file, then run the configuration command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./config.sh --url ... (use the new Token configuration)\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The other steps are the same, and after configuring, just restart the service."})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},13821:function(e,n,t){t.d(n,{Z:()=>s});let s=t.p+"assets/images/action-service-6b4de0ff1dc1dc29f3edb7aeb4d16fc8.jpg"},7995:function(e,n,t){t.d(n,{Z:()=>s});let s=t.p+"assets/images/github_set_runner-6ca68dc499f780fcc4c6e7d7461a2ffe.jpg"},50065:function(e,n,t){t.d(n,{Z:()=>a,a:()=>o});var s=t(67294);let i={},r=s.createContext(i);function o(e){let n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}},326:function(e){e.exports=JSON.parse('{"permalink":"/en/blog/ubuntu-github-runner-systemd","source":"@site/i18n/en/docusaurus-plugin-content-blog/2023/09-10-ubuntu-github-action-runner-systemd/index.md","title":"Auto-Run GitHub Runner","description":"Run and automatically start in the background using Ubuntu Systemd.","date":"2023-09-10T00:00:00.000Z","tags":[{"inline":true,"label":"github-action","permalink":"/en/blog/tags/github-action"},{"inline":true,"label":"runner","permalink":"/en/blog/tags/runner"}],"readingTime":2.63,"hasTruncateMarker":true,"authors":[{"name":"Z. Yuan","title":"Dosaid maintainer, Full-Stack AI Engineer","url":"https://github.com/zephyr-sh","socials":{"github":"https://github.com/zephyr-sh","linkedin":"https://www.linkedin.com/in/ze-yuan-sh7/"},"imageURL":"https://github.com/zephyr-sh.png","key":"Z. Yuan","page":null}],"frontMatter":{"slug":"ubuntu-github-runner-systemd","title":"Auto-Run GitHub Runner","authors":"Z. Yuan","tags":["github-action","runner"],"image":"/en/img/2023/0910.webp","description":"Run and automatically start in the background using Ubuntu Systemd."},"unlisted":false,"prevItem":{"title":"Set Up SSH Server on Ubuntu","permalink":"/en/blog/ubuntu-install-ssh"},"nextItem":{"title":"Login to RTF8207W Router","permalink":"/en/blog/login-rtf8207w"}}')}}]);