"use strict";(self.webpackChunkdocsaid_website=self.webpackChunkdocsaid_website||[]).push([["14916"],{4573:function(e,n,t){t.r(n),t.d(n,{default:()=>j,frontMatter:()=>g,metadata:()=>s,assets:()=>f,toc:()=>w,contentTitle:()=>m});var s=t("62214"),i=t("85893"),o=t("50065"),a=t("23252"),r=t("69622"),l=t("13632"),c=t("26633"),d=t("67294");let{Option:u}=r.Z,p={zh:{selectJson:"JSON",selectCsv:"CSV",selectTxt:"TXT",downloadButton:"\u4E0B\u8F09\u80A1\u7968\u8CC7\u6599",downloadSuccess:e=>`\u{80A1}\u{7968}\u{8CC7}\u{6599}\u{5DF2}\u{4E0B}\u{8F09} (${e.toUpperCase()})`,errorMessage:"\u7121\u6CD5\u53D6\u5F97\u80A1\u7968\u8CC7\u6599\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u8DEF\u6216 API \u8A2D\u5B9A\uFF01",fileName:"TWSE_stocks",csvHeader:"\u4EE3\u865F,\u540D\u7A31,\u5E02\u5834\u5225,\u7522\u696D\u5225,\u4E0A\u5E02\u65E5\u671F"},en:{selectJson:"JSON",selectCsv:"CSV",selectTxt:"TXT",downloadButton:"Download Stocks",downloadSuccess:e=>`Stock data downloaded (${e.toUpperCase()})`,errorMessage:"Failed to fetch stock data. Please check network or API settings!",fileName:"TWSE_stocks",csvHeader:"StockID,StockName,Market,Industry,ListingDate"},ja:{selectJson:"JSON",selectCsv:"CSV",selectTxt:"TXT",downloadButton:"\u682A\u5F0F\u60C5\u5831\u3092\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9",downloadSuccess:e=>`\u{682A}\u{5F0F}\u{60C5}\u{5831}\u{304C}\u{30C0}\u{30A6}\u{30F3}\u{30ED}\u{30FC}\u{30C9}\u{3055}\u{308C}\u{307E}\u{3057}\u{305F} (${e.toUpperCase()})`,errorMessage:"\u682A\u5F0F\u60C5\u5831\u3092\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3002\u30CD\u30C3\u30C8\u30EF\u30FC\u30AF\u307E\u305F\u306FAPI\u8A2D\u5B9A\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\uFF01",fileName:"TWSE_stocks",csvHeader:"\u9298\u67C4\u30B3\u30FC\u30C9,\u9298\u67C4\u540D,\u5E02\u5834,\u696D\u7A2E,\u4E0A\u5834\u65E5"}},h=e=>{let{lang:n="zh",customTranslations:t={}}=e,s={...p,...t}[n]||p.zh,[o,h]=(0,d.useState)("json"),[g,m]=(0,d.useState)(!1),f=async()=>{try{m(!0);let e=await fetch("https://api.docsaid.org/stocks/infos");if(!e.ok)throw Error(`\u{8F09}\u{5165}\u{5931}\u{6557}: ${e.status} ${e.statusText}`);let n=await e.json();if(!n.data||!Array.isArray(n.data))throw Error("\u56DE\u50B3\u8CC7\u6599\u683C\u5F0F\u932F\u8AA4\uFF01");let t={};for(let e of n.data)t[e.stock_id]={\u540D\u7A31:e.stock_name,\u4EE3\u865F:e.stock_id,\u5E02\u5834\u5225:e.type,\u7522\u696D\u5225:e.industry_category,\u4E0A\u5E02\u65E5\u671F:e.date};w(t)}catch(e){l.ZP.error(s.errorMessage),console.error(e)}finally{m(!1)}},w=e=>{let n="",t="",i=`${s.fileName}.${o}`;if("json"===o)n=JSON.stringify(e,null,2),t="application/json";else if("csv"===o){let i=[s.csvHeader];for(let n in e){let t=e[n];i.push(`${t["\u4EE3\u865F"]},${t["\u540D\u7A31"]},${t["\u5E02\u5834\u5225"]},${t["\u7522\u696D\u5225"]},${t["\u4E0A\u5E02\u65E5\u671F"]}`)}n="\uFEFF"+i.join("\n"),t="text/csv;charset=utf-8"}else if("txt"===o){let i=[s.csvHeader];for(let n in e){let t=e[n];i.push(`${t["\u4EE3\u865F"]},${t["\u540D\u7A31"]},${t["\u5E02\u5834\u5225"]},${t["\u7522\u696D\u5225"]},${t["\u4E0A\u5E02\u65E5\u671F"]}`)}n="\uFEFF"+i.join("\n"),t="text/plain;charset=utf-8"}let a=new Blob([n],{type:t}),r=document.createElement("a");r.href=URL.createObjectURL(a),r.download=i,document.body.appendChild(r),r.click(),document.body.removeChild(r),l.ZP.success(s.downloadSuccess(o))};return(0,i.jsxs)("div",{style:{textAlign:"center",marginTop:"20px"},children:[(0,i.jsxs)(r.Z,{value:o,onChange:h,style:{width:120,marginRight:10},children:[(0,i.jsx)(u,{value:"json",children:s.selectJson}),(0,i.jsx)(u,{value:"csv",children:s.selectCsv}),(0,i.jsx)(u,{value:"txt",children:s.selectTxt})]}),(0,i.jsx)(c.ZP,{type:"primary",icon:(0,i.jsx)(a.Z,{}),onClick:f,loading:g,children:s.downloadButton})]})},g={slug:"get-taiwan-all-stocks-info",title:"Get All Stock Code Information from TWSE",authors:"Z. Yuan",image:"/en/img/2024/0610.webp",tags:["beautifulsoup4","TWSE"],description:"Get information on all stocks listed on TWSE using Python."},m=void 0,f={authorsImageUrls:[void 0]},w=[{value:"Setup Environment",id:"setup-environment",level:2},{value:"Target Webpages",id:"target-webpages",level:2},{value:"Parsing the Webpage",id:"parsing-the-webpage",level:2},{value:"Output Results",id:"output-results",level:2},{value:"FAQs",id:"faqs",level:2},{value:"I only want ordinary stocks.",id:"i-only-want-ordinary-stocks",level:3},{value:"I only want specific industries.",id:"i-only-want-specific-industries",level:3},{value:"The program is broken.",id:"the-program-is-broken",level:3},{value:"Conclusion",id:"conclusion",level:2}];function y(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"The stock codes in the Taiwanese market change periodically, making manual tracking impractical."}),"\n",(0,i.jsx)(n.p,{children:"It's time to automate!"}),"\n",(0,i.jsx)(n.h2,{id:"setup-environment",children:"Setup Environment"}),"\n",(0,i.jsx)(n.p,{children:"Let's tackle the challenge by writing a program. First, install the necessary packages:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pip install requests beautifulsoup4 json\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsx)(n.p,{children:"Assuming you have a functional Python environment."})}),"\n",(0,i.jsx)(n.h2,{id:"target-webpages",children:"Target Webpages"}),"\n",(0,i.jsx)(n.p,{children:"Stock-related data resides on the website of the Taiwan Stock Exchange (TWSE). Let's identify the target pages:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://www.twse.com.tw/en/products/code/announcement.html",children:(0,i.jsx)(n.strong,{children:"Taiwan Stock Exchange/Securities Code Announcement"})})}),"\n",(0,i.jsx)("div",{align:"center",children:(0,i.jsx)("figure",{style:{width:"80%"},children:(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"TWSE",src:t(39950).Z+"",width:"3322",height:"1851"})})})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Note down these three URLs:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'urls = [\n    "https://isin.twse.com.tw/isin/C_public.jsp?strMode=2", # Listed securities\n    "https://isin.twse.com.tw/isin/C_public.jsp?strMode=4", # OTC securities\n    "https://isin.twse.com.tw/isin/C_public.jsp?strMode=5"  # Emerging stocks\n]\n'})}),"\n",(0,i.jsx)(n.h2,{id:"parsing-the-webpage",children:"Parsing the Webpage"}),"\n",(0,i.jsx)("div",{align:"center",children:(0,i.jsx)("figure",{style:{width:"80%"},children:(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"stock_table",src:t(87868).Z+"",width:"3799",height:"1077"})})})}),"\n",(0,i.jsxs)(n.p,{children:["Upon inspecting the webpage, we identify that the main table corresponds to the HTML tag ",(0,i.jsx)(n.code,{children:"class=h4"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Now that we've located our target, let's start coding:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="update_stocks_code.py"',children:'import json\nimport requests\nfrom bs4 import BeautifulSoup\n\n# Retrieve content from Taiwan Stock Exchange announcements\nurls = [\n    "https://isin.twse.com.tw/isin/C_public.jsp?strMode=2", # Listed securities\n    "https://isin.twse.com.tw/isin/C_public.jsp?strMode=4", # OTC securities\n    "https://isin.twse.com.tw/isin/C_public.jsp?strMode=5"  # Emerging stocks\n]\n\n# All data infos\ndata = {}\n\ntotal_urls = len(urls)\nfor index, url in enumerate(urls, start=1):\n    print(f"Processing URL {index}/{total_urls}: {url}")\n\n    response = requests.get(url)\n    response.encoding = \'big5\'  # Set the correct encoding\n\n    # Parse HTML using BeautifulSoup\n    soup = BeautifulSoup(response.text, \'html.parser\')\n    table = soup.find(\'table\', {\'class\': \'h4\'})\n\n    if not table:\n        print(f"Table not found for URL: {url}")\n        continue\n\n    for row in table.find_all(\'tr\')[1:]:  # Skip header row\n        cells = row.find_all(\'td\')\n        if len(cells) != 7:\n            continue\n\n        code, name = cells[0].text.split("\\u3000")\n        internationality = cells[1].text\n        list_date = cells[2].text\n        market_type = cells[3].text\n        industry_type = cells[4].text\n\n        data[code] = {\n            "Name": name,\n            "Code": code,\n            "Market Type": market_type,\n            "Industry Type": industry_type,\n            "Listing Date": list_date,\n            "International Code": internationality\n        }\n\nwith open("stock_infos.json", "w", encoding="utf-8") as f:\n    json.dump(data, f, ensure_ascii=False, indent=2)\n\nprint("All data has been processed and saved to stock_infos.json")\n'})}),"\n",(0,i.jsx)(n.h2,{id:"output-results",children:"Output Results"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",metastring:'title="stock_infos.json"',children:'{\n  "1101": {\n    "Name": "Taiwan Cement",\n    "Code": "1101",\n    "Market Type": "Listed",\n    "Industry Type": "Cement Industry",\n    "Listing Date": "1962/02/09",\n    "International Code": "TW0001101004"\n  },\n  "1102": {\n    "Name": "Asia Cement",\n    "Code": "1102",\n    "Market Type": "Listed",\n    "Industry Type": "Cement Industry",\n    "Listing Date": "1962/06/08",\n    "International Code": "TW0001102002"\n  },\n  ...omitting the rest...\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"We output the result as a JSON file for convenient integration with other programs."}),"\n",(0,i.jsx)(n.h2,{id:"faqs",children:"FAQs"}),"\n",(0,i.jsx)(n.h3,{id:"i-only-want-ordinary-stocks",children:"I only want ordinary stocks."}),"\n",(0,i.jsx)(n.p,{children:'I assume you mean stocks with "four-digit" codes, excluding ETFs, warrants, etc. To achieve this, simply add a filtering condition in the program:'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"if len(code) != 4:\n    continue\n"})}),"\n",(0,i.jsx)(n.h3,{id:"i-only-want-specific-industries",children:"I only want specific industries."}),"\n",(0,i.jsx)(n.p,{children:'This requirement can be extended to specific market types, industry types, listing dates, or even the previous "ordinary stocks" question. We just need to load the output JSON file into Pandas and filter with conditions:'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import pandas as pd\n\ndf = pd.read_json("stock_infos.json", orient="index")\ntarget = df[df["Industry Type"] == "Cement Industry"]\n'})}),"\n",(0,i.jsx)(n.h3,{id:"the-program-is-broken",children:"The program is broken."}),"\n",(0,i.jsx)(n.p,{children:"That could be due to changes in the TWSE website's layout, causing the HTML structure to alter. We'll need to adjust the code accordingly."}),"\n",(0,i.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsx)(n.p,{children:"By periodically running this program, we can obtain the latest stock information."}),"\n",(0,i.jsxs)(n.admonition,{type:"tip",children:[(0,i.jsx)(n.p,{children:"Since you're here, why not take a moment to enjoy a cup of tea before you go?"}),(0,i.jsx)(n.p,{children:"We also wrote an API to integrate FinMind's stock data. By clicking the download button below, you can retrieve the latest stock information from FinMind. The data format may differ from the one used by the stock exchange, but you probably won't mind."}),(0,i.jsx)(h,{lang:"en"})]})]})}function j(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(y,{...e})}):y(e)}},39950:function(e,n,t){t.d(n,{Z:function(){return s}});let s=t.p+"assets/images/img1-127414ab0646293a663eeab2cd7524ea.jpg"},87868:function(e,n,t){t.d(n,{Z:function(){return s}});let s=t.p+"assets/images/img2-4ffe9c13206f8f5db60e1155ad8a9a89.jpg"},62214:function(e){e.exports=JSON.parse('{"permalink":"/en/blog/get-taiwan-all-stocks-info","source":"@site/i18n/en/docusaurus-plugin-content-blog/2024/06-10-get-taiwan-all-stocks-info/index.md","title":"Get All Stock Code Information from TWSE","description":"Get information on all stocks listed on TWSE using Python.","date":"2024-06-10T00:00:00.000Z","tags":[{"inline":true,"label":"beautifulsoup4","permalink":"/en/blog/tags/beautifulsoup-4"},{"inline":true,"label":"TWSE","permalink":"/en/blog/tags/twse"}],"readingTime":2.905,"hasTruncateMarker":true,"authors":[{"name":"Z. Yuan","title":"Engineer","url":"https://github.com/Z. Yuan-sh","imageURL":"https://github.com/Z. Yuan-sh.png","key":"Z. Yuan","page":null}],"frontMatter":{"slug":"get-taiwan-all-stocks-info","title":"Get All Stock Code Information from TWSE","authors":"Z. Yuan","image":"/en/img/2024/0610.webp","tags":["beautifulsoup4","TWSE"],"description":"Get information on all stocks listed on TWSE using Python."},"unlisted":false,"prevItem":{"title":"NIST & FRVT","permalink":"/en/blog/nist-and-frvt"},"nextItem":{"title":"Simple Configuration of Python Environment on Win11","permalink":"/en/blog/windows-python-settings"}}')}}]);