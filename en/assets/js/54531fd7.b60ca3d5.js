"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([["14575"],{58576:function(e,n,s){s.r(n),s.d(n,{assets:function(){return o},contentTitle:function(){return c},default:function(){return h},frontMatter:function(){return t},metadata:function(){return i},toc:function(){return l}});var i=s(25954),r=s(85893),a=s(50065);let t={slug:"setting-up-pypiserver-on-ubuntu-with-docker",title:"Setting Up PyPiServer on Ubuntu",authors:"Zephyr",tags:["docker","pypiserver"],image:"/en/img/2023/0913.webp",description:"Setting up PyPiServer on Ubuntu using Docker."},c=void 0,o={authorsImageUrls:[void 0]},l=[{value:"Pull the Image",id:"pull-the-image",level:2},{value:"Create a Directory",id:"create-a-directory",level:2},{value:"Set up htpasswd",id:"set-up-htpasswd",level:2},{value:"Run as a Background Service",id:"run-as-a-background-service",level:2},{value:"Install Docker Compose",id:"install-docker-compose",level:3},{value:"Create a Configuration File",id:"create-a-configuration-file",level:3},{value:"Set up a Systemd Service",id:"set-up-a-systemd-service",level:3},{value:"Start the Service",id:"start-the-service",level:3},{value:"Check the Status",id:"check-the-status",level:2},{value:"Start Using the Server",id:"start-using-the-server",level:2},{value:"Uploading Packages",id:"uploading-packages",level:3},{value:"Downloading and Installing Packages",id:"downloading-and-installing-packages",level:3},{value:"Using Basic Authentication",id:"using-basic-authentication",level:3},{value:"Configuring <code>pip.conf</code>",id:"configuring-pipconf",level:2},{value:"Configuration File",id:"configuration-file",level:3},{value:"Conclusion",id:"conclusion",level:2}];function d(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Today, we\u2019ll document the process of setting up a PyPi Server using Docker on Ubuntu."}),"\n",(0,r.jsx)(n.p,{children:"We assume you have Docker installed on Ubuntu and are familiar with basic Docker operations."}),"\n",(0,r.jsx)(n.h2,{id:"pull-the-image",children:"Pull the Image"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker pull pypiserver/pypiserver:latest\n"})}),"\n",(0,r.jsx)(n.h2,{id:"create-a-directory",children:"Create a Directory"}),"\n",(0,r.jsx)(n.p,{children:"Let\u2019s quickly create a directory in the home directory to store Python packages."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir ~/packages\n"})}),"\n",(0,r.jsx)(n.p,{children:"You can use a different name if you prefer, but remember to adjust it in the configuration files."}),"\n",(0,r.jsx)(n.h2,{id:"set-up-htpasswd",children:"Set up htpasswd"}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"If you don\u2019t want to set a password, you can skip this step."})}),"\n",(0,r.jsx)(n.p,{children:"htpasswd is a file format for storing usernames and passwords, which pypiserver uses for user authentication. This is a simple and effective way to enhance pypiserver\u2019s security."}),"\n",(0,r.jsxs)(n.p,{children:["First, install ",(0,r.jsx)(n.code,{children:"apache2-utils"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo apt install apache2-utils\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Then, use the following command to create a new ",(0,r.jsx)(n.code,{children:".htpasswd"})," file:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"htpasswd -c ~/.htpasswd [username]\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You will be prompted to enter a password for ",(0,r.jsx)(n.code,{children:"username"}),". After entering the password, the ",(0,r.jsx)(n.code,{children:".htpasswd"})," file will be created in your home directory."]}),"\n",(0,r.jsxs)(n.p,{children:["Once the file is created, you can run ",(0,r.jsx)(n.code,{children:"pypiserver"})," with the ",(0,r.jsx)(n.code,{children:"docker run"})," command and enable authentication with the ",(0,r.jsx)(n.code,{children:".htpasswd"})," file."]}),"\n",(0,r.jsx)(n.h2,{id:"run-as-a-background-service",children:"Run as a Background Service"}),"\n",(0,r.jsx)(n.p,{children:"To run the Docker container as a background service, we\u2019ll use Docker Compose with Systemd."}),"\n",(0,r.jsx)(n.h3,{id:"install-docker-compose",children:"Install Docker Compose"}),"\n",(0,r.jsx)(n.p,{children:"If you haven\u2019t installed Docker Compose, start by doing so:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.docker.com/compose/install/",children:(0,r.jsx)(n.strong,{children:"Official Docker Compose Installation Guide"})})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Docker Compose has recently undergone major updates, changing many commands. Notably, ",(0,r.jsx)(n.code,{children:"docker-compose"})," has been replaced by ",(0,r.jsx)(n.code,{children:"docker compose"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Install the latest version of Docker Compose:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo apt update\nsudo apt install docker-compose-plugin\n"})}),"\n",(0,r.jsx)(n.p,{children:"Verify the installation:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker compose version\n"})}),"\n",(0,r.jsx)(n.h3,{id:"create-a-configuration-file",children:"Create a Configuration File"}),"\n",(0,r.jsxs)(n.p,{children:["Find a location to create the ",(0,r.jsx)(n.code,{children:"docker-compose.yml"})," file and add the following content:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'version: "3.3"\nservices:\n  pypiserver:\n    image: pypiserver/pypiserver:latest\n    volumes:\n      - /home/[username]/auth:/data/auth\n      - /home/[username]/packages:/data/packages\n    command: run -P /data/auth/.htpasswd -a update,download,list /data/packages\n    ports:\n      - "8080:8080"\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Replace ",(0,r.jsx)(n.code,{children:"[username]"})," with your actual username."]}),"\n",(0,r.jsxs)(n.li,{children:["You can modify the external port mapping if needed, for example: ",(0,r.jsx)(n.code,{children:'"18080:8080"'}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["You can refer to ",(0,r.jsx)(n.code,{children:"pypiserver"}),"\u2019s example file here: ",(0,r.jsx)(n.a,{href:"https://github.com/pypiserver/pypiserver/blob/master/docker-compose.yml",children:(0,r.jsx)(n.strong,{children:"docker-compose.yml"})})]})}),"\n",(0,r.jsxs)(n.p,{children:["If you want to skip setting a password, modify the ",(0,r.jsx)(n.code,{children:"command"})," line as follows:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"command: run -a . -P . /data/packages --server wsgiref\n"})}),"\n",(0,r.jsx)(n.h3,{id:"set-up-a-systemd-service",children:"Set up a Systemd Service"}),"\n",(0,r.jsx)(n.p,{children:"Create a configuration file:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo vim /etc/systemd/system/pypiserver.service\n"})}),"\n",(0,r.jsx)(n.p,{children:"Add the following content:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"[Unit]\nDescription=PypiServer Docker Compose\nRequires=docker.service\nAfter=docker.service\n\n[Service]\nWorkingDirectory=/path/to/your/docker-compose/directory\nExecStart=/usr/bin/docker compose up --remove-orphans\nExecStop=/usr/bin/docker compose down\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Replace ",(0,r.jsx)(n.code,{children:"/path/to/your/docker-compose/directory"})," with the actual path to the ",(0,r.jsx)(n.code,{children:"docker-compose.yml"})," file (only the path, not the filename)."]}),"\n",(0,r.jsxs)(n.li,{children:["Ensure the Docker path is correct by using ",(0,r.jsx)(n.code,{children:"which docker"})," to confirm."]}),"\n",(0,r.jsxs)(n.li,{children:["This setup uses the new ",(0,r.jsx)(n.code,{children:"docker compose"})," command instead of ",(0,r.jsx)(n.code,{children:"docker-compose"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"start-the-service",children:"Start the Service"}),"\n",(0,r.jsx)(n.p,{children:"Let systemd know about the new service configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl daemon-reload\n"})}),"\n",(0,r.jsx)(n.p,{children:"Start the service:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl enable pypiserver.service\nsudo systemctl start pypiserver.service\n"})}),"\n",(0,r.jsx)(n.h2,{id:"check-the-status",children:"Check the Status"}),"\n",(0,r.jsx)(n.p,{children:"To check the current status of the service, use:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl status pypiserver.service\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This will display the current status of the ",(0,r.jsx)(n.code,{children:"pypiserver"})," service, including whether it\u2019s running and the latest log output."]}),"\n",(0,r.jsx)(n.h2,{id:"start-using-the-server",children:"Start Using the Server"}),"\n",(0,r.jsxs)(n.p,{children:["You can now use ",(0,r.jsx)(n.code,{children:"pip"})," to install and upload packages."]}),"\n",(0,r.jsx)(n.h3,{id:"uploading-packages",children:"Uploading Packages"}),"\n",(0,r.jsxs)(n.p,{children:["Let\u2019s say you have a package named ",(0,r.jsx)(n.code,{children:"example_package-0.1-py3-none-any.whl"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"twine"})," to upload the package:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pip install twine\ntwine upload --repository-url http://localhost:8080/ example_package-0.1-py3-none-any.whl\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Make sure that ",(0,r.jsx)(n.code,{children:"localhost:8080"})," is the address and port of your pypiserver."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"downloading-and-installing-packages",children:"Downloading and Installing Packages"}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"pip"})," to install packages by specifying the address and port of ",(0,r.jsx)(n.code,{children:"pypiserver"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pip install --index-url http://localhost:8080/ example_package\n"})}),"\n",(0,r.jsx)(n.h3,{id:"using-basic-authentication",children:"Using Basic Authentication"}),"\n",(0,r.jsx)(n.p,{children:"If you set up basic authentication for your pypiserver, you\u2019ll need to provide credentials when uploading or downloading:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"To upload a package:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"twine upload \\\n  --repository-url http://localhost:8080/ \\\n  --username [username] \\\n  --password [password] \\\n  example_package-0.1-py3-none-any.whl\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"To install a package:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pip install \\\n  --index-url http://[username]:[password]@localhost:8080/ \\\n  example_package\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.h2,{id:"configuring-pipconf",children:["Configuring ",(0,r.jsx)(n.code,{children:"pip.conf"})]}),"\n",(0,r.jsxs)(n.p,{children:["To avoid specifying ",(0,r.jsx)(n.code,{children:"--index-url"})," each time you use ",(0,r.jsx)(n.code,{children:"pip install"}),", we can add the relevant configuration to ",(0,r.jsx)(n.code,{children:"pip.conf"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"configuration-file",children:"Configuration File"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"pip.conf"})," file can be located in several places, with the following order of precedence:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Level 1: Site-level configuration:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"/home/[username]/.pyenv/versions/3.8.18/envs/main/pip.conf"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Level 2: User-level configuration:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"/home/[username]/.pip/pip.conf"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"/home/[username]/.config/pip/pip.conf"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Level 3: Global configuration:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"/etc/pip.conf"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"/etc/xdg/pip/pip.conf"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Identify the file that corresponds to your Python environment and add the following content:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"[global]\nindex-url = http://[server_ip]:8080/\ntrusted-host = [server_ip]\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Again, replace ",(0,r.jsx)(n.code,{children:"[server_ip]:8080"})," with the correct address and port of your ",(0,r.jsx)(n.code,{children:"pypiserver"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["After setting this up, the server address configured in ",(0,r.jsx)(n.code,{children:"pip.conf"})," will automatically be used as the package source when you use ",(0,r.jsx)(n.code,{children:"pip install [package_name]"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,r.jsx)(n.p,{children:"You\u2019ve now successfully set up your own PyPI server, and you know how to upload and download packages."}),"\n",(0,r.jsx)(n.p,{children:"We hope this guide solves your problem."})]})}function h(e={}){let{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},50065:function(e,n,s){s.d(n,{Z:function(){return c},a:function(){return t}});var i=s(67294);let r={},a=i.createContext(r);function t(e){let n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(a.Provider,{value:n},e.children)}},25954:function(e){e.exports=JSON.parse('{"permalink":"/en/blog/setting-up-pypiserver-on-ubuntu-with-docker","source":"@site/i18n/en/docusaurus-plugin-content-blog/2023/09-13-ubuntu-docker-pypiserver/index.md","title":"Setting Up PyPiServer on Ubuntu","description":"Setting up PyPiServer on Ubuntu using Docker.","date":"2023-09-13T00:00:00.000Z","tags":[{"inline":true,"label":"docker","permalink":"/en/blog/tags/docker"},{"inline":true,"label":"pypiserver","permalink":"/en/blog/tags/pypiserver"}],"readingTime":4.065,"hasTruncateMarker":true,"authors":[{"name":"Zephyr","title":"Engineer","url":"https://github.com/zephyr-sh","imageURL":"https://github.com/zephyr-sh.png","key":"Zephyr","page":null}],"frontMatter":{"slug":"setting-up-pypiserver-on-ubuntu-with-docker","title":"Setting Up PyPiServer on Ubuntu","authors":"Zephyr","tags":["docker","pypiserver"],"image":"/en/img/2023/0913.webp","description":"Setting up PyPiServer on Ubuntu using Docker."},"unlisted":false,"prevItem":{"title":"Recording Model Training Environment Issues","permalink":"/en/blog/python-env-info-collector"},"nextItem":{"title":"Setting Up SSH Server on Ubuntu","permalink":"/en/blog/ubuntu-install-ssh"}}')}}]);