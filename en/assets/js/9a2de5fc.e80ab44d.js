"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[7548],{28159:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var s=i(74848),t=i(28453);const r={},a="[21.11] PoolFormer",o={id:"poolformer/index",title:"[21.11] PoolFormer",description:"You Need a Meta!",source:"@site/i18n/en/docusaurus-plugin-content-docs-papers/current/2111-poolformer/index.md",sourceDirName:"2111-poolformer",slug:"/poolformer/",permalink:"/en/papers/poolformer/",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"zephyr-sh",lastUpdatedAt:1721691181e3,frontMatter:{},sidebar:"papersSidebar",previous:{title:"[21.09] PP-LCNet",permalink:"/en/papers/pp-lcnet/"},next:{title:"[22.01] ConvNeXt",permalink:"/en/papers/convnext/"}},l={},c=[{value:"You Need a Meta!",id:"you-need-a-meta",level:2},{value:"Problem Definition",id:"problem-definition",level:2},{value:"Input Embedding",id:"input-embedding",level:3},{value:"Token-Mixer",id:"token-mixer",level:3},{value:"Channel MLP",id:"channel-mlp",level:3},{value:"Is Token-Mixer Really the Key?",id:"is-token-mixer-really-the-key",level:3},{value:"Solution",id:"solution",level:2},{value:"Model Architecture",id:"model-architecture",level:3},{value:"Model Configuration",id:"model-configuration",level:3},{value:"Discussion",id:"discussion",level:2},{value:"ImageNet Experiments",id:"imagenet-experiments",level:3},{value:"Ablation Experiments",id:"ablation-experiments",level:3},{value:"Conclusion",id:"conclusion",level:2}];function h(e){const n={a:"a",admonition:"admonition",annotation:"annotation",code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",math:"math",mi:"mi",mo:"mo",mrow:"mrow",mtext:"mtext",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"2111-poolformer",children:"[21.11] PoolFormer"}),"\n",(0,s.jsx)(n.h2,{id:"you-need-a-meta",children:"You Need a Meta!"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://arxiv.org/abs/2111.11418",children:(0,s.jsx)(n.strong,{children:"MetaFormer Is Actually What You Need for Vision"})})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"The following content is compiled by ChatGPT-4 and has been manually edited and supplemented."})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["The introduction of the Transformer architecture into the vision domain has sparked a significant wave of research. In previous studies, most researchers focused on improving the performance of the Token-Mixer or optimizing the Patchify process. However, an important issue was often overlooked: ",(0,s.jsx)(n.strong,{children:"the framework"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"problem-definition",children:"Problem Definition"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"metaformer",src:i(37780).A+"",width:"1104",height:"780"})}),"\n",(0,s.jsx)(n.p,{children:'This "framework" refers to the fundamental structure that makes up the Transformer, including:'}),"\n",(0,s.jsx)(n.h3,{id:"input-embedding",children:"Input Embedding"}),"\n",(0,s.jsx)(n.p,{children:"This component converts an image into a sequence of vectors, usually accomplished through CNNs."}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsx)(n.p,{children:"Typically, this involves non-overlapping sliding window large-kernel convolutions, which effectively function as fully connected layers. CNNs are used because the sliding window mechanism facilitates patch extraction."})}),"\n",(0,s.jsx)(n.h3,{id:"token-mixer",children:"Token-Mixer"}),"\n",(0,s.jsx)(n.p,{children:"This part involves the mixing of tokens, typically achieved through the self-attention mechanism of Transformers. Recent research introduced the MLP-Mixer concept, replacing self-attention with MLP to reduce computational load."}),"\n",(0,s.jsx)(n.h3,{id:"channel-mlp",children:"Channel MLP"}),"\n",(0,s.jsx)(n.p,{children:"This component handles the mixing of dimensions within each token, usually achieved through MLP."}),"\n",(0,s.jsx)(n.h3,{id:"is-token-mixer-really-the-key",children:"Is Token-Mixer Really the Key?"}),"\n",(0,s.jsx)(n.p,{children:"The authors explore whether the success of Transformers is mainly due to the attention-based Token-Mixer or the overall architecture of the Transformer (MetaFormer). They experiment by replacing the original attention module with simple pooling operations to verify the critical role of the MetaFormer architecture in model performance."}),"\n",(0,s.jsx)(n.h2,{id:"solution",children:"Solution"}),"\n",(0,s.jsx)(n.h3,{id:"model-architecture",children:"Model Architecture"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"poolformer",src:i(83843).A+"",width:"1498",height:"548"})}),"\n",(0,s.jsx)(n.p,{children:"To validate the importance of MetaFormer, the authors minimized the role of the Token-Mixer by replacing the self-attention module with pooling operations. Pooling operations are extremely simple, second only to identity mapping, performing statistical operations such as max pooling or average pooling on a set of data."}),"\n",(0,s.jsx)(n.p,{children:"Additionally, the authors adopted a multi-level architecture similar to PVT, downsampling in stages like in CNN models."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/en/papers/pvt/",children:(0,s.jsx)(n.strong,{children:"PVT: Spatial Reduction Attention Mechanism"})})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Regarding the pooling operation, the authors provided implementation details:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",metastring:"{20}",children:'import torch.nn as nn\n\nclass Pooling(nn.Module):\n\n    def __init__(self, pool_size=3):\n        super().__init__()\n        self.pool = nn.AvgPool2d(\n            pool_size,\n            stride=1,\n            padding=pool_size//2,\n            count_include_pad=False,\n        )\n\n    def forward(self, x):\n        """\n        [B, C, H, W] = x.shape\n        Subtraction of the input itself is added since the block already has a\n        residual connection.\n        """\n        return self.pool(x) - x\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Note the implementation line ",(0,s.jsx)(n.code,{children:"self.pool(x) - x"}),". Initially, this might seem confusing. The authors included a comment explaining that it is due to the residual connection mechanism in the Token-Mixer structure, i.e.,"]}),"\n",(0,s.jsx)(n.span,{className:"katex-display",children:(0,s.jsxs)(n.span,{className:"katex",children:[(0,s.jsx)(n.span,{className:"katex-mathml",children:(0,s.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,s.jsxs)(n.semantics,{children:[(0,s.jsxs)(n.mrow,{children:[(0,s.jsx)(n.mi,{children:"x"}),(0,s.jsx)(n.mo,{children:"="}),(0,s.jsx)(n.mi,{children:"x"}),(0,s.jsx)(n.mo,{children:"+"}),(0,s.jsx)(n.mtext,{children:"TokenMixer"}),(0,s.jsx)(n.mo,{stretchy:"false",children:"("}),(0,s.jsx)(n.mi,{children:"x"}),(0,s.jsx)(n.mo,{stretchy:"false",children:")"})]}),(0,s.jsx)(n.annotation,{encoding:"application/x-tex",children:"x = x + \\text{TokenMixer}(x)"})]})})}),(0,s.jsxs)(n.span,{className:"katex-html","aria-hidden":"true",children:[(0,s.jsxs)(n.span,{className:"base",children:[(0,s.jsx)(n.span,{className:"strut",style:{height:"0.4306em"}}),(0,s.jsx)(n.span,{className:"mord mathnormal",children:"x"}),(0,s.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,s.jsx)(n.span,{className:"mrel",children:"="}),(0,s.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,s.jsxs)(n.span,{className:"base",children:[(0,s.jsx)(n.span,{className:"strut",style:{height:"0.6667em",verticalAlign:"-0.0833em"}}),(0,s.jsx)(n.span,{className:"mord mathnormal",children:"x"}),(0,s.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,s.jsx)(n.span,{className:"mbin",children:"+"}),(0,s.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,s.jsxs)(n.span,{className:"base",children:[(0,s.jsx)(n.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,s.jsx)(n.span,{className:"mord text",children:(0,s.jsx)(n.span,{className:"mord",children:"TokenMixer"})}),(0,s.jsx)(n.span,{className:"mopen",children:"("}),(0,s.jsx)(n.span,{className:"mord mathnormal",children:"x"}),(0,s.jsx)(n.span,{className:"mclose",children:")"})]})]})]})}),"\n",(0,s.jsxs)(n.p,{children:["Subtracting ",(0,s.jsx)(n.code,{children:"x"})," cancels out the original residual connection, isolating the effect of the pooling operation."]}),"\n",(0,s.jsx)(n.h3,{id:"model-configuration",children:"Model Configuration"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"config",src:i(24358).A+"",width:"992",height:"1048"})}),"\n",(0,s.jsx)(n.p,{children:"The architecture configuration follows a 1:1:3:1 ratio from previous studies, with an MLP expansion ratio of 4."}),"\n",(0,s.jsx)(n.h2,{id:"discussion",children:"Discussion"}),"\n",(0,s.jsx)(n.h3,{id:"imagenet-experiments",children:"ImageNet Experiments"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"imagenet",src:i(59789).A+"",width:"1506",height:"1046"})}),"\n",(0,s.jsx)(n.p,{children:'The PoolFormer experiment results are astonishing, surpassing many previously "carefully designed" models, including ViT, MLP-Mixer, and PVT. Simply using "average pooling" as a substitute for the Token-Mixer achieves remarkable performance, highlighting the importance of the MetaFormer architecture.'}),"\n",(0,s.jsx)(n.p,{children:"When plotted as a chart, it is evident that PoolFormer outperforms other models in terms of parameters and computational efficiency."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"imagenet_chart",src:i(91216).A+"",width:"1656",height:"492"})}),"\n",(0,s.jsx)(n.h3,{id:"ablation-experiments",children:"Ablation Experiments"}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsx)(n.p,{children:"Based on the title of this paper, this section is arguably the most crucial."})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"ablation",src:i(5567).A+"",width:"1706",height:"842"})}),"\n",(0,s.jsx)(n.p,{children:"To further validate PoolFormer's effectiveness, the authors conducted ablation experiments, gradually reverting the PoolFormer architecture to the original Transformer structure."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Token-Mixer"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Identity Mapping"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Replacing pooling with identity mapping, MetaFormer still achieved 74.3% top-1 accuracy, indicating that the MetaFormer architecture is key to performance."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Global Random Matrix"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Using a global random matrix for token mixing resulted in 75.8% accuracy, 1.5% higher than identity mapping."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Depthwise Convolution"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Replacing pooling with depthwise convolution, the model achieved 78.1% top-1 accuracy, 0.9% higher than PoolFormer-S12."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Pooling Size"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Testing pool sizes of 3, 5, and 7 found similar performance, with the default being pool size 3."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Modified Layer Normalization (MLN)"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Calculating the mean and variance of marked and channel dimensions, outperforming Layer Normalization and Batch Normalization by 0.7% and 0.8%, respectively."}),"\n",(0,s.jsx)(n.li,{children:"Removing normalization reduced performance to 46.1%."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"GELU vs ReLU vs SiLU"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Using ReLU, performance dropped by 0.8%."}),"\n",(0,s.jsx)(n.li,{children:"Using SiLU, performance was the same as GELU."}),"\n",(0,s.jsx)(n.li,{children:"GELU is the default choice."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Residual Connection and Channel MLP"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Without residual connection or channel MLP, the model failed to converge, with accuracy only 0.1%/5.7%."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Hybrid Models"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Using pooling at the bottom stage and attention or spatial MLP-based mixers at the top stage achieved 81.0% accuracy with 16.5M parameters and 2.5G MAC."}),"\n",(0,s.jsx)(n.li,{children:"Compared to ResMLP-B24, which required 116M parameters and 23G MACs for the same accuracy."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Based on these ablation experiments, the authors concluded several points:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The MetaFormer architecture is key to performance."}),"\n",(0,s.jsx)(n.li,{children:"Simple pooling as a Token-Mixer can achieve competitive performance."}),"\n",(0,s.jsx)(n.li,{children:"Modified Layer Normalization (MLN) outperforms standard LayerNorm and BatchNorm."}),"\n",(0,s.jsx)(n.li,{children:"Residual connections and Channel MLP are indispensable components."}),"\n",(0,s.jsx)(n.li,{children:"Combining pooling with other Token-Mixers may be a promising direction for performance improvement."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,s.jsxs)(n.p,{children:["In this study, the authors abstracted the original Transformer into a general MetaFormer architecture. This abstraction highlights that the attention mechanism in Transformers can be generalized as a Token-Mixer, providing a flexible and powerful framework. By using pooling, a highly simplistic operation, as the Token-Mixer, the authors demonstrated the competitive performance of the PoolFormer model across various vision tasks, strongly supporting the claim that ",(0,s.jsx)(n.strong,{children:"MetaFormer Is Actually What You Need for Vision"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Future research directions include examining the broad applicability and robustness of the MetaFormer architecture. The authors suggest exploring the application of PoolFormer in natural language processing (NLP) tasks to verify MetaFormer\u2019s effectiveness in the NLP domain. If proven, the MetaFormer will solidify its status as a universal architecture."})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},37780:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/img1-784ca60cb7bc0e979eb540475a140384.jpg"},83843:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/img2-ced2cf08f2b70592ef4b287a8e4bf1d4.jpg"},24358:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/img3-11b44aa71835de830c9fa9a2526e3516.jpg"},59789:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/img4-59e093f46c8b71fa6f3de674f41cc96f.jpg"},91216:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/img5-5045869ac43b6f337fa7f15f6b6fbf65.jpg"},5567:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/img6-04ecd88774e5a38094c372b7d7f48bd9.jpg"},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var s=i(96540);const t={},r=s.createContext(t);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);