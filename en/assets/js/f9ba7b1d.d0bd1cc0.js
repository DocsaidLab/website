"use strict";(self.webpackChunkdocsaid_website=self.webpackChunkdocsaid_website||[]).push([["522"],{27626:function(e,n,r){r.r(n),r.d(n,{default:()=>h,frontMatter:()=>o,metadata:()=>t,assets:()=>a,toc:()=>d,contentTitle:()=>c});var t=JSON.parse('{"id":"mrzscanner/quickstart","title":"Quick Start","description":"We provide a simple model inference interface that includes both preprocessing and postprocessing logic.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/mrzscanner/quickstart.md","sourceDirName":"mrzscanner","slug":"/mrzscanner/quickstart","permalink":"/en/docs/mrzscanner/quickstart","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"zephyr-sh","lastUpdatedAt":1740280801000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Installation","permalink":"/en/docs/mrzscanner/installation"},"next":{"title":"Advanced Settings","permalink":"/en/docs/mrzscanner/advance"}}'),i=r("85893"),s=r("50065");let o={sidebar_position:3},c="Quick Start",a={},d=[{value:"Model Inference",id:"model-inference",level:2},{value:"Using the <code>do_center_crop</code> Parameter",id:"using-the-do_center_crop-parameter",level:2},{value:"Using the <code>do_postprocess</code> Parameter",id:"using-the-do_postprocess-parameter",level:2},{value:"Using with <code>DocAligner</code>",id:"using-with-docaligner",level:2},{value:"Error Messages",id:"error-messages",level:2},{value:"Check Digits",id:"check-digits",level:2}];function l(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"quick-start",children:"Quick Start"})}),"\n",(0,i.jsx)(n.p,{children:"We provide a simple model inference interface that includes both preprocessing and postprocessing logic."}),"\n",(0,i.jsx)(n.h2,{id:"model-inference",children:"Model Inference"}),"\n",(0,i.jsx)(n.p,{children:"First, don\u2019t worry about anything\u2014just run the following code and check if it executes successfully:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import cv2\nfrom skimage import io\nfrom mrzscanner import MRZScanner\n\n# Create the model\nmodel = MRZScanner()\n\n# Read image from URL\nimg = io.imread('https://github.com/DocsaidLab/MRZScanner/blob/main/docs/test_mrz.jpg?raw=true')\nimg = cv2.cvtColor(img, cv2.COLOR_RGB2BGR)\n\n# Model inference\nresult = model(img, do_center_crop=True, do_postprocess=False)\n\n# Output result\nprint(result)\n# {\n#     'mrz_polygon':\n#         array(\n#             [\n#                 [ 158.536 , 1916.3734],\n#                 [1682.7792, 1976.1683],\n#                 [1677.1018, 2120.8926],\n#                 [ 152.8586, 2061.0977]\n#             ],\n#             dtype=float32\n#         ),\n#     'mrz_texts': [\n#         'PCAZEQAQARIN<<FIDAN<<<<<<<<<<<<<<<<<<<<<<<<<',\n#         'C946302620AZE6707297F23031072W12IMJ<<<<<<<40'\n#     ],\n#     'msg': <ErrorCodes.NO_ERROR: 'No error.'>\n# }\n"})}),"\n",(0,i.jsx)(n.p,{children:"If it runs successfully, let\u2019s dive into the details of the code below."}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"We have designed an automatic model download feature. When the program detects that the model is missing, it will automatically connect to our server and download it."})}),"\n",(0,i.jsxs)(n.admonition,{type:"tip",children:[(0,i.jsxs)(n.p,{children:["In the example above, the image download link is referenced here: ",(0,i.jsx)(n.a,{href:"https://github.com/DocsaidLab/MRZScanner/blob/main/docs/test_mrz.jpg",children:(0,i.jsx)(n.strong,{children:"midv2020_test_mrz.jpg"})})]}),(0,i.jsx)("div",{align:"center",children:(0,i.jsx)("figure",{style:{width:"30%"},children:(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"test_mrz",src:r(4132).Z+"",width:"2160",height:"3840"})})})})]}),"\n",(0,i.jsxs)(n.h2,{id:"using-the-do_center_crop-parameter",children:["Using the ",(0,i.jsx)(n.code,{children:"do_center_crop"})," Parameter"]}),"\n",(0,i.jsxs)(n.p,{children:["This image was likely taken with a mobile device, which is long and narrow. If we directly infer it with the model, it could result in excessive distortion of the text. Therefore, we use the ",(0,i.jsx)(n.code,{children:"do_center_crop"})," parameter during inference. This parameter is used to center-crop the image."]}),"\n",(0,i.jsxs)(n.p,{children:["By default, this parameter is set to ",(0,i.jsx)(n.code,{children:"False"})," because we believe that images should not be modified without the user\u2019s knowledge. However, in practical applications, the images we encounter are often not in standard square dimensions."]}),"\n",(0,i.jsx)(n.p,{children:"In reality, images come in many different sizes and aspect ratios, such as:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Photos taken with mobile phones commonly use a 9:16 aspect ratio;"}),"\n",(0,i.jsx)(n.li,{children:"Scanned documents typically follow A4 paper size ratios;"}),"\n",(0,i.jsx)(n.li,{children:"Webpage screenshots often have a 16:9 aspect ratio;"}),"\n",(0,i.jsx)(n.li,{children:"Images taken by webcams are usually in a 4:3 ratio."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"These non-square images, when inferred without proper processing, often contain irrelevant areas or empty spaces, which can negatively affect the model\u2019s inference results. Center cropping helps effectively reduce these irrelevant areas and focus on the central part of the image, thus improving both inference accuracy and efficiency."}),"\n",(0,i.jsx)(n.p,{children:"Usage:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from mrzscanner import MRZScanner\n\nmodel = MRZScanner()\n\nresult = model(img, do_center_crop=True) # Use center cropping\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"When to use"}),": Use center cropping when the image ratio is not square and does not crop into the MRZ area."]})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"MRZScanner"})," has already been encapsulated using ",(0,i.jsx)(n.code,{children:"__call__"}),", so you can directly call the instance for inference."]})}),"\n",(0,i.jsxs)(n.h2,{id:"using-the-do_postprocess-parameter",children:["Using the ",(0,i.jsx)(n.code,{children:"do_postprocess"})," Parameter"]}),"\n",(0,i.jsxs)(n.p,{children:["In addition to center cropping, we also provide a postprocessing option ",(0,i.jsx)(n.code,{children:"do_postprocess"})," to further improve the accuracy of the model."]}),"\n",(0,i.jsxs)(n.p,{children:["This parameter is also set to ",(0,i.jsx)(n.code,{children:"False"})," by default, for the same reason as before: we believe that the recognition result should not be modified without the user's awareness."]}),"\n",(0,i.jsxs)(n.p,{children:["In real-world applications, there are rules for the MRZ block, such as: country codes must be uppercase letters, gender can only be ",(0,i.jsx)(n.code,{children:"M"})," or ",(0,i.jsx)(n.code,{children:"F"}),", and fields related to dates must contain only digits. These rules can help regulate the MRZ block."]}),"\n",(0,i.jsx)(n.p,{children:"Therefore, we perform manual corrections on fields that can be standardized. Below is a code snippet that demonstrates the concept of postprocessing, where we replace possibly misrecognized digits with the correct characters in fields where numbers are not expected:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import re\n\ndef replace_digits(text: str):\n    text = re.sub('0', 'O', text)\n    text = re.sub('1', 'I', text)\n    text = re.sub('2', 'Z', text)\n    text = re.sub('4', 'A', text)\n    text = re.sub('5', 'S', text)\n    text = re.sub('8', 'B', text)\n    return text\n\nif doc_type == 3:  # TD1\n    if len(results[0]) != 30 or len(results[1]) != 30 or len(results[2]) != 30:\n        return [''], ErrorCodes.POSTPROCESS_FAILED_TD1_LENGTH\n    # Line1\n    doc = results[0][0:2]\n    country = replace_digits(results[0][2:5])\n"})}),"\n",(0,i.jsx)(n.p,{children:"Although this postprocessing step did not improve our accuracy in this project, keeping this functionality can still correct misrecognized results in certain situations."}),"\n",(0,i.jsxs)(n.p,{children:["You may want to set ",(0,i.jsx)(n.code,{children:"do_postprocess"})," to ",(0,i.jsx)(n.code,{children:"True"})," during inference for potentially better results:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"result = model(img, do_postprocess=True)\n"})}),"\n",(0,i.jsx)(n.p,{children:"Alternatively, if you prefer to see the raw output from the model, you can stick with the default value."}),"\n",(0,i.jsxs)(n.h2,{id:"using-with-docaligner",children:["Using with ",(0,i.jsx)(n.code,{children:"DocAligner"})]}),"\n",(0,i.jsxs)(n.p,{children:["Sometimes, even with the ",(0,i.jsx)(n.code,{children:"do_center_crop"})," parameter, detection may still fail. In such cases, we can use ",(0,i.jsx)(n.code,{children:"DocAligner"})," to help find the document's location before performing MRZ recognition."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import cv2\nfrom docaligner import DocAligner # Import DocAligner\nfrom mrzscanner import MRZScanner\nfrom capybara import imwarp_quadrangle\nfrom skimage import io\n\nmodel = MRZScanner()\n\ndoc_aligner = DocAligner()\n\nimg = io.imread('https://github.com/DocsaidLab/MRZScanner/blob/main/docs/test_mrz.jpg?raw=true')\nimg = cv2.cvtColor(img, cv2.COLOR_RGB2BGR)\n\npolygon = doc_aligner(img)\nflat_img = imwarp_quadrangle(img, polygon, dst_size=(800, 480))\n\nprint(model(flat_img))\n# {\n#     'mrz_polygon':\n#         array(\n#         [\n#             [ 34.0408 , 378.497  ],\n#             [756.4258 , 385.0492 ],\n#             [755.8944 , 443.63843],\n#             [ 33.5094 , 437.08618]\n#         ], dtype=float32\n#     ),\n#     'mrz_texts': [\n#         'PCAZEQAQARIN<<FIDAN<<<<<<<<<<<<<<<<<<<<<<<<<',\n#         'C946302620AZE6707297F23031072W12IMJ<<<<<<<40'\n#     ],\n#     'msg': <ErrorCodes.NO_ERROR: 'No error.'>\n# }\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["When using ",(0,i.jsx)(n.code,{children:"DocAligner"})," for preprocessing, the MRZ may already occupy a certain area of the image. Therefore, you don't need to use the ",(0,i.jsx)(n.code,{children:"do_center_crop"})," parameter, as center cropping may cut off parts of the MRZ."]})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["For more details on how to use ",(0,i.jsx)(n.code,{children:"DocAligner"}),", refer to the ",(0,i.jsx)(n.a,{href:"https://docsaid.org/en/docs/docaligner/",children:(0,i.jsx)(n.strong,{children:"DocAligner Technical Documentation"})}),"."]})}),"\n",(0,i.jsx)(n.h2,{id:"error-messages",children:"Error Messages"}),"\n",(0,i.jsxs)(n.p,{children:["To help users understand the causes of errors, we have designed the ",(0,i.jsx)(n.code,{children:"ErrorCodes"})," class."]}),"\n",(0,i.jsx)(n.p,{children:"When the model encounters an error during inference, it will return an error message, covering issues such as:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class ErrorCodes(Enum):\n    NO_ERROR = 'No error.'\n    INVALID_INPUT_FORMAT = 'Invalid input format.'\n    POSTPROCESS_FAILED_LINE_COUNT = 'Postprocess failed, number of lines not 2 or 3.'\n    POSTPROCESS_FAILED_TD1_LENGTH = 'Postprocess failed, length of lines not 30 when `doc_type` is TD1.'\n    POSTPROCESS_FAILED_TD2_TD3_LENGTH = 'Postprocess failed, length of lines not 36 or 44 when `doc_type` is TD2 or TD3.'\n"})}),"\n",(0,i.jsx)(n.p,{children:"Basic errors, such as incorrect input format or incorrect line count, are filtered here."}),"\n",(0,i.jsx)(n.h2,{id:"check-digits",children:"Check Digits"}),"\n",(0,i.jsx)(n.p,{children:"Check digits in the MRZ are crucial for ensuring the accuracy of the data. They are used to verify the correctness of numeric data, preventing data entry errors."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["For detailed procedures, please refer to ",(0,i.jsx)(n.a,{href:"./reference#check-digit",children:(0,i.jsx)(n.strong,{children:"Reference: Check Digits"})}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:"In this section, we want to highlight:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"We do not provide a check digit calculation function!"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This is because the check digit calculation method for MRZ is not uniform. Besides the standard check digit calculation method, MRZs from different regions can define their own calculation methods. Therefore, providing a single check digit calculation method may limit user flexibility."}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsx)(n.p,{children:"Fun fact:"}),(0,i.jsx)(n.p,{children:"The check digit calculation for Taiwan's foreign resident permits' MRZ differs from the global standard. Without collaboration with the government, the calculation method for this check digit is not publicly available."})]}),"\n",(0,i.jsxs)(n.p,{children:["Our goal is to train a model focused on MRZ recognition, where each output's format is automatically determined by the model. There are many other open-source projects that provide check digit calculation functionality, such as ",(0,i.jsx)(n.a,{href:"https://github.com/Arg0s1080/mrz",children:(0,i.jsx)(n.strong,{children:"Arg0s1080/mrz"})}),". We recommend users utilize this project for check digit calculations."]})]})}function h(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},4132:function(e,n,r){r.d(n,{Z:function(){return t}});let t=r.p+"assets/images/test_mrz-677fee313daebc656fb474f194ee59e0.jpg"},50065:function(e,n,r){r.d(n,{Z:function(){return c},a:function(){return o}});var t=r(67294);let i={},s=t.createContext(i);function o(e){let n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);