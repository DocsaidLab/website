"use strict";(self.webpackChunkdocsaid_website=self.webpackChunkdocsaid_website||[]).push([["72789"],{47233:function(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>a});var i=t(20179),o=t(85893),s=t(50065);let r={slug:"setting-up-nextcloud",title:"Setting Up Nextcloud: A Guide",authors:"Z. Yuan",tags:["Nextcloud","Docker"],image:"/en/img/2024/0304.webp",description:"Documenting the process of setting up Nextcloud on Ubuntu 22.04."},l=void 0,c={authorsImageUrls:[void 0]},a=[{value:"Installing Nextcloud",id:"installing-nextcloud",level:2},{value:"Setting Up Nextcloud All-in-One",id:"setting-up-nextcloud-all-in-one",level:2},{value:"Configuring System Services",id:"configuring-system-services",level:2},{value:"Starting Nextcloud",id:"starting-nextcloud",level:2},{value:"Setting Up Nextcloud",id:"setting-up-nextcloud",level:2},{value:"Common Issues",id:"common-issues",level:2},{value:"Final Thoughts",id:"final-thoughts",level:2},{value:"Conclusion",id:"conclusion",level:2}];function d(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["I used to store my files on Google Drive and download them using the ",(0,o.jsx)(n.code,{children:"wget"})," command."]}),"\n",(0,o.jsx)(n.p,{children:"Until one day, Google made a small update, and suddenly, the original download command no longer worked..."}),"\n",(0,o.jsx)(n.p,{children:"Very frustrating."}),"\n",(0,o.jsx)(n.p,{children:"Since that's the case, I decided to try Nextcloud. Here\u2019s how I set it up on Ubuntu 22.04."}),"\n",(0,o.jsxs)(n.admonition,{type:"tip",children:[(0,o.jsx)(n.p,{children:"Before you begin, make sure you have a domain name and point it to your server."}),(0,o.jsx)(n.p,{children:"If you're unsure how to do this, just ask ChatGPT, and it will guide you through the process."})]}),"\n",(0,o.jsx)(n.h2,{id:"installing-nextcloud",children:"Installing Nextcloud"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"First Question: Why use Nextcloud?"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"I want a private cloud and don\u2019t want to store my files on someone else's server."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Second Question: What\u2019s the difference between Nextcloud and Owncloud?"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Nextcloud was forked from Owncloud by its original developers. The functionalities are quite similar, but Nextcloud develops faster."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Third Question: How do you install Nextcloud?"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"This is a bit more complicated because there are many installation methods, each with its pros and cons."}),"\n",(0,o.jsx)(n.li,{children:"In this article, the only installation method I recommend is using Docker."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"setting-up-nextcloud-all-in-one",children:"Setting Up Nextcloud All-in-One"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Refer to the official documentation: ",(0,o.jsx)(n.a,{href:"https://github.com/nextcloud/all-in-one",children:(0,o.jsx)(n.strong,{children:"Nextcloud All-in-One"})})]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"First, make sure you have Docker and Docker Compose installed."})}),"\n",(0,o.jsxs)(n.p,{children:["Next, create a directory for Nextcloud and write a ",(0,o.jsx)(n.code,{children:"docker-compose.yml"})," configuration file:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"mkdir nextcloud\nvim nextcloud/docker-compose.yml\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Copy the following content into the ",(0,o.jsx)(n.code,{children:"docker-compose.yml"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"services:\n  nextcloud-aio-mastercontainer:\n    image: nextcloud/all-in-one:latest  # Specify the Docker container image to use\n    init: true  # Prevent zombie processes; keep this option\n    restart: always  # Set the container restart policy to auto-restart with Docker daemon\n    container_name: nextcloud-aio-mastercontainer  # Set the container name; do not change to avoid update issues\n    volumes:\n      - nextcloud_aio_mastercontainer:/mnt/docker-aio-config  # Storage location for mastercontainer; this setting cannot be changed\n      - /var/run/docker.sock:/var/run/docker.sock:ro  # Mount Docker socket to control other containers and functionalities; adjust for Windows/macOS or rootless mode\n    ports:\n      - 80:80    # For obtaining valid certificates via the AIO interface, optional\n      - 8080:8080  # Default AIO interface (self-signed certificate); if port 8080 on host is occupied, change it (e.g., 8081:8080)\n      - 8443:8443  # For accessing the AIO interface and obtaining valid certificates; optional\n\nvolumes:\n  nextcloud_aio_mastercontainer:\n    name: nextcloud_aio_mastercontainer  # Docker volume name; this setting cannot be changed\n"})}),"\n",(0,o.jsxs)(n.p,{children:["For more detailed settings, refer to the official documentation: ",(0,o.jsx)(n.a,{href:"https://github.com/nextcloud/all-in-one/blob/main/compose.yaml",children:(0,o.jsx)(n.strong,{children:"compose.yaml"})})]}),"\n",(0,o.jsx)(n.h2,{id:"configuring-system-services",children:"Configuring System Services"}),"\n",(0,o.jsx)(n.p,{children:"After completing the above settings, configure the system service."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo vim /etc/systemd/system/nextcloud.service\n"})}),"\n",(0,o.jsx)(n.p,{children:"Paste the following content:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",metastring:"{7}",children:"[Unit]\nDescription=NextCloud Docker Compose\nRequires=docker.service\nAfter=docker.service\n\n[Service]\nWorkingDirectory=/home/[YourName]/nextcloud\nExecStart=/usr/bin/docker compose up --remove-orphans\nExecStop=/usr/bin/docker compose down\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Make sure to replace ",(0,o.jsx)(n.code,{children:"[YourName]"})," with your actual username."]}),"\n",(0,o.jsx)(n.h2,{id:"starting-nextcloud",children:"Starting Nextcloud"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo systemctl enable nextcloud\nsudo systemctl start nextcloud\n"})}),"\n",(0,o.jsx)(n.h2,{id:"setting-up-nextcloud",children:"Setting Up Nextcloud"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Access the Nextcloud AIO Interface"}),":"]}),"\n",(0,o.jsxs)(n.p,{children:["After the initial startup, visit ",(0,o.jsx)(n.code,{children:"https://ip.address.of.this.server:8080"})," to access the Nextcloud AIO interface, replacing ",(0,o.jsx)(n.code,{children:"ip.address.of.this.server"})," with your server\u2019s IP address. Ensure Docker and Nextcloud AIO are correctly installed and running; the first startup may take a few minutes."]}),"\n",(0,o.jsx)(n.p,{children:"It's recommended to access the 8080 port using the IP address instead of the domain, as HTTP Strict Transport Security (HSTS) might restrict domain access. HSTS requires the browser to connect to the site only over HTTPS."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Using the Self-Signed Certificate"}),":"]}),"\n",(0,o.jsx)(n.p,{children:"When accessed via port 8080, the system may use a self-signed certificate for secure communication."}),"\n",(0,o.jsx)(n.p,{children:"Since this certificate isn\u2019t issued by a trusted certificate authority (CA), the browser may show an untrusted warning. You\u2019ll need to manually accept it as directed by the browser. It\u2019s advisable to use this only in testing environments. Self-signed certificates are not suitable for production environments."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Automating Valid Certificate Retrieval"}),":"]}),"\n",(0,o.jsxs)(n.p,{children:["If your firewall or router has opened or correctly forwarded ports 80 and 8443, and you have pointed a domain to the server, you can automatically obtain a valid certificate from a trusted CA (like Let's Encrypt) via ",(0,o.jsx)(n.code,{children:"https://your-domain-that-points-to-this-server.tld:8443"}),", which improves security and convenience."]}),"\n",(0,o.jsxs)(n.p,{children:["Make sure to replace ",(0,o.jsx)(n.code,{children:"your-domain-that-points-to-this-server.tld"})," with the correct domain and ensure that DNS settings are effective, checking that the firewall allows the connection."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Open Ports for Nextcloud Talk"}),":"]}),"\n",(0,o.jsx)(n.p,{children:"To ensure Nextcloud Talk (for video calls and messaging) works properly, you need to open ports 3478/TCP and 3478/UDP in the firewall or router for the Talk container."}),"\n",(0,o.jsx)(n.p,{children:"If you're in a NAT environment, verify that port forwarding is correctly configured and check with your ISP to ensure they haven\u2019t blocked these UDP ports."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"common-issues",children:"Common Issues"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Dynamic IP at Home, How to Point to Domain?"})}),"\n",(0,o.jsx)(n.p,{children:"Besides using dynamic DNS solutions like No-IP, I found that directly applying for a fixed IP from Chunghwa Telecom was the fastest and most stable solution."}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsx)(n.p,{children:"If you're not a reader from Taiwan, you might want to ask your country's telecom provider if they offer this service."})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"I Don\u2019t Want to Use Docker, Are There Alternatives?"})}),"\n",(0,o.jsx)(n.p,{children:"Yes, you can install Nextcloud directly, but you'll have to manage all dependencies and environment configurations yourself, which can lead to many challenges."}),"\n",(0,o.jsx)(n.p,{children:"After being stuck multiple times, I ended up going back to the Docker method, so why not use Docker from the start?"}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Why Can\u2019t I Connect After Setup?"})}),"\n",(0,o.jsx)(n.p,{children:"Check if your firewall settings allow the necessary connections. If the firewall is correctly configured, there may be issues with port forwarding on your router. It\u2019s recommended to check Docker logs for more detailed error information."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"final-thoughts",children:"Final Thoughts"}),"\n",(0,o.jsx)(n.p,{children:"After entering the setup URL, you\u2019ll be greeted by a more advanced setup interface."}),"\n",(0,o.jsx)("div",{align:"center",children:(0,o.jsx)("figure",{style:{width:"70%"},children:(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"login_1",src:t(36862).Z+"",width:"1224",height:"824"})})})}),"\n",(0,o.jsx)(n.p,{children:"At this point, you may be surprised to find:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"I don\u2019t have a password!"})}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The system generates a password on first login, but you may have overlooked it."}),"\n",(0,o.jsx)(n.p,{children:"If you forgot it, don\u2019t worry, you can query it with the following command:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo grep password /var/lib/docker/volumes/nextcloud_aio_mastercontainer/_data/data/configuration.json\n"})}),"\n",(0,o.jsx)(n.p,{children:"After logging in, you will see the following setup screen:"}),"\n",(0,o.jsx)("div",{align:"center",children:(0,o.jsx)("figure",{style:{width:"70%"},children:(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"login_2",src:t(82549).Z+"",width:"1224",height:"696"})})})}),"\n",(0,o.jsx)(n.p,{children:"This screen indicates that the setup is complete."}),"\n",(0,o.jsx)(n.p,{children:"For the first login, input the domain you previously prepared, and the system will download the necessary Docker images and restart automatically. After the startup is complete, you can begin using Nextcloud and it\u2019s recommended to change the default password and check other security settings as soon as possible."}),"\n",(0,o.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,o.jsx)(n.p,{children:"After completing the steps above, input your domain in the URL bar, and you\u2019ll see a nice interface, which is your private cloud."}),"\n",(0,o.jsx)("div",{align:"center",children:(0,o.jsx)("figure",{style:{width:"70%"},children:(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"login_3",src:t(25920).Z+"",width:"2777",height:"1595"})})})}),"\n",(0,o.jsx)(n.p,{children:"This interface has many features\u2014you can manage your files through it, and also share them."}),"\n",(0,o.jsx)(n.p,{children:"Additionally, you can download the Nextcloud app on your phone to manage your files directly from your device."}),"\n",(0,o.jsx)(n.p,{children:"With Nextcloud, you no longer need to worry about Google Drive\u2019s storage limitations."}),"\n",(0,o.jsxs)(n.admonition,{type:"tip",children:[(0,o.jsx)(n.p,{children:"If you have other services running on your server, you can use Nginx as a reverse proxy to forward the Nextcloud domain."}),(0,o.jsx)(n.p,{children:"This is beyond the scope of this chapter, but we can discuss it later."})]})]})}function u(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},36862:function(e,n,t){t.d(n,{Z:()=>i});let i=t.p+"assets/images/login_1-edb2b961d180558b75e337c1083a7202.jpg"},82549:function(e,n,t){t.d(n,{Z:()=>i});let i=t.p+"assets/images/login_2-6e2d377746b11b87dcd476a7db06ecb2.jpg"},25920:function(e,n,t){t.d(n,{Z:()=>i});let i=t.p+"assets/images/login_3-b4f2e8aa169715059997b910227d0773.jpg"},50065:function(e,n,t){t.d(n,{Z:()=>l,a:()=>r});var i=t(67294);let o={},s=i.createContext(o);function r(e){let n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:n},e.children)}},20179:function(e){e.exports=JSON.parse('{"permalink":"/en/blog/setting-up-nextcloud","source":"@site/i18n/en/docusaurus-plugin-content-blog/2024/03-04-setup-nextcloud/index.md","title":"Setting Up Nextcloud: A Guide","description":"Documenting the process of setting up Nextcloud on Ubuntu 22.04.","date":"2024-03-04T00:00:00.000Z","tags":[{"inline":true,"label":"Nextcloud","permalink":"/en/blog/tags/nextcloud"},{"inline":true,"label":"Docker","permalink":"/en/blog/tags/docker"}],"readingTime":6.13,"hasTruncateMarker":true,"authors":[{"name":"Z. Yuan","title":"Dosaid maintainer, Full-Stack AI Engineer","url":"https://github.com/zephyr-sh","socials":{"github":"https://github.com/zephyr-sh","linkedin":"https://www.linkedin.com/in/ze-yuan-sh7/"},"imageURL":"https://github.com/zephyr-sh.png","key":"Z. Yuan","page":null}],"frontMatter":{"slug":"setting-up-nextcloud","title":"Setting Up Nextcloud: A Guide","authors":"Z. Yuan","tags":["Nextcloud","Docker"],"image":"/en/img/2024/0304.webp","description":"Documenting the process of setting up Nextcloud on Ubuntu 22.04."},"unlisted":false,"prevItem":{"title":"Common VSCode Configuration Settings","permalink":"/en/blog/vscode-settings"},"nextItem":{"title":"The PyTorch List Trap","permalink":"/en/blog/pytorch-training-out-of-memory"}}')}}]);