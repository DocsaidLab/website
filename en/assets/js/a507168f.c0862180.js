"use strict";(self.webpackChunkdocsaid_website=self.webpackChunkdocsaid_website||[]).push([["6903"],{89730:function(e,n,t){t.r(n),t.d(n,{assets:()=>h,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>a});var i=t(60501),s=t(85893),o=t(50065);let r={slug:"mac-selective-vpn-routing",title:"Configuring Selective Traffic Routing for VPN",authors:"Z. Yuan",tags:["vpn-routing","macos"],image:"/en/img/2023/0901.webp",description:"Setting up VPN routing on macOS."},l=void 0,h={authorsImageUrls:[void 0]},a=[{value:"Configuration Guide",id:"configuration-guide",level:2},{value:"Problem Description",id:"problem-description",level:2},{value:"Solution",id:"solution",level:2},{value:"Is it still not working?",id:"is-it-still-not-working",level:2},{value:"References",id:"references",level:2}];function c(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Working remotely using a company-configured VPN, but still wanting to use other machines on your local network."}),"\n",(0,s.jsx)(n.h2,{id:"configuration-guide",children:"Configuration Guide"}),"\n",(0,s.jsx)(n.p,{children:"This guide uses macOS as the operating system."}),"\n",(0,s.jsx)(n.h2,{id:"problem-description",children:"Problem Description"}),"\n",(0,s.jsx)(n.p,{children:"For example:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Company VPN subnet"}),": 192.168.25.XXX"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Home subnet"}),": 192.168.1.XXX"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"When you connect to the VPN, all traffic is routed through the company's subnet, which means you won\u2019t be able to connect to other machines on the same home network."}),"\n",(0,s.jsx)(n.p,{children:"Not only that, but while you were watching a funny video at home, the company\u2019s network administrator might have been laughing along with you. (???)"}),"\n",(0,s.jsx)(n.p,{children:"Something seems off, right?"}),"\n",(0,s.jsxs)(n.p,{children:["So what we need to do is: ",(0,s.jsx)(n.strong,{children:"Route only the company's subnet through the VPN, and let all other traffic use the local network."})]}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsx)(n.p,{children:"Here, we assume that you've already configured the VPN and it's working correctly, and now we\u2019re only addressing the traffic routing issue."}),(0,s.jsx)(n.p,{children:"If the VPN isn\u2019t working correctly yet, please check that your VPN settings are properly configured first."})]}),"\n",(0,s.jsx)(n.h2,{id:"solution",children:"Solution"}),"\n",(0,s.jsx)(n.p,{children:"Step one: First, identify the company\u2019s internal subnet, such as:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"192.168.25.XXX"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This indicates that you're working with the 25 subnet. Now, let\u2019s open a file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo vim /etc/ppp/ip-up\n"})}),"\n",(0,s.jsx)(n.p,{children:"Enter the following content, but be sure to replace it with your actual subnet:"}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsx)(n.p,{children:"Please note, this example assumes the VPN subnet is 192.168.25.XXX. Modify it according to your actual setup."})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"#!/bin/sh\n/sbin/route add -net 192.168.25.0/24 -interface ppp0\n"})}),"\n",(0,s.jsx)(n.p,{children:"Let\u2019s explain what the command above does:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"/sbin/route"}),": This is the path to the route command, which is used to configure network routes."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"-net 192.168.25.0/24"}),": The parameter specifies that this is a network route, not a host route.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"192.168.25.0/24 represents the network address and subnet mask, covering the IP range from 192.168.25.0 to 192.168.25.255."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"-interface ppp0"}),": Specifies the network interface through which the route should be set.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"In this example, it's ppp0 (point-to-point protocol interface 0)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The whole command adds a route through the ppp0 interface to the 192.168.25.0/24 network."}),"\n",(0,s.jsx)(n.p,{children:"When your system tries to access any IP address in the 192.168.25.0/24 network, it will route the traffic through the ppp0 interface."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:"After finishing the setup, save and exit the file, then give the file the correct permissions:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo chmod 755 /etc/ppp/ip-up\n"})}),"\n",(0,s.jsx)(n.h2,{id:"is-it-still-not-working",children:"Is it still not working?"}),"\n",(0,s.jsx)(n.p,{children:"At this point, some machines may still be unable to access the internet. So, let\u2019s move on:"}),"\n",(0,s.jsx)(n.p,{children:"Open the System Preferences on macOS and go to Network, as shown in the image below:"}),"\n",(0,s.jsx)("div",{align:"center",children:(0,s.jsx)("figure",{style:{width:"80%"},children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"vpn-setting",src:t(96718).Z+"",width:"2048",height:"1699"})})})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'Step 1: Open System Preferences and click on "Network."'}),"\n",(0,s.jsx)(n.li,{children:"Step 2: Click on the small options button next to the VPN connection."}),"\n",(0,s.jsx)(n.li,{children:'Step 3: Select "Set Service Order."'}),"\n",(0,s.jsx)(n.li,{children:"Step 4: Drag the VPN service below Wi-Fi in the list."}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:"Many users, after setting up the VPN, move the VPN service to the top of the list, meaning all traffic is routed through the VPN by default."}),"\n",(0,s.jsx)(n.p,{children:"So here, we need to move the VPN down, which will allow the network settings above it to take effect."}),"\n",(0,s.jsxs)(n.p,{children:["Once that\u2019s done, you're all set. If you need other traffic to go through the VPN in the future, simply add the necessary routes to the ",(0,s.jsx)(n.code,{children:"ip-up"})," file."]}),"\n",(0,s.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://gist.github.com/shalyf/d50b0bbf30a4b5020d2b84f4ae8eb4e0",children:"shalyf/vpn_route.md"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://superuser.com/questions/4904/how-to-selectively-route-network-traffic-through-vpn-on-mac-os-x-leopard",children:"How to selectively route network traffic through VPN on Mac OS X Leopard?"})}),"\n"]})]})}function u(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},96718:function(e,n,t){t.d(n,{Z:()=>i});let i=t.p+"assets/images/vpn-setting-bd7c48703bedfb577a1954606aad8726.jpg"},50065:function(e,n,t){t.d(n,{Z:()=>l,a:()=>r});var i=t(67294);let s={},o=i.createContext(s);function r(e){let n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}},60501:function(e){e.exports=JSON.parse('{"permalink":"/en/blog/mac-selective-vpn-routing","source":"@site/i18n/en/docusaurus-plugin-content-blog/2023/09-01-mac-selective-vpn-routing/index.md","title":"Configuring Selective Traffic Routing for VPN","description":"Setting up VPN routing on macOS.","date":"2023-09-01T00:00:00.000Z","tags":[{"inline":true,"label":"vpn-routing","permalink":"/en/blog/tags/vpn-routing"},{"inline":true,"label":"macos","permalink":"/en/blog/tags/macos"}],"readingTime":2.98,"hasTruncateMarker":true,"authors":[{"name":"Z. Yuan","title":"Dosaid maintainer, Full-Stack AI Engineer","url":"https://github.com/zephyr-sh","socials":{"github":"https://github.com/zephyr-sh","linkedin":"https://www.linkedin.com/in/ze-yuan-sh7/"},"imageURL":"https://github.com/zephyr-sh.png","key":"Z. Yuan","page":null}],"frontMatter":{"slug":"mac-selective-vpn-routing","title":"Configuring Selective Traffic Routing for VPN","authors":"Z. Yuan","tags":["vpn-routing","macos"],"image":"/en/img/2023/0901.webp","description":"Setting up VPN routing on macOS."},"unlisted":false,"prevItem":{"title":"Unicode Table","permalink":"/en/blog/unicode-table"}}')}}]);