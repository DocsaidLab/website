"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([["94165"],{80987:function(n,e,t){t.r(e),t.d(e,{metadata:()=>s,contentTitle:()=>a,default:()=>m,assets:()=>l,toc:()=>p,frontMatter:()=>r});var s=JSON.parse('{"id":"gmailsummary/openaiapi_using","title":"OpenAI API \u306E\u547C\u3073\u51FA\u3057","description":"OpenAI \u306E API \u306F\u591A\u304F\u306E\u6A5F\u80FD\u3092\u63D0\u4F9B\u3057\u3066\u3044\u307E\u3059\u304C\u3001\u4ECA\u56DE\u306F\u300CText generation models\u300D\u6A5F\u80FD\u3092\u4F7F\u7528\u3057\u307E\u3059\u3002\u3053\u306E\u6A5F\u80FD\u306B\u3088\u308A\u3001\u5165\u529B\u3055\u308C\u305F\u30C6\u30AD\u30B9\u30C8\u3092\u57FA\u306B\u30E2\u30C7\u30EB\u304C\u7D9A\u304D\u3092\u66F8\u3044\u3066\u304F\u308C\u308B\u3088\u3046\u306B\u306A\u308A\u307E\u3059\u3002","source":"@site/i18n/ja/docusaurus-plugin-content-docs/current/gmailsummary/openaiapi_using.md","sourceDirName":"gmailsummary","slug":"/gmailsummary/openaiapi_using","permalink":"/ja/docs/gmailsummary/openaiapi_using","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"zephyr-sh","lastUpdatedAt":1732784460000,"sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"OpenAI API \u306E\u6709\u52B9\u5316","permalink":"/ja/docs/gmailsummary/openaiapi_login"},"next":{"title":"API \u6A5F\u80FD\u306E\u7D71\u5408","permalink":"/ja/docs/gmailsummary/integration"}}'),o=t("85893"),i=t("50065");let r={sidebar_position:6},a="OpenAI API \u306E\u547C\u3073\u51FA\u3057",l={},p=[{value:"\u30D1\u30C3\u30B1\u30FC\u30B8\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB",id:"\u30D1\u30C3\u30B1\u30FC\u30B8\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB",level:2},{value:"API \u306E\u4F7F\u7528",id:"api-\u306E\u4F7F\u7528",level:2}];function c(n){let e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"openai-api-\u306E\u547C\u3073\u51FA\u3057",children:"OpenAI API \u306E\u547C\u3073\u51FA\u3057"})}),"\n",(0,o.jsx)(e.p,{children:"OpenAI \u306E API \u306F\u591A\u304F\u306E\u6A5F\u80FD\u3092\u63D0\u4F9B\u3057\u3066\u3044\u307E\u3059\u304C\u3001\u4ECA\u56DE\u306F\u300CText generation models\u300D\u6A5F\u80FD\u3092\u4F7F\u7528\u3057\u307E\u3059\u3002\u3053\u306E\u6A5F\u80FD\u306B\u3088\u308A\u3001\u5165\u529B\u3055\u308C\u305F\u30C6\u30AD\u30B9\u30C8\u3092\u57FA\u306B\u30E2\u30C7\u30EB\u304C\u7D9A\u304D\u3092\u66F8\u3044\u3066\u304F\u308C\u308B\u3088\u3046\u306B\u306A\u308A\u307E\u3059\u3002"}),"\n",(0,o.jsx)(e.p,{children:"\u4EE5\u4E0B\u3067\u306F\u3001OpenAI API \u306E\u4F7F\u7528\u65B9\u6CD5\u3092\u7C21\u5358\u306B\u7D39\u4ECB\u3057\u307E\u3059\u3002"}),"\n",(0,o.jsx)(e.h2,{id:"\u30D1\u30C3\u30B1\u30FC\u30B8\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB",children:"\u30D1\u30C3\u30B1\u30FC\u30B8\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB"}),"\n",(0,o.jsxs)(e.p,{children:["\u307E\u305A\u3001",(0,o.jsx)(e.code,{children:"openai"}),"\u30D1\u30C3\u30B1\u30FC\u30B8\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\u3002\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u306A\u3044\u3068\u4F7F\u7528\u3067\u304D\u307E\u305B\u3093\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"pip install openai\n"})}),"\n",(0,o.jsx)(e.h2,{id:"api-\u306E\u4F7F\u7528",children:"API \u306E\u4F7F\u7528"}),"\n",(0,o.jsx)(e.p,{children:"\u6B21\u306B\u3001API \u3092\u4F7F\u3044\u59CB\u3081\u308B\u65B9\u6CD5\u3092\u898B\u3066\u307F\u307E\u3057\u3087\u3046\u3002\u4EE5\u4E0B\u306F OpenAI \u304C\u63D0\u4F9B\u3059\u308B\u30B5\u30F3\u30D7\u30EB\u30B3\u30FC\u30C9\u3067\u3059\uFF1A"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:'# OpenAI\u306E\u30B5\u30F3\u30D7\u30EB\u30B3\u30FC\u30C9\nfrom openai import OpenAI\nclient = OpenAI(api_key="YOUR_API_KEY")\n\ncompletion = client.chat.completions.create(\nmodel="gpt-3.5-turbo",\nmessages=[\n    {"role": "system", "content": "You are a poetic assistant, skilled in explaining complex programming concepts with creative flair."},\n    {"role": "user", "content": "Compose a poem that explains the concept of recursion in programming."}\n]\n)\n\nprint(completion.choices[0].message)\n'})}),"\n",(0,o.jsxs)(e.p,{children:["\u3053\u308C\u3092\u53C2\u8003\u306B\u3057\u3066\u3001\u79C1\u305F\u3061\u306E\u30CB\u30FC\u30BA\u306B\u5408\u3046\u3088\u3046\u306B\u30B3\u30FC\u30C9\u3092\u5909\u66F4\u3057\u307E\u3057\u305F\uFF1A",(0,o.jsx)(e.a,{href:"https://github.com/DocsaidLab/GmailSummary/blob/main/openai_api.py",children:(0,o.jsx)(e.strong,{children:"openai_api.py"})})]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:'import json\nimport os\nfrom typing import Dict, List\n\nimport tiktoken\nfrom openai import OpenAI\n\n\ndef chatgpt_summary(results: List[Dict[str, str]], model: str = \'gpt-3.5-turbo\') -> str:\n\n    # `OPENAI_API_KEY` \u74B0\u5883\u5909\u6570\u3092\u8A2D\u5B9A\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\n    client = OpenAI(api_key=os.environ[\'OPENAI_API_KEY\'])\n\n    prompt = \'\'\'\n        \u53D7\u4FE1\u3057\u305F\u30E1\u30FC\u30EB\u306E\u5185\u5BB9\u306B\u57FA\u3065\u304D\u3001\u3053\u308C\u3089\u306FGmail API\u304B\u3089\u306E\u89E3\u6790\u7D50\u679C\u3067\u3059\u3002\u91CD\u8981\u306A\u60C5\u5831\u3092\u62BD\u51FA\u3057\u3066\u304F\u3060\u3055\u3044\u3002\n        \u3053\u308C\u306B\u306F\u3001\u30D0\u30B0\u4FEE\u6B63\u3001\u6A5F\u80FD\u8FFD\u52A0\u3001\u8B70\u8AD6\u3055\u308C\u305F\u30C8\u30D4\u30C3\u30AF\u3001\u7279\u306B\u8A00\u53CA\u3055\u308C\u305F\u6210\u679C\u3084\u8AB2\u984C\u304C\u542B\u307E\u308C\u307E\u3059\u304C\u3001\u305D\u308C\u306B\u9650\u308A\u307E\u305B\u3093\u3002\n        \u91CD\u8981\u3060\u3068\u601D\u308F\u308C\u308B\u5185\u5BB9\u3092\u8A73\u7D30\u306B\u8A18\u8FF0\u3057\u3066\u304F\u3060\u3055\u3044\u3002\n    \'\'\'\n\n    prompt_final = \'\'\'\n        \u524D\u8FF0\u306E\u3059\u3079\u3066\u306E\u5185\u5BB9\u3092\u6574\u7406\u3057\u3001\u91CD\u8981\u306A\u8A18\u8FF0\u3092\u898B\u3064\u3051\u3066\u304F\u3060\u3055\u3044\u3002\u3053\u308C\u306B\u306F\u3001\u30D0\u30B0\u4FEE\u6B63\u3001\u6A5F\u80FD\u8FFD\u52A0\u3001\n        \u8B70\u8AD6\u3055\u308C\u305F\u30C8\u30D4\u30C3\u30AF\u3001\u7279\u306B\u8A00\u53CA\u3055\u308C\u305F\u6210\u679C\u3084\u8AB2\u984C\u304C\u542B\u307E\u308C\u307E\u3059\u304C\u3001\u305D\u308C\u306B\u9650\u308A\u307E\u305B\u3093\u3002\n        \u91CD\u8981\u3060\u3068\u601D\u308F\u308C\u308B\u5185\u5BB9\u3092\u8A73\u7D30\u306B\u8A18\u8FF0\u3057\u3066\u304F\u3060\u3055\u3044\u3002\n        \u6700\u5F8C\u306B\u3001\u5185\u5BB9\u306B\u5C02\u9580\u7528\u8A9E\u304C\u542B\u307E\u308C\u3066\u3044\u308B\u53EF\u80FD\u6027\u304C\u3042\u308B\u3053\u3068\u3092\u8003\u616E\u3057\u3001\u305D\u308C\u306B\u95A2\u9023\u3059\u308B\u8AAC\u660E\u3084\u88DC\u8DB3\u3092\u52A0\u3048\u3066\u304F\u3060\u3055\u3044\u3002\n        \u7E41\u4F53\u5B57\u306E\u4E2D\u56FD\u8A9E\u3067\u8A18\u4E8B\u3092\u4F5C\u6210\u3057\u3001\u3067\u304D\u308B\u3060\u3051\u8A73\u7D30\u306B\u8A18\u8FF0\u3057\u3066\u304F\u3060\u3055\u3044\u3002\u8AAD\u8005\u306F\u3053\u306E\u5206\u91CE\u306E\u5C02\u9580\u5BB6\u3067\u3042\u308B\u305F\u3081\u3001\n        \u8A18\u4E8B\u3092\u66F8\u304F\u969B\u306B\u95A2\u9023\u3059\u308B\u6280\u8853\u7684\u306A\u8A73\u7D30\u306B\u3064\u3044\u3066\u3082\u8A18\u8FF0\u3057\u3001\u6BB5\u843D\u3054\u3068\u306B\u8AAC\u660E\u3092\u884C\u3044\u3001\u8A18\u8FF0\u306E\u5B8C\u5168\u6027\u3092\u4FDD\u3063\u3066\u304F\u3060\u3055\u3044\u3002\n    \'\'\'\n\n\n    # \u5206\u6BB5\uFF0C\u6BCF 20 \u500B\u5167\u5BB9\u5206\u4E00\u6BB5\n    results_seg = [results[i:i + 20] for i in range(0, len(results), 20)]\n\n    responses = []\n    enc = tiktoken.encoding_for_model("gpt-3.5-turbo")\n    for i, seg in enumerate(results_seg):\n        content = json.dumps(seg)\n\n        # \u4F30\u8A08 token\n        tokens = enc.encode(content)\n        print(f\'Segment {i}: Length of tokens: {len(tokens)}\')\n\n        if len(tokens) > 16000:\n            continue\n\n        response = client.chat.completions.create(\n            model=model,\n            messages=[\n                {"role": "system", "content": "You are a helpful assistant."},\n                {"role": "user", "content": f"{content}\\n\\n{prompt}"},\n            ],\n            temperature=0.2,\n        ).choices[0].message.content\n\n        responses.append(response)\n\n    # \u5F59\u6574\u5206\u6BB5\u7D50\u679C\n    all_content = \'\\n\\n\'.join(responses)\n    tokens = enc.encode(all_content)\n    print(\n        f\'Summary all segments, length of tokens: {len(tokens)}...\', end=\' \', flush=True)\n\n    summary = client.chat.completions.create(\n        model=model,\n        messages=[\n            {"role": "system", "content": "You are a helpful assistant."},\n            {"role": "user", "content": f"{all_content}\\n\\n{prompt_final}"},\n        ],\n        temperature=0.2,\n    ).choices[0].message.content\n    print(\'Done.\')\n\n    return summary\n'})}),"\n",(0,o.jsx)(e.p,{children:"\u3053\u306E\u30B3\u30FC\u30C9\u3067\u306F\u3001Gmail API \u304B\u3089\u53D6\u5F97\u3057\u305F\u30C7\u30FC\u30BF\u3092 ChatGPT \u306B\u6E21\u3057\u3001\u95A2\u9023\u3059\u308B\u91CD\u8981\u306A\u60C5\u5831\u3092\u8981\u7D04\u3059\u308B\u305F\u3081\u306B API \u3092\u547C\u3073\u51FA\u3057\u307E\u3059\u3002\u307E\u305F\u3001\u8907\u6570\u306E\u30BB\u30B0\u30E1\u30F3\u30C8\u306B\u5206\u3051\u3066\u5185\u5BB9\u3092\u9001\u4FE1\u3057\u3001\u6700\u7D42\u7684\u306B\u3059\u3079\u3066\u306E\u30BB\u30B0\u30E1\u30F3\u30C8\u3092\u307E\u3068\u3081\u3066\u6700\u7D42\u7684\u306A\u8981\u7D04\u3092\u53D6\u5F97\u3057\u307E\u3059\u3002"})]})}function m(n={}){let{wrapper:e}={...(0,i.a)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(c,{...n})}):c(n)}},50065:function(n,e,t){t.d(e,{Z:function(){return a},a:function(){return r}});var s=t(67294);let o={},i=s.createContext(o);function r(n){let e=s.useContext(i);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:r(n.components),s.createElement(i.Provider,{value:e},n.children)}}}]);