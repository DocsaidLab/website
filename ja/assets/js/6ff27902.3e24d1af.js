"use strict";(self.webpackChunkdocsaid_website=self.webpackChunkdocsaid_website||[]).push([["4074"],{46420:function(e,n,i){i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>d});var r=i(43755),t=i(74848),a=i(84429);let o={slug:"opencv-imread",title:"Python\u3067HEIC\u753B\u50CF\u3092\u8AAD\u307F\u8FBC\u3080\u65B9\u6CD5\u3068\u8AAD\u307F\u8FBC\u307F\u306E\u9AD8\u901F\u5316",authors:"Z. Yuan",tags:["HEIC","TurboJPEG"],image:"/ja/img/2024/0213.webp",description:"OpenCV\u306Eimread\u3092\u6700\u9069\u5316\u3057\u3066\u307F\u3088\u3046\uFF01"},s,l={authorsImageUrls:[void 0]},d=[{value:"\u57FA\u672C\u7684\u306A\u4F7F\u3044\u65B9",id:"\u57FA\u672C\u7684\u306A\u4F7F\u3044\u65B9",level:2},{value:"\u9650\u754C1: HEIC\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8",id:"\u9650\u754C1-heic\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8",level:2},{value:"\u9650\u754C2: JPG\u306E\u8AAD\u307F\u8FBC\u307F\u901F\u5EA6\u304C\u9045\u3044",id:"\u9650\u754C2-jpg\u306E\u8AAD\u307F\u8FBC\u307F\u901F\u5EA6\u304C\u9045\u3044",level:2},{value:"\u7D50\u8AD6",id:"\u7D50\u8AD6",level:2}];function c(e){let n={code:"code",h2:"h2",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["\u753B\u50CF\u3092\u8AAD\u307F\u8FBC\u3080\u3068\u304D\u3001\u901A\u5E38\u306FOpenCV\u306E",(0,t.jsx)(n.code,{children:"imread"}),"\u95A2\u6570\u3092\u4F7F\u7528\u3057\u307E\u3059\u3002"]}),"\n",(0,t.jsx)(n.p,{children:"\u3057\u304B\u3057\u3001\u3053\u306E\u95A2\u6570\u306F\u4E07\u80FD\u3067\u306F\u306A\u304F\u3001\u6642\u3005\u3044\u304F\u3064\u304B\u306E\u554F\u984C\u306B\u76F4\u9762\u3059\u308B\u3053\u3068\u304C\u3042\u308A\u307E\u3059\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"\u57FA\u672C\u7684\u306A\u4F7F\u3044\u65B9",children:"\u57FA\u672C\u7684\u306A\u4F7F\u3044\u65B9"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"imread"}),"\u95A2\u6570\u306E\u57FA\u672C\u7684\u306A\u4F7F\u3044\u65B9\u306F\u975E\u5E38\u306B\u7C21\u5358\u3067\u3001\u753B\u50CF\u306E\u30D1\u30B9\u3092\u6E21\u3059\u3060\u3051\u3067\u3059\uFF1A"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import cv2\n\nimage = cv2.imread('path/to/image.jpg')\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u4F7F\u7528\u53EF\u80FD\u306A\u753B\u50CF\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u306B\u306F\u3001BMP\u3001JPG\u3001PNG\u3001TIF\u306A\u3069\u306E\u4E00\u822C\u7684\u306A\u753B\u50CF\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u304C\u542B\u307E\u308C\u307E\u3059\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"\u9650\u754C1-heic\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8",children:"\u9650\u754C1: HEIC\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8"}),"\n",(0,t.jsxs)(n.p,{children:["iOS\u30C7\u30D0\u30A4\u30B9\u3067\u64AE\u5F71\u3057\u305F\u5199\u771F\u306F\u901A\u5E38HEIC\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u3067\u4FDD\u5B58\u3055\u308C\u307E\u3059\u304C\u3001\u3053\u306E\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u306FOpenCV\u3067\u306F\u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u305B\u3093\u3002\u3082\u3057",(0,t.jsx)(n.code,{children:"imread"}),"\u95A2\u6570\u3092\u4F7F\u3063\u3066HEIC\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u306E\u753B\u50CF\u3092\u8AAD\u307F\u8FBC\u3082\u3046\u3068\u3059\u308B\u3068\u3001",(0,t.jsx)(n.code,{children:"None"}),"\u304C\u8FD4\u3055\u308C\u307E\u3059\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["\u3053\u306E\u554F\u984C\u3092\u89E3\u6C7A\u3059\u308B\u305F\u3081\u306B\u3001",(0,t.jsx)(n.code,{children:"pyheif"}),"\u30D1\u30C3\u30B1\u30FC\u30B8\u3092\u4F7F\u7528\u3057\u3066HEIC\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u306E\u753B\u50CF\u3092\u8AAD\u307F\u8FBC\u307F\u3001\u305D\u306E\u5F8C",(0,t.jsx)(n.code,{children:"numpy.ndarray"}),"\u578B\u306E\u5909\u6570\u306B\u5909\u63DB\u3059\u308B\u65B9\u6CD5\u3092\u53D6\u308A\u307E\u3059\u3002"]}),"\n",(0,t.jsx)(n.p,{children:"\u307E\u305A\u3001\u5FC5\u8981\u306A\u30D1\u30C3\u30B1\u30FC\u30B8\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u307E\u3059\uFF1A"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo apt install libheif-dev\npip install pyheif\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u6B21\u306B\u3001\u7C21\u5358\u306A\u95A2\u6570\u3092\u4F5C\u6210\u3057\u307E\u3059\uFF1A"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import cv2\nimport pyheif\nimport numpy as np\n\ndef read_heic_to_numpy(file_path: str):\n    heif_file = pyheif.read(file_path)\n    data = heif_file.data\n    if heif_file.mode == "RGB":\n        numpy_array = np.frombuffer(data, dtype=np.uint8).reshape(\n            heif_file.size[1], heif_file.size[0], 3)\n    elif heif_file.mode == "RGBA":\n        numpy_array = np.frombuffer(data, dtype=np.uint8).reshape(\n            heif_file.size[1], heif_file.size[0], 4)\n    else:\n        raise ValueError("Unsupported HEIC color mode")\n    return numpy_array\n\n\nimg = read_heic_to_numpy(\'path/to/image.heic\')\nimg = cv2.cvtColor(img, cv2.COLOR_RGB2BGR)\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u9650\u754C2-jpg\u306E\u8AAD\u307F\u8FBC\u307F\u901F\u5EA6\u304C\u9045\u3044",children:"\u9650\u754C2: JPG\u306E\u8AAD\u307F\u8FBC\u307F\u901F\u5EA6\u304C\u9045\u3044"}),"\n",(0,t.jsxs)(n.p,{children:["\u5834\u5408\u306B\u3088\u3063\u3066\u306F\u3001",(0,t.jsx)(n.code,{children:"imread"}),"\u95A2\u6570\u3067JPG\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u306E\u753B\u50CF\u3092\u8AAD\u307F\u8FBC\u3080\u901F\u5EA6\u304C\u975E\u5E38\u306B\u9045\u304F\u306A\u308B\u3053\u3068\u304C\u3042\u308A\u307E\u3059\u3002\u3053\u308C\u306F\u3001OpenCV\u304CJPG\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u306E\u753B\u50CF\u3092\u8AAD\u307F\u8FBC\u3080\u969B\u306B",(0,t.jsx)(n.code,{children:"libjpeg"}),"\u30E9\u30A4\u30D6\u30E9\u30EA\u3092\u4F7F\u7528\u3057\u3066\u3044\u308B\u305F\u3081\u3067\u3059\u304C\u3001",(0,t.jsx)(n.code,{children:"libjpeg"}),"\u81EA\u4F53\u306E\u30D1\u30D5\u30A9\u30FC\u30DE\u30F3\u30B9\u304C\u3042\u307E\u308A\u826F\u304F\u3042\u308A\u307E\u305B\u3093\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["\u3053\u3053\u3067\u3001",(0,t.jsx)(n.code,{children:"libjpeg"}),"\u306E\u4EE3\u66FF\u54C1\u3067\u3042\u308B",(0,t.jsx)(n.code,{children:"TurboJPEG"}),"\u30D1\u30C3\u30B1\u30FC\u30B8\u3092\u5C0E\u5165\u3057\u3001\u30D1\u30D5\u30A9\u30FC\u30DE\u30F3\u30B9\u3092\u5411\u4E0A\u3055\u305B\u308B\u65B9\u6CD5\u3092\u53D6\u308A\u307E\u3059\u3002"]}),"\n",(0,t.jsx)(n.p,{children:"\u5148\u307B\u3069\u3068\u540C\u69D8\u306B\u3001\u5FC5\u8981\u306A\u30D1\u30C3\u30B1\u30FC\u30B8\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u307E\u3059\uFF1A"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo apt install libturbojpeg exiftool\npip install PyTurboJPEG\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u6B21\u306B\u3001\u5C11\u3057\u30B3\u30FC\u30C9\u3092\u66F8\u3044\u3066\u753B\u50CF\u8AAD\u307F\u8FBC\u307F\u3092\u9AD8\u901F\u5316\u3057\u307E\u3059\uFF1A"}),"\n",(0,t.jsx)(n.p,{children:"\u901A\u5E38\u3001\u7D042\u301C3\u500D\u306E\u901F\u5EA6\u5411\u4E0A\u304C\u671F\u5F85\u3067\u304D\u307E\u3059\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import cv2\nimport piexif\nfrom enum import IntEnum\nfrom pathlib import Path\nfrom turbojpeg import TurboJPEG\n\n\njpeg = TurboJPEG()\n\n\nclass ROTATE(IntEnum):\n    ROTATE_90 = cv2.ROTATE_90_CLOCKWISE\n    ROTATE_180 = cv2.ROTATE_180\n    ROTATE_270 = cv2.ROTATE_90_COUNTERCLOCKWISE\n\n\ndef imrotate90(img, rotate_code: ROTATE) -> np.ndarray:\n    return cv2.rotate(img.copy(), rotate_code)\n\n\ndef get_orientation_code(stream: Union[str, Path, bytes]):\n    code = None\n    try:\n        exif_dict = piexif.load(stream)\n        if piexif.ImageIFD.Orientation in exif_dict[\"0th\"]:\n            orientation = exif_dict[\"0th\"][piexif.ImageIFD.Orientation]\n            if orientation == 3:\n                code = ROTATE.ROTATE_180\n            elif orientation == 6:\n                code = ROTATE.ROTATE_90\n            elif orientation == 8:\n                code = ROTATE.ROTATE_270\n    finally:\n        return code\n\n\ndef jpgdecode(byte_: bytes) -> Union[np.ndarray, None]:\n    try:\n        bgr_array = jpeg.decode(byte_)\n        code = get_orientation_code(byte_)\n        bgr_array = imrotate90(\n            bgr_array, code) if code is not None else bgr_array\n    except:\n        bgr_array = None\n\n    return bgr_array\n\n\ndef jpgread(img_file: Union[str, Path]) -> Union[np.ndarray, None]:\n    with open(str(img_file), 'rb') as f:\n        binary_img = f.read()\n        bgr_array = jpgdecode(binary_img)\n\n    return bgr_array\n\nimg = jpgread('path/to/image.jpg')\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u3053\u308C\u3067JPG\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u306E\u753B\u50CF\u8AAD\u307F\u8FBC\u307F\u304C\u9AD8\u901F\u5316\u3055\u308C\u307E\u3059\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"\u7D50\u8AD6",children:"\u7D50\u8AD6"}),"\n",(0,t.jsx)(n.p,{children:"\u3053\u306E\u30D7\u30ED\u30B0\u30E9\u30E0\u3092\u8CE2\u304F\u3057\u3066\u3001\u753B\u50CF\u306E\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u306B\u5FDC\u3058\u3066\u6700\u9069\u306A\u8AAD\u307F\u8FBC\u307F\u65B9\u6CD5\u3092\u9078\u629E\u3067\u304D\u308B\u3088\u3046\u306B\u3057\u305F\u3044\u5834\u5408\u306F\u3001\u5148\u307B\u3069\u306E\u30B3\u30FC\u30C9\u3092\u6574\u7406\u3057\u3066\u9069\u5207\u306A\u65B9\u6CD5\u3092\u9078\u3079\u308B\u3088\u3046\u306B\u3057\u307E\u3059\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",metastring:'title="custom_imread.py"',children:"def imread(\n    path: Union[str, Path],\n    color_base: str = 'BGR',\n    verbose: bool = False\n) -> Union[np.ndarray, None]:\n\n    if not Path(path).exists():\n        raise FileExistsError(f'{path} \u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002')\n\n    if Path(path).suffix.lower() == '.heic':\n        img = read_heic_to_numpy(str(path))\n        img = cv2.cvtColor(img, cv2.COLOR_RGB2BGR)\n    else:\n        img = jpgread(path)\n        img = cv2.imread(str(path)) if img is None else img\n\n    if img is None:\n        if verbose:\n            warnings.warn(\"\u753B\u50CF\u304C None \u578B\u3067\u3059\u3002\")\n        return\n\n    if color_base != 'BGR':\n        img = imcvtcolor(img, cvt_mode=f'BGR2{color_base}')\n\n    return img\n"})})]})}function p(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},84429:function(e,n,i){i.d(n,{R:()=>o,x:()=>s});var r=i(96540);let t={},a=r.createContext(t);function o(e){let n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(a.Provider,{value:n},e.children)}},43755:function(e){e.exports=JSON.parse('{"permalink":"/ja/blog/opencv-imread","source":"@site/i18n/ja/docusaurus-plugin-content-blog/2024/02-13-imread/index.md","title":"Python\u3067HEIC\u753B\u50CF\u3092\u8AAD\u307F\u8FBC\u3080\u65B9\u6CD5\u3068\u8AAD\u307F\u8FBC\u307F\u306E\u9AD8\u901F\u5316","description":"OpenCV\u306Eimread\u3092\u6700\u9069\u5316\u3057\u3066\u307F\u3088\u3046\uFF01","date":"2024-02-13T00:00:00.000Z","tags":[{"inline":true,"label":"HEIC","permalink":"/ja/blog/tags/heic"},{"inline":true,"label":"TurboJPEG","permalink":"/ja/blog/tags/turbo-jpeg"}],"readingTime":3.36,"hasTruncateMarker":true,"authors":[{"name":"Z. Yuan","title":"Dosaid maintainer, Full-Stack AI Engineer","url":"https://github.com/zephyr-sh","socials":{"github":"https://github.com/zephyr-sh","linkedin":"https://www.linkedin.com/in/ze-yuan-sh7/"},"imageURL":"https://github.com/zephyr-sh.png","key":"Z. Yuan","page":null}],"frontMatter":{"slug":"opencv-imread","title":"Python\u3067HEIC\u753B\u50CF\u3092\u8AAD\u307F\u8FBC\u3080\u65B9\u6CD5\u3068\u8AAD\u307F\u8FBC\u307F\u306E\u9AD8\u901F\u5316","authors":"Z. Yuan","tags":["HEIC","TurboJPEG"],"image":"/ja/img/2024/0213.webp","description":"OpenCV\u306Eimread\u3092\u6700\u9069\u5316\u3057\u3066\u307F\u3088\u3046\uFF01"},"unlisted":false,"prevItem":{"title":"Python\u3092\u4F7F\u7528\u3057\u3066PDF\u3092\u753B\u50CF\u306B\u5909\u63DB\u3059\u308B","permalink":"/ja/blog/convert-pdf-to-images"},"nextItem":{"title":"\u65E5\u5E38\u7684\u306A\u30A8\u30E9\u30FC\u6392\u9664\u8A18\u9332","permalink":"/ja/blog/error-record"}}')}}]);