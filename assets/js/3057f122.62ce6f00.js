"use strict";(self.webpackChunkdocsaid_website=self.webpackChunkdocsaid_website||[]).push([["74400"],{82278:function(n,e,i){i.r(e),i.d(e,{frontMatter:()=>c,default:()=>t,contentTitle:()=>a,assets:()=>d,toc:()=>x,metadata:()=>l});var l=JSON.parse('{"id":"nginx-notes/monitoring","title":"Nginx \u65E5\u8A8C\u8207\u76E3\u63A7","description":"\u5C07 API \u5C0D\u5916\u958B\u653E\u4E4B\u5F8C\uFF0C\u6211\u5011\u7ACB\u523B\u5C31\u6703\u6536\u5230\u4F86\u81EA\u56DB\u9762\u516B\u65B9\u7684\u60E1\u610F\u8ACB\u6C42\u3002","source":"@site/docs/nginx-notes/monitoring.md","sourceDirName":"nginx-notes","slug":"/nginx-notes/monitoring","permalink":"/docs/nginx-notes/monitoring","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"zephyr-sh","lastUpdatedAt":1739604622000,"sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Nginx \u5B89\u5168\u5F37\u5316","permalink":"/docs/nginx-notes/security"},"next":{"title":"Nginx \u63D0\u4F9B\u975C\u614B\u8CC7\u6E90","permalink":"/docs/nginx-notes/static-file-server"}}'),s=i(85893),r=i(50065);let c={sidebar_position:5},a="Nginx \u65E5\u8A8C\u8207\u76E3\u63A7",d={},x=[{value:"\u4EC0\u9EBC\u662F Fail2ban\uFF1F",id:"\u4EC0\u9EBC\u662F-fail2ban",level:2},{value:"Fail2ban \u57FA\u672C\u8A2D\u5B9A",id:"fail2ban-\u57FA\u672C\u8A2D\u5B9A",level:2},{value:"\u76E3\u63A7\u5E38\u898B\u653B\u64CA\u985E\u578B",id:"\u76E3\u63A7\u5E38\u898B\u653B\u64CA\u985E\u578B",level:2},{value:"\u9632\u6B62\u60E1\u610F\u722C\u87F2",id:"\u9632\u6B62\u60E1\u610F\u722C\u87F2",level:3},{value:"\u9632\u6B62 404 \u6383\u63CF\u653B\u64CA",id:"\u9632\u6B62-404-\u6383\u63CF\u653B\u64CA",level:3},{value:"\u9632\u6B62 DDoS \u653B\u64CA",id:"\u9632\u6B62-ddos-\u653B\u64CA",level:3},{value:"\u9632\u6B62\u66B4\u529B\u767B\u5165",id:"\u9632\u6B62\u66B4\u529B\u767B\u5165",level:3},{value:"\u5617\u8A66\u5B58\u53D6\u654F\u611F\u8CC7\u6599",id:"\u5617\u8A66\u5B58\u53D6\u654F\u611F\u8CC7\u6599",level:3},{value:"\u91DD\u5C0D API \u7684\u653B\u64CA",id:"\u91DD\u5C0D-api-\u7684\u653B\u64CA",level:3},{value:"\u5957\u7528\u65B0\u898F\u5247",id:"\u5957\u7528\u65B0\u898F\u5247",level:3},{value:"\u6E2C\u8A66\u9632\u79A6\u6548\u679C",id:"\u6E2C\u8A66\u9632\u79A6\u6548\u679C",level:2},{value:"\u4F7F\u7528 <code>curl</code> \u6A21\u64EC\u653B\u64CA",id:"\u4F7F\u7528-curl-\u6A21\u64EC\u653B\u64CA",level:3},{value:"\u9A57\u8B49\u72C0\u614B\u8207\u65E5\u8A8C",id:"\u9A57\u8B49\u72C0\u614B\u8207\u65E5\u8A8C",level:3},{value:"\u89E3\u9664\u5C01\u9396 IP",id:"\u89E3\u9664\u5C01\u9396-ip",level:3},{value:"\u7D50\u8AD6",id:"\u7D50\u8AD6",level:2}];function h(n){let e={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"nginx-\u65E5\u8A8C\u8207\u76E3\u63A7",children:"Nginx \u65E5\u8A8C\u8207\u76E3\u63A7"})}),"\n",(0,s.jsx)(e.p,{children:"\u5C07 API \u5C0D\u5916\u958B\u653E\u4E4B\u5F8C\uFF0C\u6211\u5011\u7ACB\u523B\u5C31\u6703\u6536\u5230\u4F86\u81EA\u56DB\u9762\u516B\u65B9\u7684\u60E1\u610F\u8ACB\u6C42\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679C\u4F60\u6709\u770B\u53BB\u904E\u65E5\u8A8C\u8A18\u9304\uFF0C\u61C9\u8A72\u4E0D\u96E3\u767C\u73FE\u6709\u5404\u7A2E IP \u4E00\u76F4\u5617\u8A66\u4F7F\u7528\u4E0D\u540C\u7684\u7528\u6236\u540D\u548C\u5BC6\u78BC\u767B\u5165\u4F60\u7684\u4F3A\u670D\u5668\u3002\u9019\u662F\u4E00\u7A2E\u5E38\u898B\u7684\u66B4\u529B\u7834\u89E3\u653B\u64CA\uFF0C\u653B\u64CA\u8005\u6703\u4F7F\u7528\u81EA\u52D5\u5316\u5DE5\u5177\u4E0D\u65B7\u5617\u8A66\u767B\u5165\uFF0C\u76F4\u5230\u627E\u5230\u6B63\u78BA\u7684\u5BC6\u78BC\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u96D6\u7136\u6211\u5011\u53EF\u4EE5\u8B93\u5BC6\u78BC\u7684\u8907\u96DC\u5EA6\u7A81\u7834\u5929\u969B\uFF0C\u4F46\u662F\u7E3D\u662F\u9019\u6A23\u8B93\u4EBA\u60E6\u8A18\u8457\u4E5F\u4E0D\u662F\u8FA6\u6CD5\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u6240\u4EE5\u6211\u5011\u7528 Fail2ban \u9019\u500B\u5DE5\u5177\uFF0C\u628A\u90A3\u4E9B IP \u901A\u901A\u5C01\u9396\u6389\u3002"}),"\n",(0,s.jsx)(e.h2,{id:"\u4EC0\u9EBC\u662F-fail2ban",children:"\u4EC0\u9EBC\u662F Fail2ban\uFF1F"}),"\n",(0,s.jsx)(e.p,{children:"Fail2ban \u662F\u4E00\u6B3E\u958B\u6E90\u7684\u5165\u4FB5\u9632\u79A6\u5DE5\u5177\uFF0C\u4E3B\u8981\u7528\u65BC\u76E3\u63A7\u4F3A\u670D\u5668\u65E5\u8A8C\u4E26\u6839\u64DA\u898F\u5247\u5C01\u9396\u60E1\u610F IP\u3002\u5B83\u80FD\u6709\u6548\u9632\u79A6\u66B4\u529B\u7834\u89E3\u653B\u64CA\uFF0C\u4F8B\u5982\u91DD\u5C0D SSH\u3001HTTP \u548C\u5176\u4ED6\u7DB2\u8DEF\u670D\u52D9\u7684\u60E1\u610F\u884C\u70BA\u3002"}),"\n",(0,s.jsx)(e.p,{children:"Fail2ban \u7684\u904B\u4F5C\u57FA\u790E\u662F\u300C\u904E\u6FFE\u5668\u300D\uFF08filters\uFF09\u548C\u300C\u76E3\u7344\u300D\uFF08jails\uFF09\u5169\u5927\u6982\u5FF5\uFF1A"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u904E\u6FFE\u5668"}),"\uFF1A\u7528\u65BC\u5B9A\u7FA9\u61C9\u5728\u65E5\u8A8C\u4E2D\u5C0B\u627E\u7684\u53EF\u7591\u884C\u70BA\u6A21\u5F0F"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u76E3\u7344"}),"\uFF1A \u5247\u8CA0\u8CAC\u5C07\u904E\u6FFE\u5668\u8207\u5C01\u9396\u6A5F\u5236\u7D50\u5408\uFF0C\u7576\u5075\u6E2C\u5230\u7570\u5E38\u884C\u70BA\u6642\u81EA\u52D5\u57F7\u884C\u5C0D\u61C9\u52D5\u4F5C\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u5728 Nginx \u7684\u61C9\u7528\u5834\u666F\u4E2D\uFF0CFail2ban \u53EF\u900F\u904E\u76E3\u8996 Nginx \u7684\u8A2A\u554F\u65E5\u8A8C\uFF08access log\uFF09\u8207\u932F\u8AA4\u65E5\u8A8C\uFF08error log\uFF09\uFF0C\u8FA8\u8B58\u53EF\u7591\u8ACB\u6C42\uFF0C\u4F8B\u5982\uFF1A"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u983B\u7E41\u7684 404 \u932F\u8AA4"}),"\uFF08\u6F5B\u5728\u7684\u6383\u63CF\u653B\u64CA\uFF09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u9023\u7E8C\u7684\u767B\u5165\u5931\u6557"}),"\uFF08\u66B4\u529B\u7834\u89E3\u653B\u64CA\uFF09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u77ED\u6642\u9593\u5167\u7684\u9AD8\u983B\u8ACB\u6C42"}),"\uFF08DDoS \u6216\u60E1\u610F\u722C\u87F2\uFF09"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u4E00\u65E6\u5075\u6E2C\u5230\u7570\u5E38\uFF0CFail2ban \u6703\u6839\u64DA\u8A2D\u5B9A\uFF0C\u900F\u904E iptables \u6216 nftables \u81EA\u52D5\u5C01\u9396\u4F86\u6E90 IP\uFF0C\u4F7F\u5176\u7121\u6CD5\u7E7C\u7E8C\u653B\u64CA Nginx \u4F3A\u670D\u5668\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u5728 Ubuntu \u74B0\u5883\u4E2D\uFF0CNginx \u7684\u65E5\u8A8C\u9810\u8A2D\u5B58\u653E\u65BC\uFF1A"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u8A2A\u554F\u65E5\u8A8C"}),"\uFF1A",(0,s.jsx)(e.code,{children:"/var/log/nginx/access.log"})]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u932F\u8AA4\u65E5\u8A8C"}),"\uFF1A",(0,s.jsx)(e.code,{children:"/var/log/nginx/error.log"})]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"Fail2ban \u53EF\u900F\u904E\u8A2D\u5B9A\u76E3\u63A7\u9019\u4E9B\u65E5\u8A8C\uFF0C\u4E26\u6839\u64DA\u9810\u8A2D\u6216\u81EA\u8A02\u7684\u904E\u6FFE\u898F\u5247\u7BC4\u672C\u4F86\u6BD4\u5C0D\u65E5\u8A8C\u5167\u5BB9\u3002\u7576\u65E5\u8A8C\u8A18\u9304\u8207\u60E1\u610F\u884C\u70BA\u6A21\u5F0F\u5339\u914D\u6642\uFF0CFail2ban \u6703\u5C07\u76F8\u95DC IP \u52A0\u5165\u5C01\u9396\u6E05\u55AE\u3002"}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsxs)(e.p,{children:["\u898F\u5247\u7BC4\u672C\u901A\u5E38\u4F4D\u65BC ",(0,s.jsx)(e.code,{children:"/etc/fail2ban/filter.d/"})]})}),"\n",(0,s.jsx)(e.admonition,{type:"tip",children:(0,s.jsx)(e.p,{children:"\u9664\u4E86\u4FDD\u8B77 Nginx \u4E4B\u5916\uFF0CFail2ban \u4E5F\u80FD\u61C9\u7528\u65BC SSH\u3001FTP\u3001\u90F5\u4EF6\u4F3A\u670D\u5668\u7B49\u591A\u7A2E\u670D\u52D9\uFF0C\u63D0\u4F9B\u5EE3\u6CDB\u7684\u4F3A\u670D\u5668\u5B89\u5168\u9632\u8B77\u529F\u80FD\u3002\u672C\u6307\u5357\u4E3B\u8981\u805A\u7126\u65BC Nginx \u76F8\u95DC\u7684\u9632\u79A6\u914D\u7F6E\u3002"})}),"\n",(0,s.jsx)(e.h2,{id:"fail2ban-\u57FA\u672C\u8A2D\u5B9A",children:"Fail2ban \u57FA\u672C\u8A2D\u5B9A"}),"\n",(0,s.jsx)(e.p,{children:"\u5728 Ubuntu \u4E0A\uFF0CFail2ban \u53EF\u4EE5\u76F4\u63A5\u900F\u904E APT \u5957\u4EF6\u7BA1\u7406\u5668\u5B89\u88DD\uFF0C\u56E0\u70BA\u5B83\u5DF2\u5305\u542B\u5728\u5B98\u65B9\u7684\u8EDF\u9AD4\u5EAB\u4E2D\u3002\u8ACB\u4F9D\u7167\u4EE5\u4E0B\u6B65\u9A5F\u9032\u884C\u5B89\u88DD\u8207\u555F\u52D5\uFF1A"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u66F4\u65B0\u7CFB\u7D71\u5957\u4EF6\u5EAB"}),"\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo apt update\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5B89\u88DD Fail2ban"}),"\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo apt install -y fail2ban\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u5C07\u81EA\u52D5\u4E0B\u8F09\u4E26\u5B89\u88DD Fail2ban \u53CA\u5176\u76F8\u4F9D\u5957\u4EF6\u3002\u5B89\u88DD\u5B8C\u6210\u5F8C\uFF0CFail2ban \u6703\u81EA\u52D5\u555F\u52D5\u4E26\u8A2D\u5B9A\u70BA\u958B\u6A5F\u81EA\u52D5\u57F7\u884C\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u78BA\u8A8D Fail2ban \u670D\u52D9\u72C0\u614B"}),"\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo systemctl status fail2ban\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u82E5\u5B89\u88DD\u6210\u529F\uFF0C\u61C9\u6703\u986F\u793A ",(0,s.jsx)(e.code,{children:"active (running)"}),"\uFF0C\u4EE3\u8868 Fail2ban \u5DF2\u6B63\u5E38\u904B\u884C\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u6AA2\u67E5 Fail2ban \u7248\u672C\u8207\u72C0\u614B"}),"\uFF1A"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u986F\u793A\u76EE\u524D\u5B89\u88DD\u7684 Fail2ban \u7248\u672C\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"fail2ban-client --version\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u6AA2\u67E5\u76EE\u524D\u5DF2\u555F\u7528\u7684\u76E3\u7344\u5011\n\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo fail2ban-client status\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u9810\u8A2D\u60C5\u6CC1\u4E0B\uFF0CFail2ban \u53EF\u80FD\u50C5\u555F\u7528 SSH \u7684\u4FDD\u8B77\u6A5F\u5236\uFF0CNginx \u76F8\u95DC\u7684\u9632\u79A6\u5247\u9700\u8981\u984D\u5916\u8A2D\u5B9A\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsxs)(e.p,{children:["Fail2ban \u7684\u4E3B\u8981\u8A2D\u5B9A\u6A94\u6848\u70BA ",(0,s.jsx)(e.code,{children:"/etc/fail2ban/jail.conf"}),"\uFF0C\u4F46\u5B98\u65B9\u5EFA\u8B70\uFF1A\u300C\u4E0D\u8981\u76F4\u63A5\u4FEE\u6539\u9019\u500B\u6A94\u6848\u300D\uFF0C\u4EE5\u907F\u514D\u65E5\u5F8C\u8EDF\u9AD4\u66F4\u65B0\u6642\u8986\u5BEB\u4F60\u7684\u8A2D\u5B9A\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u56E0\u6B64\uFF0C\u6211\u5011\u5EFA\u7ACB\u672C\u5730\u8A2D\u5B9A\u6A94 ",(0,s.jsx)(e.code,{children:"jail.local"})," \u4F86\u8986\u84CB\u9810\u8A2D\u503C\u3002"]}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsxs)(e.strong,{children:["\u8907\u88FD ",(0,s.jsx)(e.code,{children:"jail.conf"})," \u70BA ",(0,s.jsx)(e.code,{children:"jail.local"})]}),"\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsxs)(e.strong,{children:["\u7DE8\u8F2F ",(0,s.jsx)(e.code,{children:"jail.local"})]}),"\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo vim /etc/fail2ban/jail.local\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u627E\u5230 ",(0,s.jsx)(e.code,{children:"[DEFAULT]"})," \u5340\u6BB5\uFF0C\u8A2D\u5B9A\u4E00\u4E9B\u95DC\u9375\u53C3\u6578\uFF0C\u4F8B\u5982\uFF1A\u5FFD\u7565\u7684 IP\u3001\u5C01\u9396\u6642\u9593\u3001\u89C0\u5BDF\u6642\u9593\u53CA\u6700\u5927\u91CD\u8A66\u6B21\u6578\u7B49\u76F8\u95DC\u8A2D\u5B9A\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:"[DEFAULT]\nignoreip = 127.0.0.1/8 ::1    # \u8A2D\u5B9A\u4FE1\u4EFB\u7684 IP \u5730\u5740\uFF0C\u9019\u4E9B IP \u4E0D\u6703\u88AB\u5C01\u9396\nbantime  = 1h                 # \u9810\u8A2D\u5C01\u9396\u6642\u9593\uFF0C\u53EF\u8A2D\u70BA\u79D2\u6578\u6216\u6642\u9593\u55AE\u4F4D (\u5982 1h, 10m)\nfindtime = 10m                # \u5728\u6B64\u6642\u9593\u5167\u2026\nmaxretry = 5                  # \u8D85\u904E maxretry \u6B21\u5931\u6557\u5247\u5C01\u9396\u8A72 IP\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u4E9B\u8A2D\u5B9A\u7684\u542B\u7FA9\u5982\u4E0B\uFF1A"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"ignoreip"}),"\uFF1A\u6307\u5B9A\u54EA\u4E9B IP \u4E0D\u6703\u88AB\u5C01\u9396\uFF0C\u4F8B\u5982\u672C\u6A5F (",(0,s.jsx)(e.code,{children:"127.0.0.1"}),") \u6216\u5176\u4ED6\u7BA1\u7406\u7528 IP\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"bantime"}),"\uFF1A\u5C01\u9396\u6642\u9577\uFF0C\u9810\u8A2D\u70BA 1 \u5C0F\u6642\uFF08",(0,s.jsx)(e.code,{children:"1h"}),"\uFF09\u3002\u6B64\u6642\u9593\u5167\u8A72 IP \u6703\u88AB\u7981\u6B62\u5B58\u53D6\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"findtime"}),"\uFF1A\u89C0\u5BDF\u6642\u9593\u7BC4\u570D\uFF0C\u4F8B\u5982\u8A2D\u5B9A ",(0,s.jsx)(e.code,{children:"10m"})," \u4EE3\u8868 10 \u5206\u9418\u5167\u7D2F\u7A4D\u7684\u5931\u6557\u884C\u70BA\u5C07\u88AB\u8A08\u7B97\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"maxretry"}),"\uFF1A\u6700\u5927\u91CD\u8A66\u6B21\u6578\uFF0C\u4F8B\u5982\u8A2D\u5B9A ",(0,s.jsx)(e.code,{children:"5"})," \u4EE3\u8868\u540C\u4E00\u500B IP \u5728 ",(0,s.jsx)(e.code,{children:"findtime"})," \u5167\u89F8\u767C 5 \u6B21\u898F\u5247\u5F8C\u6703\u88AB\u5C01\u9396\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u4E9B\u53C3\u6578\u70BA\u5168\u57DF\u8A2D\u5B9A\uFF0C\u9069\u7528\u65BC\u6240\u6709\u76E3\u7344\u3002\u6211\u5011\u7A0D\u5F8C\u5FC5\u9808\u91DD\u5C0D Nginx \u8A2D\u5B9A\u55AE\u7368\u7684\u5C01\u9396\u7B56\u7565\uFF0C\u78BA\u4FDD\u60E1\u610F\u653B\u64CA\u80FD\u88AB\u66F4\u6709\u6548\u5730\u6514\u622A\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u5B8C\u6210\u8A2D\u5B9A\u5F8C\uFF0C\u91CD\u65B0\u555F\u52D5 Fail2ban \u4EE5\u5957\u7528\u65B0\u8A2D\u5B9A\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo systemctl restart fail2ban\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u81F3\u6B64\uFF0CFail2ban \u7684\u57FA\u672C\u5B89\u88DD\u8207\u5168\u57DF\u8A2D\u5B9A\u5DF2\u5B8C\u6210\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u63A5\u4E0B\u4F86\uFF0C\u6211\u5011\u5C07\u9032\u4E00\u6B65\u914D\u7F6E Fail2ban \u4F86\u76E3\u63A7 Nginx \u65E5\u8A8C\uFF0C\u4EE5\u9632\u6B62\u60E1\u610F\u8ACB\u6C42\u3002"}),"\n",(0,s.jsx)(e.h2,{id:"\u76E3\u63A7\u5E38\u898B\u653B\u64CA\u985E\u578B",children:"\u76E3\u63A7\u5E38\u898B\u653B\u64CA\u985E\u578B"}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u88E1\u6211\u5011\u5C07\u91DD\u5C0D\u5E7E\u7A2E\u5E38\u898B\u7684 Nginx \u653B\u64CA\u985E\u578B\uFF0C\u8A2D\u5B9A Fail2ban \u9032\u884C\u76E3\u63A7\u8207\u81EA\u52D5\u5C01\u9396\u3002\u6BCF\u7A2E\u653B\u64CA\u884C\u70BA\u5728 Nginx \u65E5\u8A8C\u4E2D\u901A\u5E38\u6703\u6709\u660E\u78BA\u7684\u7279\u5FB5\uFF0C\u56E0\u6B64\u6211\u5011\u5148\u5236\u5B9A\u300C\u904E\u6FFE\u898F\u5247\u300D\u4F86\u5075\u6E2C\uFF0C\u4E26\u5957\u7528\u5C0D\u61C9\u7684\u5C01\u9396\u7B56\u7565\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u9632\u6B62\u60E1\u610F\u722C\u87F2",children:"\u9632\u6B62\u60E1\u610F\u722C\u87F2"}),"\n",(0,s.jsx)(e.p,{children:"\u8A31\u591A\u60E1\u610F\u722C\u87F2\u6216\u653B\u64CA\u5DE5\u5177\u6703\u4F7F\u7528\u7279\u5B9A\u7684 User-Agent\uFF0C\u4F8B\u5982\uFF1A"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"Java"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"Python-urllib"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"Curl"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"sqlmap"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"Wget"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"360Spider"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.code,{children:"MJ12bot"})}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u4E9B User-Agent \u591A\u6578\u4F86\u81EA\u81EA\u52D5\u5316\u6383\u63CF\u5DE5\u5177\uFF0C\u4E26\u4E0D\u5C6C\u65BC\u6B63\u5E38\u7528\u6236\u3002\u56E0\u6B64\uFF0C\u6211\u5011\u53EF\u4EE5\u91DD\u5C0D\u9019\u985E User-Agent \u9032\u884C\u5373\u6642\u5C01\u9396\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u9996\u5148\uFF0C\u5728 ",(0,s.jsx)(e.code,{children:"/etc/fail2ban/filter.d/"})," \u76EE\u9304\u4E0B\u5EFA\u7ACB\u4E00\u500B\u65B0\u7684\u904E\u6FFE\u5668\u6A94\u6848\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo vim /etc/fail2ban/filter.d/nginx-badbots.conf\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u586B\u5165\u4EE5\u4E0B\u5167\u5BB9\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:'[Definition]\nfailregex = <HOST> -.* "(GET|POST).*HTTP.*" .* "(?:Java|Python-urllib|Curl|sqlmap|Wget|360Spider|MJ12bot)"\nignoreregex =\n\n# failregex \u7528\u65BC\u5339\u914D\u60E1\u610F\u8ACB\u6C42\u7684\u6B63\u5247\u8868\u9054\u5F0F\n# - <HOST> \u4EE3\u8868 IP \u5730\u5740\uFF0C\u5360\u4F4D\u7B26\u6703\u88AB Fail2Ban \u89E3\u6790\n# - "(GET|POST).*HTTP.*" \u9650\u5B9A\u70BA HTTP GET \u6216 POST \u8ACB\u6C42\n# - .* \u7528\u65BC\u5339\u914D\u8ACB\u6C42\u5167\u5BB9\n# - "(?:Java|Python-urllib|Curl|sqlmap|Wget|360Spider|MJ12bot)"\n#   - \u9019\u4E9B\u662F\u5E38\u898B\u7684\u722C\u87F2\u3001\u6383\u63CF\u5668\u6216\u653B\u64CA\u5DE5\u5177\uFF1A\n#     - Java: \u4E00\u822C\u4F86\u81EA Java-based \u722C\u87F2\n#     - Python-urllib: Python \u5167\u5EFA\u7684 URL \u8ACB\u6C42\u5EAB\n#     - Curl: \u547D\u4EE4\u884C HTTP \u8ACB\u6C42\u5DE5\u5177\n#     - sqlmap: \u81EA\u52D5\u5316 SQL \u6CE8\u5165\u5DE5\u5177\n#     - Wget: \u4E0B\u8F09\u5DE5\u5177\uFF0C\u4E5F\u53EF\u7528\u65BC\u722C\u53D6\u7DB2\u7AD9\n#     - 360Spider: 360 \u641C\u7D22\u5F15\u64CE\u7684\u722C\u87F2\n#     - MJ12bot: Majestic SEO \u722C\u87F2\n\n# ignoreregex \u662F\u7528\u4F86\u6392\u9664\u67D0\u4E9B\u8ACB\u6C42\u7684\u6B63\u5247\u8868\u9054\u5F0F\n# - \u9019\u88E1\u7559\u7A7A\uFF0C\u8868\u793A\u4E0D\u6392\u9664\u4EFB\u4F55\u8ACB\u6C42\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u63A5\u8457\u8A2D\u5B9A Jail\uFF0C\u5728 ",(0,s.jsx)(e.code,{children:"jail.local"})," \u6A94\u6848\u4E2D\u52A0\u5165\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:"[nginx-badbots]\nenabled  = true\nport     = http,https\nfilter   = nginx-badbots\nlogpath  = /var/log/nginx/access.log\nmaxretry = 1\nbantime  = 86400\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u6A23\u4E00\u4F86\uFF0C\u4EFB\u4F55\u4F7F\u7528\u9019\u4E9B User-Agent \u7684\u8ACB\u6C42\u90FD\u6703\u88AB\u7ACB\u5373\u5C01\u9396 24 \u5C0F\u6642\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u9632\u6B62-404-\u6383\u63CF\u653B\u64CA",children:"\u9632\u6B62 404 \u6383\u63CF\u653B\u64CA"}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u7A2E\u653B\u64CA\u65B9\u5F0F\u6703\u66B4\u529B\u63A2\u6E2C\u4E0D\u5B58\u5728\u9801\u9762\uFF0C\u901A\u5E38\u6703\u5728\u77ED\u6642\u9593\u5167\u5C0D\u7DB2\u7AD9\u9032\u884C\u5927\u91CF\u8ACB\u6C42\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u653B\u64CA\u8005\u53EF\u80FD\u6703\u900F\u904E\u8173\u672C\u4E0D\u65B7\u5B58\u53D6\u7DB2\u7AD9\u4E0D\u5B58\u5728\u7684\u9801\u9762\uFF0C\u4EE5\u5617\u8A66\u767C\u73FE\u6F0F\u6D1E\u6216\u654F\u611F\u6A94\u6848\uFF0C\u4E26\u7522\u751F\u5927\u91CF HTTP 404 \u932F\u8AA4\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u5EFA\u7ACB\u4E00\u500B\u65B0\u7684\u904E\u6FFE\u5668\u6A94\u6848\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo vim /etc/fail2ban/filter.d/nginx-404.conf\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u586B\u5165\u4EE5\u4E0B\u5167\u5BB9\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:'[Definition]\nfailregex = <HOST> -.* "(GET|POST).*HTTP.*" 404\nignoreregex =\n\n# failregex \u7528\u65BC\u5339\u914D\u7279\u5B9A\u7684\u65E5\u8A8C\u6A21\u5F0F\n# - <HOST> \u4EE3\u8868 IP \u5730\u5740\uFF08Fail2Ban \u6703\u81EA\u52D5\u66FF\u63DB\u70BA\u5BE6\u969B\u7684\u4F86\u6E90 IP\uFF09\n# - "(GET|POST).*HTTP.*"\uFF1A\n#   - \u9650\u5B9A\u8ACB\u6C42\u65B9\u6CD5\u70BA GET \u6216 POST\n#   - .* \u7528\u65BC\u5339\u914D URL \u53CA HTTP \u5354\u8B70\u7248\u672C\uFF08\u5982 HTTP/1.1\uFF09\n# - "404" \u6307\u5B9A\u5339\u914D HTTP 404 \u72C0\u614B\u78BC\uFF08\u8868\u793A\u8ACB\u6C42\u7684\u8CC7\u6E90\u672A\u627E\u5230\uFF09\n\n# \u9019\u689D\u898F\u5247\u7528\u4F86\u5C01\u9396\u983B\u7E41\u89F8\u767C 404 \u932F\u8AA4\u7684 IP\uFF0C\u4F8B\u5982\u6383\u63CF\u4E0D\u5B58\u5728\u9801\u9762\u7684\u60E1\u610F\u722C\u87F2\u6216\u653B\u64CA\u8005\n# \u9069\u7528\u65BC Web \u4F3A\u670D\u5668\uFF08\u5982 Nginx\u3001Apache\uFF09\u7684\u65E5\u8A8C\u5206\u6790\n\n# ignoreregex \u662F\u7528\u4F86\u6392\u9664\u67D0\u4E9B\u8ACB\u6C42\u7684\u5339\u914D\u898F\u5247\n# - \u9019\u88E1\u7559\u7A7A\uFF0C\u8868\u793A\u4E0D\u6392\u9664\u4EFB\u4F55\u8ACB\u6C42\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u63A5\u8457\u8A2D\u5B9A Jail\uFF0C\u5728 ",(0,s.jsx)(e.code,{children:"jail.local"})," \u6A94\u6848\u4E2D\u52A0\u5165\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:"[nginx-404]\nenabled  = true\nport     = http,https\nfilter   = nginx-404\nlogpath  = /var/log/nginx/access.log\nfindtime = 10m\nmaxretry = 5\nbantime  = 86400\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u5C07\u5728 10 \u5206\u9418\u5167\u89F8\u767C 5 \u6B21 404 \u932F\u8AA4 \u7684 IP \u5C01\u9396 24 \u5C0F\u6642\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u9632\u6B62-ddos-\u653B\u64CA",children:"\u9632\u6B62 DDoS \u653B\u64CA"}),"\n",(0,s.jsx)(e.p,{children:"\u7576\u67D0\u500B IP \u5728\u77ED\u6642\u9593\u5167\u767C\u9001\u5927\u91CF\u8ACB\u6C42\uFF0C\u53EF\u80FD\u662F DDoS \u653B\u64CA\u6216\u60E1\u610F\u722C\u53D6\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u5EFA\u7ACB\u4E00\u500B\u65B0\u7684\u904E\u6FFE\u5668\u6A94\u6848\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo vim /etc/fail2ban/filter.d/nginx-limitreq.conf\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u586B\u5165\u4EE5\u4E0B\u5167\u5BB9\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:'[Definition]\nfailregex = limiting requests, excess: .* by zone .* client: <HOST>\nignoreregex =\n\n# failregex \u7528\u65BC\u5339\u914D Nginx \u65E5\u8A8C\u4E2D\u7684\u8ACB\u6C42\u9650\u6D41\uFF08Rate Limiting\uFF09\u4E8B\u4EF6\n# - "limiting requests, excess: .* by zone .* client: <HOST>"\n#   - "limiting requests, excess:" \u8868\u793A\u8ACB\u6C42\u8D85\u904E\u4E86\u8A2D\u7F6E\u7684\u9650\u5236\uFF08\u5982 Nginx \u7684 limit_req_zone \u9650\u5236\uFF09\n#   - .* \u5141\u8A31\u5339\u914D\u4EFB\u610F\u6578\u64DA\uFF08\u5982\u8ACB\u6C42\u6578\u91CF\u6216\u8D85\u51FA\u7684\u8A73\u7D30\u8CC7\u8A0A\uFF09\n#   - "by zone .*" \u4EE3\u8868 Nginx \u914D\u7F6E\u7684\u9650\u6D41\u5340\u57DF\uFF08zone\uFF09\n#   - "client: <HOST>" \u9019\u90E8\u5206 Fail2Ban \u6703\u66FF\u63DB\u70BA\u5BE6\u969B\u7684\u5BA2\u6236\u7AEF IP \u5730\u5740\n#\n# ignoreregex \u7528\u65BC\u6392\u9664\u7279\u5B9A\u7684\u5339\u914D\u6A21\u5F0F\n# - \u9019\u88E1\u7559\u7A7A\uFF0C\u8868\u793A\u4E0D\u6392\u9664\u4EFB\u4F55\u8ACB\u6C42\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u689D failregex \u4E3B\u8981\u662F\u7528\u4F86\u5339\u914D Nginx \u9650\u6D41\uFF08limit_req_zone\uFF09 \u89F8\u767C\u7684\u65E5\u8A8C\uFF0C\u5982\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-log",children:'2024/02/15 12:34:56 [error] 1234#5678: *90123 limiting requests, excess: 20.000 by zone "api_limit" client: 192.168.1.100, server: example.com, request: "GET /api/v1/data HTTP/1.1"\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u5C0D\u61C9\u7684 Nginx \u914D\u7F6E\u53EF\u80FD\u662F\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-nginx",children:"limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;\nserver {\n    location /api/ {\n        limit_req zone=api_limit burst=20 nodelay;\n    }\n}\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u9019\u6A23\uFF0C\u7576\u67D0\u500B IP \u77ED\u6642\u9593\u5167\u767C\u9001\u904E\u591A\u8ACB\u6C42\uFF0CNginx \u6703\u5728\u65E5\u8A8C\u4E2D\u8A18\u9304 ",(0,s.jsx)(e.code,{children:'"limiting requests, excess: ... client: <IP>"'}),"\uFF0CFail2Ban \u5C31\u80FD\u6839\u64DA failregex \u4F86\u5339\u914D\u4E26\u5C01\u9396\u8A72 IP\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u63A5\u8457\u8A2D\u5B9A Jail\uFF0C\u5728 ",(0,s.jsx)(e.code,{children:"jail.local"})," \u6A94\u6848\u4E2D\u52A0\u5165\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:"[nginx-limitreq]\nenabled  = true\nport     = http,https\nfilter   = nginx-limitreq\nlogpath  = /var/log/nginx/error.log\nfindtime = 10m\nmaxretry = 10\nbantime  = 86400\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u5C07\u5728 10 \u5206\u9418\u5167 \u8D85\u904E 10 \u6B21\u89F8\u767C Nginx \u901F\u7387\u9650\u5236\u7684 IP \u5C01\u9396 24 \u5C0F\u6642\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u9632\u6B62\u66B4\u529B\u767B\u5165",children:"\u9632\u6B62\u66B4\u529B\u767B\u5165"}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679C\u7DB2\u7AD9\u63D0\u4F9B\u767B\u5165\u529F\u80FD\uFF0C\u653B\u64CA\u8005\u53EF\u80FD\u6703\u900F\u904E\u66B4\u529B\u5617\u8A66\u5E33\u865F\u5BC6\u78BC\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u5EFA\u7ACB\u4E00\u500B\u65B0\u7684\u904E\u6FFE\u5668\u6A94\u6848\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo vim /etc/fail2ban/filter.d/nginx-login.conf\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u586B\u5165\u4EE5\u4E0B\u5167\u5BB9\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:'[Definition]\nfailregex = <HOST> -.* "(POST|GET) /(admin|wp-login.php) HTTP.*"\nignoreregex =\n\n# failregex \u7528\u65BC\u5339\u914D\u60E1\u610F\u8ACB\u6C42\uFF0C\u76EE\u6A19\u662F\u5E38\u898B\u7684\u7BA1\u7406\u5F8C\u53F0\u767B\u9304\u9801\u9762\n# - <HOST> \u4EE3\u8868 IP \u5730\u5740\uFF08Fail2Ban \u6703\u81EA\u52D5\u66FF\u63DB\u70BA\u5BE6\u969B\u7684\u4F86\u6E90 IP\uFF09\n# - "(POST|GET) /(admin|wp-login.php) HTTP.*"\n#   - "(POST|GET)" \u4EE3\u8868 HTTP \u65B9\u6CD5\uFF08\u653B\u64CA\u8005\u53EF\u80FD\u6703\u7528 GET \u6216 POST \u5617\u8A66\u767B\u5165\uFF09\n#   - "/admin" \u662F\u4E00\u4E9B\u7DB2\u7AD9\u5F8C\u53F0\u7684\u5E38\u898B\u8DEF\u5F91\n#   - "/wp-login.php" \u662F WordPress \u767B\u9304\u9801\u9762\n#   - "HTTP.*" \u7528\u65BC\u5339\u914D\u4E0D\u540C\u7684 HTTP \u7248\u672C\uFF0C\u5982 HTTP/1.1\u3001HTTP/2\n#\n# ignoreregex \u7528\u65BC\u6392\u9664\u67D0\u4E9B\u7279\u5B9A\u8ACB\u6C42\n# - \u9019\u88E1\u7559\u7A7A\uFF0C\u8868\u793A\u4E0D\u6392\u9664\u4EFB\u4F55\u8ACB\u6C42\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u6703\u5339\u914D WordPress \u6216\u4E00\u822C\u7DB2\u7AD9\u7684\u7BA1\u7406\u5F8C\u53F0\u767B\u5165\u5617\u8A66\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u63A5\u8457\u8A2D\u5B9A Jail\uFF0C\u5728 ",(0,s.jsx)(e.code,{children:"jail.local"})," \u6A94\u6848\u4E2D\u52A0\u5165\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:"[nginx-login]\nenabled  = true\nport     = http,https\nfilter   = nginx-login\nlogpath  = /var/log/nginx/access.log\nfindtime = 5m\nmaxretry = 5\nbantime  = 86400\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u6703\u5728 5 \u5206\u9418\u5167\u8D85\u904E 5 \u6B21\u767B\u5165\u5931\u6557\u7684 IP \u5C01\u9396 24 \u5C0F\u6642\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u5617\u8A66\u5B58\u53D6\u654F\u611F\u8CC7\u6599",children:"\u5617\u8A66\u5B58\u53D6\u654F\u611F\u8CC7\u6599"}),"\n",(0,s.jsxs)(e.p,{children:["\u60E1\u610F\u653B\u64CA\u8005\u53EF\u80FD\u6703\u8A66\u5716\u5B58\u53D6 ",(0,s.jsx)(e.code,{children:"/etc/passwd"}),"\u3001",(0,s.jsx)(e.code,{children:"/.git"}),"\u3001",(0,s.jsx)(e.code,{children:"/.env"})," \u7B49\u654F\u611F\u8DEF\u5F91\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u5EFA\u7ACB\u4E00\u500B\u65B0\u7684\u904E\u6FFE\u5668\u6A94\u6848\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo vim /etc/fail2ban/filter.d/nginx-sensitive.conf\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u586B\u5165\u4EE5\u4E0B\u5167\u5BB9\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:'[Definition]\nfailregex = <HOST> -.* "(GET|POST) /(etc/passwd|\\.git|\\.env) HTTP.*"\nignoreregex =\n\n# failregex \u7528\u65BC\u5339\u914D\u8A66\u5716\u8A2A\u554F\u654F\u611F\u6587\u4EF6\u7684\u60E1\u610F\u8ACB\u6C42\n# - <HOST> \u4EE3\u8868 IP \u5730\u5740\uFF08Fail2Ban \u6703\u81EA\u52D5\u66FF\u63DB\u70BA\u5BE6\u969B\u7684\u4F86\u6E90 IP\uFF09\n# - "(GET|POST) /(etc/passwd|\\.git|\\.env) HTTP.*"\n#   - "(GET|POST)" \u4EE3\u8868 HTTP \u65B9\u6CD5\uFF0C\u653B\u64CA\u8005\u53EF\u80FD\u6703\u7528 GET \u6216 POST \u4F86\u63A2\u6E2C\u6587\u4EF6\n#   - "/etc/passwd" \u662F Linux \u7CFB\u7D71\u7684\u5BC6\u78BC\u6587\u4EF6\uFF0C\u653B\u64CA\u8005\u53EF\u80FD\u6703\u8A66\u5716\u8B80\u53D6\u5B83\n#   - "/.git" \u76EE\u9304\u53EF\u80FD\u5305\u542B\u6E90\u4EE3\u78BC\u8207\u654F\u611F\u4FE1\u606F\uFF0C\u653B\u64CA\u8005\u53EF\u80FD\u6703\u8A66\u5716\u4E0B\u8F09 `.git` \u6587\u4EF6\u593E\n#   - "/.env" \u74B0\u5883\u8B8A\u6578\u6587\u4EF6\uFF0C\u53EF\u80FD\u5305\u542B **\u8CC7\u6599\u5EAB\u5BC6\u78BC\u3001API Key\u3001\u5BC6\u9470**\n#   - "HTTP.*" \u5339\u914D\u4E0D\u540C\u7684 HTTP \u7248\u672C\uFF08\u5982 HTTP/1.1\u3001HTTP/2\uFF09\n#\n# ignoreregex \u7528\u65BC\u6392\u9664\u7279\u5B9A\u8ACB\u6C42\u7684\u5339\u914D\n# - \u9019\u88E1\u7559\u7A7A\uFF0C\u8868\u793A\u4E0D\u6392\u9664\u4EFB\u4F55\u8ACB\u6C42\n\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u9019\u689D\u898F\u5247\u7528\u65BC\u9632\u6B62\u76EE\u9304\u904D\u6B77\u653B\u64CA\u3001\u4FDD\u8B77 Git \u76EE\u9304\u3001\u963B\u64CB\u5C0D ",(0,s.jsx)(e.code,{children:".env"})," \u6587\u4EF6\u7684\u63A2\u6E2C\uFF0C\u4EE5\u53CA\u9632\u7BC4 Web Scanner \u6383\u63CF\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u63A5\u8457\u8A2D\u5B9A Jail\uFF0C\u5728 ",(0,s.jsx)(e.code,{children:"jail.local"})," \u6A94\u6848\u4E2D\u52A0\u5165\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:"[nginx-sensitive]\nenabled  = true\nport     = http,https\nfilter   = nginx-sensitive\nlogpath  = /var/log/nginx/access.log\nmaxretry = 1\nbantime  = 86400\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u6703\u5C0D\u4EFB\u4F55\u5617\u8A66\u5B58\u53D6\u9019\u4E9B\u654F\u611F\u6A94\u6848\u7684 IP \u7ACB\u5373\u5C01\u9396 24 \u5C0F\u6642\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u91DD\u5C0D-api-\u7684\u653B\u64CA",children:"\u91DD\u5C0D API \u7684\u653B\u64CA"}),"\n",(0,s.jsx)(e.admonition,{type:"tip",children:(0,s.jsx)(e.p,{children:"\u8981\u8A18\u5F97\u6839\u64DA\u4F60\u7684 api \u4F86\u8ABF\u6574\u904E\u6FFE\u5668\u3002"})}),"\n",(0,s.jsxs)(e.p,{children:["\u91DD\u5C0D API \u7AEF\u9EDE\uFF08\u5982 ",(0,s.jsx)(e.code,{children:"/api/login"}),"\u3001",(0,s.jsx)(e.code,{children:"/api/register"}),"\uFF09\u9032\u884C\u66B4\u529B\u653B\u64CA\u6642\uFF0C\u61C9\u9650\u5236\u8ACB\u6C42\u983B\u7387\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u5EFA\u7ACB\u4E00\u500B\u65B0\u7684\u904E\u6FFE\u5668\u6A94\u6848\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo vim /etc/fail2ban/filter.d/nginx-api.conf\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u586B\u5165\u4EE5\u4E0B\u5167\u5BB9\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:'[Definition]\nfailregex = <HOST> -.* "(POST) /api/(login|register) HTTP.*"\nignoreregex =\n\n# failregex \u7528\u65BC\u5339\u914D\u91DD\u5C0D API \u767B\u5165\u548C\u8A3B\u518A\u7684\u60E1\u610F\u8ACB\u6C42\n# - <HOST> \u4EE3\u8868 IP \u5730\u5740\uFF08Fail2Ban \u6703\u81EA\u52D5\u66FF\u63DB\u70BA\u5BE6\u969B\u7684\u4F86\u6E90 IP\uFF09\n# - "(POST) /api/(login|register) HTTP.*"\n#   - "(POST)" \u9650\u5B9A\u70BA HTTP POST \u65B9\u6CD5\uFF08\u9632\u6B62\u66B4\u529B\u7834\u89E3\u767B\u5165\u6216\u6FEB\u7528\u8A3B\u518A\uFF09\n#   - "/api/login" \u662F\u767B\u5165 API\uFF0C\u53EF\u80FD\u6210\u70BA\u66B4\u529B\u7834\u89E3\u653B\u64CA\u76EE\u6A19\n#   - "/api/register" \u662F\u8A3B\u518A API\uFF0C\u653B\u64CA\u8005\u53EF\u80FD\u6703\u7528\u4F86\u6FEB\u767C\u5E33\u865F\uFF08\u5982\u6A5F\u5668\u4EBA\u8A3B\u518A\uFF09\n#   - "HTTP.*" \u5339\u914D HTTP \u7248\u672C\uFF08\u5982 HTTP/1.1\u3001HTTP/2\uFF09\n#\n# ignoreregex \u7528\u65BC\u6392\u9664\u67D0\u4E9B\u7279\u5B9A\u8ACB\u6C42\u7684\u5339\u914D\n# - \u9019\u88E1\u7559\u7A7A\uFF0C\u8868\u793A\u4E0D\u6392\u9664\u4EFB\u4F55\u8ACB\u6C42\n\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u689D\u898F\u5247\u7528\u65BC\u9632\u6B62\u66B4\u529B\u7834\u89E3\u767B\u5165\u3001\u81EA\u52D5\u5316\u8A3B\u518A\u653B\u64CA\uFF0C\u4EE5\u53CA\u63D0\u5347 API \u5B89\u5168\u6027\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u63A5\u8457\u8A2D\u5B9A Jail\uFF0C\u5728 ",(0,s.jsx)(e.code,{children:"jail.local"})," \u6A94\u6848\u4E2D\u52A0\u5165\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:"[nginx-api]\nenabled  = true\nport     = http,https\nfilter   = nginx-api\nlogpath  = /var/log/nginx/access.log\nfindtime = 1m\nmaxretry = 10\nbantime  = 86400\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u6703\u5728 1 \u5206\u9418\u5167\u8D85\u904E 10 \u6B21\u767B\u5165\u5617\u8A66\u7684 IP \u5C01\u9396 24 \u5C0F\u6642\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u5957\u7528\u65B0\u898F\u5247",children:"\u5957\u7528\u65B0\u898F\u5247"}),"\n",(0,s.jsx)(e.p,{children:"\u5B8C\u6210\u8A2D\u5B9A\u5F8C\uFF0C\u91CD\u65B0\u555F\u52D5 Fail2ban\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo systemctl restart fail2ban\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4E26\u78BA\u8A8D Jail \u72C0\u614B\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo fail2ban-client status\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679C\u60F3\u67E5\u770B\u67D0\u500B\u76E3\u7344\u7684\u72C0\u614B\uFF0C\u53EF\u4EE5\u4F7F\u7528\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo fail2ban-client status nginx-404 # \u66FF\u63DB\u70BA\u4F60\u7684 jail \u540D\u7A31\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5230\u9019\u88E1\uFF0C\u6211\u5011\u5DF2\u91DD\u5C0D Nginx \u7684\u5E38\u898B\u653B\u64CA\u985E\u578B\u8A2D\u5B9A Fail2ban \u9032\u884C\u9632\u79A6\uFF0C\u78BA\u4FDD\u7DB2\u7AD9\u5B89\u5168\u3002"}),"\n",(0,s.jsx)(e.h2,{id:"\u6E2C\u8A66\u9632\u79A6\u6548\u679C",children:"\u6E2C\u8A66\u9632\u79A6\u6548\u679C"}),"\n",(0,s.jsx)(e.p,{children:"\u5B8C\u6210 Fail2ban \u7684 Nginx \u9632\u79A6\u8A2D\u5B9A\u5F8C\uFF0C\u6211\u5011\u7C21\u55AE\u6E2C\u8A66\u4E00\u4E0B\u3002"}),"\n",(0,s.jsxs)(e.h3,{id:"\u4F7F\u7528-curl-\u6A21\u64EC\u653B\u64CA",children:["\u4F7F\u7528 ",(0,s.jsx)(e.code,{children:"curl"})," \u6A21\u64EC\u653B\u64CA"]}),"\n",(0,s.jsxs)(e.p,{children:["\u53EF\u4EE5\u5728\u672C\u6A5F\u6216\u53E6\u4E00\u53F0\u96FB\u8166\u4E0A\u4F7F\u7528 ",(0,s.jsx)(e.code,{children:"curl"})," \u767C\u9001\u60E1\u610F\u8ACB\u6C42\u4F86\u89F8\u767C Fail2ban \u7684\u5C01\u9396\u6A5F\u5236\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u8ACB\u6CE8\u610F\u6E2C\u8A66\u6642\u4E0D\u8981\u5F9E\u672C\u6A5F ",(0,s.jsx)(e.code,{children:"localhost"})," \u767C\u9001\uFF0C\u56E0\u70BA ",(0,s.jsx)(e.code,{children:"127.0.0.1"})," \u53EF\u80FD\u88AB ",(0,s.jsx)(e.code,{children:"ignoreip"})," \u8A2D\u5B9A\u6392\u9664\uFF0CFail2ban \u4E0D\u6703\u5C01\u9396\u5B83\u3002\u53EF\u4EE5\u4F7F\u7528\u5176\u4ED6\u7DB2\u8DEF\u74B0\u5883\u7684\u96FB\u8166\u6216\u4F3A\u670D\u5668\u4F86\u6E2C\u8A66\uFF0C\u6216\u662F\u66AB\u6642\u5C07 ",(0,s.jsx)(e.code,{children:"ignoreip"})," \u6E05\u7A7A\u3002"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"1. \u6E2C\u8A66 404 \u6383\u63CF\u6514\u622A"})}),"\n",(0,s.jsx)(e.p,{children:"\u6A21\u64EC\u653B\u64CA\u8005\u96A8\u6A5F\u6383\u63CF\u4E0D\u5B58\u5728\u7684\u9801\u9762\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"for i in $(seq 1 6); do\n    curl -I http://<\u4F60\u7684\u4F3A\u670D\u5668IP\u6216\u57DF\u540D>/nonexistentpage_$i ;\ndone\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u9019\u5C07\u9023\u7E8C\u8ACB\u6C42 6 \u500B\u4E0D\u5B58\u5728\u7684\u9801\u9762\uFF0C\u7522\u751F HTTP 404 \u932F\u8AA4\u3002\u5982\u679C\u4F60\u7684\u898F\u5247\u8A2D\u5B9A\u70BA 5 \u6B21 404 \u5373\u5C01\u9396\uFF0CFail2ban \u61C9\u8A72\u6703\u5728\u7B2C 5 \u6216\u7B2C 6 \u6B21\u6642\u5C07\u8A72 IP \u5C01\u9396\u3002\n\u5C01\u9396\u5F8C\uFF0C\u4F60\u518D\u57F7\u884C ",(0,s.jsx)(e.code,{children:"curl"})," \u8ACB\u6C42\uFF0C\u61C9\u8A72\u6703\u767C\u73FE\u9023\u7DDA\u5931\u6557\uFF08\u5982\u8D85\u6642\u6216\u9023\u63A5\u88AB\u62D2\uFF09\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"2. \u6E2C\u8A66\u654F\u611F URL \u6514\u622A"})}),"\n",(0,s.jsxs)(e.p,{children:["\u653B\u64CA\u8005\u901A\u5E38\u6703\u5617\u8A66\u5B58\u53D6\u7CFB\u7D71\u654F\u611F\u6A94\u6848\uFF0C\u4F8B\u5982 ",(0,s.jsx)(e.code,{children:"/etc/passwd"}),"\uFF0C\u4F86\u78BA\u8A8D\u4F3A\u670D\u5668\u662F\u5426\u5B58\u5728\u6F0F\u6D1E\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"curl -I http://<\u4F60\u7684\u4F3A\u670D\u5668>/etc/passwd\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679C Fail2ban \u7684 ",(0,s.jsx)(e.code,{children:"nginx-sensitive"})," \u904E\u6FFE\u5668\u6B63\u78BA\u8A2D\u5B9A\uFF0C\u9019\u6B21\u8ACB\u6C42\u61C9\u8A72\u6703\u88AB Fail2ban \u5075\u6E2C\u5230\u4E26\u7ACB\u5373\u5C01\u9396\u8A72 IP\uFF08\u5982\u679C ",(0,s.jsx)(e.code,{children:"maxretry = 1"}),"\uFF09\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"3. \u6E2C\u8A66 User-Agent \u6514\u622A"})}),"\n",(0,s.jsxs)(e.p,{children:["\u6A21\u64EC\u60E1\u610F\u722C\u87F2\u5DE5\u5177\uFF0C\u4F8B\u5982 ",(0,s.jsx)(e.code,{children:"sqlmap"}),"\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'curl -A "sqlmap/1.5.2#stable" http://<\u4F60\u7684\u4F3A\u670D\u5668>/\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679C\u4F60\u7684\u898F\u5247\u4E2D\u8A2D\u5B9A\u4E86 ",(0,s.jsx)(e.code,{children:"sqlmap"})," \u9019\u500B User-Agent\uFF0CFail2ban \u61C9\u8A72\u6703\u7ACB\u5373\u5C01\u9396\u8A72 IP\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"4. \u6E2C\u8A66\u66B4\u529B\u767B\u5165\u653B\u64CA"})}),"\n",(0,s.jsx)(e.p,{children:"\u5C0D WordPress \u6216\u5176\u4ED6\u767B\u5165\u9801\u767C\u9001\u591A\u6B21\u8ACB\u6C42\uFF0C\u6A21\u64EC\u653B\u64CA\u8005\u5617\u8A66\u66B4\u529B\u7834\u89E3\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'for i in $(seq 1 6); do\n    curl -X POST -d "username=admin&password=wrongpassword" http://<\u4F60\u7684\u4F3A\u670D\u5668>/wp-login.php ;\ndone\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679C\u4F60\u7684 ",(0,s.jsx)(e.code,{children:"nginx-sensitive"})," \u904E\u6FFE\u5668\u8A2D\u5B9A\u70BA 5 \u6B21\u5931\u6557\u5373\u5C01\u9396\uFF0C\u5247 Fail2ban \u61C9\u8A72\u6703\u5728\u7B2C 5 \u6216 6 \u6B21\u6642\u5C07\u8A72 IP \u5C01\u9396\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u9A57\u8B49\u72C0\u614B\u8207\u65E5\u8A8C",children:"\u9A57\u8B49\u72C0\u614B\u8207\u65E5\u8A8C"}),"\n",(0,s.jsxs)(e.p,{children:["\u4F60\u53EF\u4EE5\u4F7F\u7528\u4EE5\u4E0B\u6307\u4EE4\u67E5\u770B\u76E3\u7344\u5167\u7684\u72C0\u614B\uFF0C\u5047\u8A2D\u6211\u5011\u8981\u67E5\u770B ",(0,s.jsx)(e.code,{children:"nginx-sensitive"}),"\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo fail2ban-client status nginx-sensitive\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u9810\u671F\u8F38\u51FA\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"Status for the jail: nginx-sensitive\n|- Filter\n|  |- Currently failed: 0\n|  |- Total failed: 9\n|  `- File list: /var/log/nginx/access.log /var/log/nginx/error.log\n`- Actions\n   |- Currently banned: 1\n   |- Total banned: 2\n   `- Banned IP list: 203.0.113.45\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Currently banned"}),"\uFF1A\u7576\u524D\u88AB\u5C01\u9396\u7684 IP \u6578\u91CF\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Total failed"}),"\uFF1A\u7D2F\u8A08\u7684\u60E1\u610F\u8ACB\u6C42\u6B21\u6578\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Banned IP list"}),"\uFF1A\u986F\u793A\u7576\u524D\u88AB\u5C01\u9396\u7684 IP\uFF08\u4F8B\u5982 ",(0,s.jsx)(e.code,{children:"203.0.113.45"}),"\uFF09\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.p,{children:"\u63A5\u8457\uFF0C\u4F60\u53EF\u4EE5\u67E5\u770B Fail2ban \u7684\u65E5\u8A8C\uFF0C\u78BA\u8A8D\u5C01\u9396\u7D00\u9304\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo tail -n 20 /var/log/fail2ban.log\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u9810\u671F\u8F38\u51FA\u7BC4\u4F8B\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"fail2ban.actions [INFO] Ban 203.0.113.45 on nginx-sensitive\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u8868\u793A ",(0,s.jsx)(e.code,{children:"203.0.113.45"})," \u9019\u500B IP \u56E0\u89F8\u767C ",(0,s.jsx)(e.code,{children:"nginx-sensitive"})," \u898F\u5247\u800C\u88AB\u5C01\u9396\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"\u89E3\u9664\u5C01\u9396-ip",children:"\u89E3\u9664\u5C01\u9396 IP"}),"\n",(0,s.jsx)(e.p,{children:"\u5728\u6E2C\u8A66\u6216\u65E5\u5E38\u7BA1\u7406\u6642\uFF0C\u4F60\u53EF\u80FD\u9700\u8981\u624B\u52D5\u5C01\u9396\u6216\u89E3\u9664\u5C01\u9396\u67D0\u500B IP\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u4F60\u53EF\u4EE5\u624B\u52D5\u5C01\u9396\u67D0\u500B IP\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo fail2ban-client set nginx-sensitive banip 203.0.113.45\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u9019\u5C07\u7ACB\u5373\u5C01\u9396 ",(0,s.jsx)(e.code,{children:"203.0.113.45"}),"\uFF0C\u4E26\u4E14\u8A72 IP \u6703\u88AB\u52A0\u5165 ",(0,s.jsx)(e.code,{children:"nginx-sensitive"})," \u7684\u5C01\u9396\u540D\u55AE\u4E2D\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679C\u767C\u73FE\u67D0\u500B IP \u88AB\u8AA4\u5C01\u9396\uFF0C\u53EF\u4EE5\u89E3\u9664\u5C01\u9396\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo fail2ban-client set nginx-sensitive unbanip 203.0.113.45\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u57F7\u884C\u8A72\u6307\u4EE4\u5F8C\uFF0C\u53EF\u4EE5\u4F7F\u7528 ",(0,s.jsx)(e.code,{children:"fail2ban-client status nginx-sensitive"})," \u78BA\u8A8D\u8A72 IP \u662F\u5426\u5DF2\u5F9E\u5C01\u9396\u540D\u55AE\u79FB\u9664\u3002"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.p,{children:"\u6700\u5F8C\uFF0C\u4F60\u53EF\u4EE5\u6AA2\u67E5\u9632\u706B\u7246\u898F\u5247\uFF08iptables / nftables\uFF09\u662F\u5426\u6B63\u78BA\u8A2D\u5B9A\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["Fail2ban \u4E3B\u8981\u900F\u904E ",(0,s.jsx)(e.code,{children:"iptables"}),"\uFF08\u6216 ",(0,s.jsx)(e.code,{children:"nftables"}),"\uFF09\u4F86\u5C01\u9396 IP\uFF0C\u56E0\u6B64\u4E5F\u53EF\u4EE5\u76F4\u63A5\u6AA2\u67E5\u9632\u706B\u7246\u898F\u5247\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"sudo iptables -L -n --line-numbers\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679C\u5C01\u9396\u898F\u5247\u751F\u6548\uFF0C\u4F60\u61C9\u8A72\u6703\u770B\u5230\u985E\u4F3C\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"Chain f2b-nginx-sensitive (1 references)\nnum  target     prot opt source               destination\n1    REJECT     all  --  203.0.113.45          0.0.0.0/0   reject-with icmp-port-unreachable\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u9019\u8868\u793A ",(0,s.jsx)(e.code,{children:"203.0.113.45"})," \u5DF2\u88AB\u5C01\u9396\uFF0C\u6240\u6709\u6D41\u91CF\u90FD\u6703\u88AB\u62D2\u7D55\u3002"]}),"\n",(0,s.jsx)(e.h2,{id:"\u7D50\u8AD6",children:"\u7D50\u8AD6"}),"\n",(0,s.jsx)(e.p,{children:"\u5230\u9019\u908A\uFF0C\u6211\u5011\u8A2D\u5B9A\u4E86\u91DD\u5C0D Nginx \u7684\u9632\u79A6\u898F\u5247\uFF0C\u7B97\u662F\u5B8C\u6210\u4E86\u57FA\u672C\u7684 Fail2ban \u8A2D\u5B9A\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u500B\u90E8\u5206\u8ACB\u52D9\u5FC5\u6309\u7167\u4F60\u7684\u5BE6\u969B\u9700\u6C42\u8ABF\u6574\u53C3\u6578\uFF0C\u6BD4\u5982\u4E0D\u540C\u985E\u578B\u7684\u653B\u64CA\u53EF\u4EE5\u62C6\u5206\u4E0D\u540C\u76E3\u7344\u3001\u8A2D\u7F6E\u4E0D\u540C\u7684 maxretry/findtime\uFF0C\u4EE5\u53CA\u5BE9\u614E\u8A2D\u5B9A ignoreip \u767D\u540D\u55AE\u4EE5\u907F\u514D\u8AA4\u5C01\u95DC\u9375 IP\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u90E8\u7F72\u5B8C\u6210\u5F8C\uFF0C\u9084\u662F\u8981\u6301\u7E8C\u95DC\u5FC3 Fail2ban \u7684\u65E5\u8A8C\uFF0C\u78BA\u4FDD\u5B83\u6B63\u5E38\u904B\u884C\u4E26\u80FD\u6709\u6548\u9632\u79A6\u60E1\u610F\u653B\u64CA\u3002"})]})}function t(n={}){let{wrapper:e}={...(0,r.a)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(h,{...n})}):h(n)}},50065:function(n,e,i){i.d(e,{Z:()=>a,a:()=>c});var l=i(67294);let s={},r=l.createContext(s);function c(n){let e=l.useContext(r);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:c(n.components),l.createElement(r.Provider,{value:e},n.children)}}}]);