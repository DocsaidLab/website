"use strict";(self.webpackChunkdocsaid_website=self.webpackChunkdocsaid_website||[]).push([["40142"],{10215:function(n,e,t){t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>a});var i=t(46796),s=t(74848),r=t(84429);let o={slug:"mac-forticlient-vpn-split-routing",title:"FortiClient VPN \u5206\u6D41\u8A2D\u5B9A\u8207\u8DEF\u7531\u6E2C\u8A66",authors:"Z. Yuan",tags:["vpn-routing","macos","forticlient"],image:"/img/2025/0802.jpg",description:"\u8B93 FortiClient \u53EA\u8CA0\u8CAC\u516C\u53F8\u5167\u7DB2\uFF0C\u5176\u4ED6\u6D41\u91CF\u5168\u90E8\u56DE\u5230\u672C\u5730\u3002"},l,c={authorsImageUrls:[void 0]},a=[{value:"\u70BA\u4EC0\u9EBC\u5931\u6548\uFF1F",id:"\u70BA\u4EC0\u9EBC\u5931\u6548",level:2},{value:"\u6240\u4EE5\uFF1F",id:"\u6240\u4EE5",level:2},{value:"\u7B2C\u4E00\u6B65\uFF1A\u6539\u8DEF\u7531",id:"\u7B2C\u4E00\u6B65\u6539\u8DEF\u7531",level:2},{value:"\u7B2C\u4E8C\u6B65\uFF1A\u6062\u5FA9\u672C\u5730\u9810\u8A2D\u8DEF\u7531",id:"\u7B2C\u4E8C\u6B65\u6062\u5FA9\u672C\u5730\u9810\u8A2D\u8DEF\u7531",level:2},{value:"\u7B2C\u4E09\u6B65\uFF1A\u52A0\u5165\u5167\u7DB2\u5C08\u5C6C\u8DEF\u7531",id:"\u7B2C\u4E09\u6B65\u52A0\u5165\u5167\u7DB2\u5C08\u5C6C\u8DEF\u7531",level:2},{value:"\u7B2C\u56DB\u6B65\uFF1A\u78BA\u8A8D\u8A2D\u5B9A\u662F\u5426\u751F\u6548",id:"\u7B2C\u56DB\u6B65\u78BA\u8A8D\u8A2D\u5B9A\u662F\u5426\u751F\u6548",level:2},{value:"\u5B8C\u6574\u8173\u672C",id:"\u5B8C\u6574\u8173\u672C",level:2}];function d(n){let e={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.p,{children:"\u4E4B\u524D\u6211\u6709\u5206\u4EAB\u904E\u600E\u9EBC\u6539 VPN \u8DEF\u7531\u3002"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u524D\u60C5\u63D0\u8981\uFF1A",(0,s.jsx)(e.a,{href:"/blog/mac-selective-vpn-routing",children:(0,s.jsx)(e.strong,{children:"\u70BA VPN \u8A2D\u5B9A\u9078\u64C7\u6027\u6D41\u91CF\u8DEF\u7531"})})]}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u90A3\u6642\u5019\u7528\u7684 VPN \u8D70\u7684\u662F L2TP \u7684\u6A21\u5F0F\uFF0C\u53EF\u4EE5\u900F\u904E ",(0,s.jsx)(e.code,{children:"/etc/ppp/ip-up"})," \u8173\u672C\u4F86\u4FEE\u6539\u8DEF\u7531\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5F8C\u4F86\u6211\u56E0\u70BA\u5DE5\u4F5C\u7684\u9700\u6C42\uFF0C\u63DB\u4E86\u65B0\u7684 VPN \u5DE5\u5177\uFF1A",(0,s.jsx)(e.strong,{children:"FortiClient"}),"\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u7136\u5F8C\u539F\u672C\u7684\u65B9\u6CD5\u5C31\u5931\u6548\u4E86\u3002"}),"\n",(0,s.jsxs)(e.admonition,{type:"info",children:[(0,s.jsx)(e.p,{children:"FortiClient \u662F Fortinet \u516C\u53F8\u63A8\u51FA\u7684\u4E00\u5957\u5B89\u5168\u7AEF\u9EDE\u89E3\u6C7A\u65B9\u6848\uFF0C\u5E38\u898B\u7528\u9014\u5982\u4E0B\uFF1A"}),(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"VPN \u9023\u7DDA\u5DE5\u5177"}),"\nFortiClient \u652F\u63F4 SSL VPN \u548C IPSec VPN\uFF0C\u8B93\u4F7F\u7528\u8005\u80FD\u5B89\u5168\u5730\u5F9E\u9060\u7AEF\u5B58\u53D6\u516C\u53F8\u5167\u7DB2\u3002\u5B83\u53EF\u4EE5\u6574\u5408 FortiGate \u9632\u706B\u7246\u653F\u7B56\uFF0C\u63D0\u4F9B\u4F01\u696D\u7D1A\u7684\u7DB2\u8DEF\u5B89\u5168\u8207\u9023\u7DDA\u63A7\u7BA1\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u7AEF\u9EDE\u9632\u8B77"}),"\nFortiClient \u9664\u4E86 VPN \u529F\u80FD\uFF0C\u4E5F\u53EF\u7528\u4F86\u63D0\u4F9B\u60E1\u610F\u7A0B\u5F0F\u9632\u8B77\u3001\u7DB2\u9801\u904E\u6FFE\u3001\u884C\u70BA\u5206\u6790\u7B49\u529F\u80FD\uFF0C\u5F37\u5316\u4F7F\u7528\u8005\u88DD\u7F6E\u7684\u5B89\u5168\u6027\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u8207 Fortinet \u751F\u614B\u6574\u5408"}),"\n\u5B83\u80FD\u8207 Fortinet \u7684\u5176\u4ED6\u7522\u54C1\uFF08\u4F8B\u5982 FortiGate\u3001FortiAnalyzer\u3001EMS\uFF09\u6574\u5408\uFF0C\u63D0\u4F9B\u7D71\u4E00\u7684\u5B89\u5168\u76E3\u63A7\u8207\u7BA1\u7406\u6A5F\u5236\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u8DE8\u5E73\u53F0\u652F\u63F4"}),"\nFortiClient \u652F\u63F4 Windows\u3001macOS\u3001Linux\u3001iOS\u3001Android \u7B49\u591A\u5E73\u53F0\uFF0C\u65B9\u4FBF\u4F01\u696D\u5167\u90E8\u7D71\u4E00\u90E8\u7F72\u8207\u7BA1\u7406\u3002"]}),"\n"]}),"\n"]}),(0,s.jsx)(e.p,{children:"\u7C21\u55AE\u4F86\u8AAA\uFF0CFortiClient \u662F\u4E00\u5957\u7D50\u5408\u9060\u7AEF\u9023\u7DDA\u8207\u5B89\u5168\u9632\u8B77\u7684\u4F01\u696D\u7528\u6236\u7AEF\u5DE5\u5177\uFF0C\u5C24\u5176\u9069\u5408\u9700\u8981\u56B4\u683C\u63A7\u7BA1\u5167\u90E8\u7DB2\u8DEF\u9023\u7DDA\u6B0A\u9650\u7684\u7D44\u7E54\u3002"})]}),"\n",(0,s.jsx)(e.h2,{id:"\u70BA\u4EC0\u9EBC\u5931\u6548",children:"\u70BA\u4EC0\u9EBC\u5931\u6548\uFF1F"}),"\n",(0,s.jsxs)(e.p,{children:["FortiClient \u6703\u5728 macOS \u4E0A\u5EFA\u7ACB ",(0,s.jsx)(e.code,{children:"utunX"})," \u865B\u64EC\u4ECB\u9762\uFF0C\u4E26\u4E3B\u52D5\u63A8\u9001\u4E00\u6574\u5957 ",(0,s.jsx)(e.strong,{children:"\u9810\u8A2D\u8DEF\u7531"}),"\uFF0C\u5E38\u898B\u7D44\u5408\u6709\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"0.0.0.0/1      \u2192 utunX\n128.0.0.0/1    \u2192 utunX\ndefault        \u2192 utunX\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u9019\u4E09\u689D\u5408\u8D77\u4F86\u7B49\u65BC\u300C\u6240\u6709\u6D41\u91CF\u90FD\u7D93\u904E VPN\u300D\u3002\u800C\u4E14\u6BCF\u6B21\u9023\u7DDA\u6642\u90FD\u6703\u8986\u5BEB\u672C\u5730\u8A2D\u5B9A\uFF0C\u6240\u4EE5\u55AE\u9760 ",(0,s.jsx)(e.code,{children:"/etc/ppp/ip-up"})," \u5DF2\u7D93\u7121\u6CD5\u52DD\u4EFB\u5206\u6D41\u7684\u4EFB\u52D9\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u90A3\u600E\u9EBC\u884C\uFF1F\u{1F4A2}"}),"\n",(0,s.jsx)(e.p,{children:"\u5C31\u53EA\u662F\u4E00\u500B VPN \u5DE5\u5177\uFF0C\u5C31\u60F3\u62FF\u8D70\u6211\u5168\u90E8\u7684\u6D41\u91CF\uFF1F"}),"\n",(0,s.jsx)(e.h2,{id:"\u6240\u4EE5",children:"\u6240\u4EE5\uFF1F"}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u6B21\uFF0C\u6211\u7684\u76EE\u6A19\u5F88\u7C21\u55AE\uFF0C\u53EA\u8981\u6EFF\u8DB3\u4EE5\u4E0B\u689D\u4EF6\uFF1A"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u516C\u53F8\u5167\u7DB2"}),"\uFF08\u4F8B\uFF1A",(0,s.jsx)(e.code,{children:"10.0.0.0/8"}),"\uFF09\u8D70 VPN"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u672C\u5730\u5340\u7DB2\uFF0F\u4E00\u822C\u7DB2\u969B\u7DB2\u8DEF"})," \u76F4\u63A5\u8D70\u5BE6\u9AD4\u7DB2\u5361\uFF08Wi-Fi\u3001\u4E59\u592A\u7DB2\u8DEF\u7B49\uFF09"]}),"\n",(0,s.jsx)(e.li,{children:"\u81EA\u52D5\u5075\u6E2C\u7576\u524D VPN \u4ECB\u9762\u8207\u672C\u5730 gateway"}),"\n",(0,s.jsx)(e.li,{children:"\u63D0\u4F9B\u9A57\u8B49\u6A5F\u5236\uFF0C\u78BA\u5B9A\u8DEF\u7531\u771F\u7684\u751F\u6548"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u4EE5\u4E0B\u6211\u5011\u5148\u8B1B\u4E00\u4E0B\u624B\u52D5\u6307\u4EE4\uFF0C\u81EA\u52D5\u5316\u8173\u672C\u653E\u5728\u6700\u5F8C\u9762\u3002"}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u7B2C\u4E00\u6B65\u6539\u8DEF\u7531",children:"\u7B2C\u4E00\u6B65\uFF1A\u6539\u8DEF\u7531"}),"\n",(0,s.jsx)(e.p,{children:"FortiClient \u5728\u9023\u7DDA\u6642\u6703\u5077\u5077\u585E\u9032\u4E09\u689D\u5F37\u5236\u8DEF\u7531\uFF0C\u628A\u6240\u6709\u6D41\u91CF\u90FD\u62C9\u9032 VPN\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"0.0.0.0/1\n128.0.0.0/1\ndefault\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u4E09\u689D\u52A0\u8D77\u4F86\u5C31\u662F\u6574\u500B IPv4 \u7DB2\u6BB5\uFF0C\u4E5F\u5C31\u662F\u628A\u4F60\u6240\u6709\u7684\u7DB2\u8DEF\u8ACB\u6C42\u4E00\u7DB2\u6253\u76E1\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u6240\u4EE5\u6211\u5011\u7684\u7B2C\u4E00\u6B65\uFF0C\u5C31\u662F\u628A\u5B83\u5011\u522A\u6389\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'for cidr in default 0.0.0.0/1 128.0.0.0/1; do\n  sudo route -q -n delete -ifscope "$VPN_IF" "$cidr"\ndone\n'})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"$VPN_IF \u662F\u6211\u5BEB\u7684\u8173\u672C\uFF0C\u76EE\u7684\u662F\u5E6B\u6211\u5011\u627E\u51FA\u4ECB\u9762\uFF0C\u4F8B\u5982 utun4\u3001utun6 \u7B49\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:'\u9019\u4E00\u6B65\u975E\u5E38\u95DC\u9375\uFF0C\u5982\u679C\u6C92\u6709\u6210\u529F\u522A\u9664\uFF0CVPN \u6703\u6301\u7E8C\u6514\u622A\u4F60\u7684\u5168\u90E8\u6D41\u91CF\u3002\u522A\u9664\u6642\u4E5F\u6709\u53EF\u80FD\u51FA\u73FE "not in table" \u7684\u8A0A\u606F\uFF0C\u53EA\u4EE3\u8868\u8A72\u8DEF\u7531\u4E0D\u5B58\u5728\uFF0C\u53EF\u4EE5\u7565\u904E\u3002'}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u7B2C\u4E8C\u6B65\u6062\u5FA9\u672C\u5730\u9810\u8A2D\u8DEF\u7531",children:"\u7B2C\u4E8C\u6B65\uFF1A\u6062\u5FA9\u672C\u5730\u9810\u8A2D\u8DEF\u7531"}),"\n",(0,s.jsx)(e.p,{children:"VPN \u7684\u9810\u8A2D\u8DEF\u7531\u6E05\u6389\u4E4B\u5F8C\uFF0C\u6211\u5011\u9700\u8981\u628A\u539F\u672C\u7684\u672C\u5730 gateway \u88DC\u56DE\u4F86\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u9019\u6A23\u624D\u80FD\u8B93\u50CF\u662F ",(0,s.jsx)(e.code,{children:"google.com"}),"\u3001",(0,s.jsx)(e.code,{children:"youtube.com"})," \u7B49\u4E00\u822C\u7DB2\u8DEF\u6D41\u91CF\u56DE\u5230\u5BE6\u9AD4\u7DB2\u5361\uFF08en0\u3001en1 \u7B49\uFF09\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'if ! sudo route -n change default "$LOCAL_GW"; then\n  sudo route -n add default "$LOCAL_GW"\nfi\n'})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"$LOCAL_GW"})," \u662F\u5F9E ",(0,s.jsx)(e.code,{children:"netstat"})," \u4E2D\u81EA\u52D5\u53D6\u5F97\u7684\u539F\u672C gateway\uFF0C\u4F8B\u5982 ",(0,s.jsx)(e.code,{children:"192.168.0.1"}),"\uFF0C\u540C\u6A23\u4E0D\u9700\u624B\u52D5\u8F38\u5165\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u7B2C\u4E09\u6B65\u52A0\u5165\u5167\u7DB2\u5C08\u5C6C\u8DEF\u7531",children:"\u7B2C\u4E09\u6B65\uFF1A\u52A0\u5165\u5167\u7DB2\u5C08\u5C6C\u8DEF\u7531"}),"\n",(0,s.jsx)(e.p,{children:"\u63A5\u4E0B\u4F86\u8981\u8655\u7406\u7684\u662F\u8B93 VPN \u53EA\u8655\u7406\u516C\u53F8\u5167\u90E8\u7684\u6D41\u91CF\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u5047\u8A2D\u5167\u90E8\u7DB2\u6BB5\u662F ",(0,s.jsx)(e.code,{children:"10.0.0.0/8"}),"\uFF0C\u6211\u5011\u6703\u5C0E\u5230 VPN \u7684\u5C0D\u7AEF IP\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'sudo route -n add -net 10.0.0.0/8 "$VPN_PEER"\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679C\u8A72\u8DEF\u7531\u5DF2\u5B58\u5728\uFF0C\u5247\u6539\u7528 ",(0,s.jsx)(e.code,{children:"change"}),"\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'sudo route -n change -net 10.0.0.0/8 "$VPN_PEER"\n'})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"$VPN_PEER"})," \u662F VPN Point-to-Point \u5C0D\u7AEF\u7684 IP\uFF0C\u7531\u8173\u672C\u900F\u904E ",(0,s.jsx)(e.code,{children:"ifconfig utunX"})," \u5206\u6790\u81EA\u52D5\u53D6\u5F97\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.admonition,{type:"warning",children:[(0,s.jsx)(e.p,{children:"\u5982\u679C\u4F60\u7684\u5167\u7DB2\u4E0D\u662F 10.0.0.0/8\uFF0C\u8A18\u5F97\u8981\u4FEE\u6539\u9019\u6BB5\u3002\u4F8B\u5982\u516C\u53F8\u5167\u7DB2\u662F 172.16.0.0/12\uFF0C\u5C31\u8981\u5C0D\u61C9\u8ABF\u6574\u6210\uFF1A"}),(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'sudo route -n add -net 172.16.0.0/12 "$VPN_PEER"\n'})})]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u7B2C\u56DB\u6B65\u78BA\u8A8D\u8A2D\u5B9A\u662F\u5426\u751F\u6548",children:"\u7B2C\u56DB\u6B65\uFF1A\u78BA\u8A8D\u8A2D\u5B9A\u662F\u5426\u751F\u6548"}),"\n",(0,s.jsx)(e.p,{children:"\u6700\u5F8C\u9019\u4E00\u6B65\uFF0C\u662F\u6211\u52A0\u5F37\u7684\u90E8\u5206\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u53EA\u8981\u4F60\u57F7\u884C\u9019\u652F\u8173\u672C\uFF0C\u4E26\u7D66\u5E7E\u500B\u6E2C\u8A66\u76EE\u6A19\uFF0C\u7A0B\u5F0F\u5C31\u6703\u81EA\u52D5\uFF1A"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"\u6AA2\u67E5\u6BCF\u500B IP \u6216\u4E3B\u6A5F\u540D\u5BE6\u969B\u8D70\u7684\u662F\u54EA\u500B\u4ECB\u9762"}),"\n",(0,s.jsx)(e.li,{children:"\u5617\u8A66\u5C0D\u8A72\u4E3B\u6A5F\u9001\u51FA ping\uFF0C\u770B\u80FD\u5426\u901A"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u4F8B\u5982\uFF1A"}),"\n",(0,s.jsx)(e.p,{children:"\u4F60\u53EA\u8981\u57F7\u884C\u8173\u672C\u4E26\u8F38\u5165\u5E7E\u500B\u6E2C\u8A66\u76EE\u6A19\uFF0C\u4F8B\u5982\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"bash forticlient_split.sh 10.1.1.1 192.168.0.100 google.com\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5C31\u6703\u5F97\u5230\u4EE5\u4E0B\u985E\u4F3C\u7684\u8F38\u51FA\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u{1F310} 10.1.1.1      \u279C \u4ECB\u9762 utun4 (\u671F\u671B utun4) \u2705  \u9023\u901A \u2705\n\u{1F310} 192.168.0.100 \u279C \u4ECB\u9762 en0   (\u671F\u671B \u672C\u5730)   \u2705  \u9023\u901A \u2705\n\u{1F310} google.com    \u279C \u4ECB\u9762 en0   (\u671F\u671B \u672C\u5730)   \u2705  \u9023\u901A \u2705\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u9019\u6A23\u4E00\u4F86\u5C31\u80FD\u5FEB\u901F\u9A57\u8B49\u4F60\u8A2D\u5B9A\u7684\u300CVPN \u53EA\u8CA0\u8CAC\u516C\u53F8\u5167\u7DB2\u300D\u6709\u6C92\u6709\u6210\u529F\u751F\u6548\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u9023\u7DDA\u3001\u4ECB\u9762\u3001\u901A\u8A0A\u4E00\u76EE\u4E86\u7136\uFF01"}),"\n",(0,s.jsx)(e.p,{children:"\u770B\u8D77\u4F86\u9084\u4E0D\u932F\u5427\uFF01"}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u5B8C\u6574\u8173\u672C",children:"\u5B8C\u6574\u8173\u672C"}),"\n",(0,s.jsx)(e.p,{children:"\u6211\u5C07\u6574\u5957\u5B8C\u6574\u8173\u672C\u6574\u7406\u5728\u4E0B\u65B9\uFF0C\u652F\u63F4 macOS\u3001FortiClient VPN\u3001\u81EA\u52D5\u5075\u6E2C\u3001\u932F\u8AA4\u63D0\u793A\u3001\u9023\u901A\u6E2C\u8A66\u3001\u8DEF\u7531\u5370\u51FA\u3001\u89E3\u6790\u5C0D\u7AEF IP \u7B49\u529F\u80FD\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u4F60\u53EF\u4EE5\u5C07\u9019\u500B\u8173\u672C\u547D\u540D\u70BA ",(0,s.jsx)(e.code,{children:"forticlient_split.sh"}),"\uFF0C\u52A0\u4E0A\u57F7\u884C\u6B0A\u9650\u5F8C\u76F4\u63A5\u57F7\u884C\uFF1A"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"chmod +x forticlient_split.sh\n./forticlient_split.sh 10.1.1.1 192.168.0.100 google.com\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4EE5\u4E0B\u70BA\u7A0B\u5F0F\u78BC\uFF0C\u795D\u4F60\u4F7F\u7528\u6109\u5FEB\uFF1A"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",metastring:'title="forticlient_split.sh" showLineNumbers',children:'#!/usr/bin/env bash\n# =============================================================================\n# FortiClient VPN Split Routing with Enhanced Output\n#\n# This script resets FortiClient\u2013injected routes, restores the local default\n# gateway for non-VPN traffic, binds the 10.0.0.0/8 network to the VPN, and\n# then shows rich diagnostics: routing tables, interface mappings, and\n# connectivity tests (ping).\n#\n# Usage:\n#   forticlient_split.sh [ -h | --help ] host1 [host2 ...]\n#\n# Options:\n#   -h, --help    Show this help message and exit.\n# =============================================================================\n\nset -euo pipefail\nIFS=$\'\\n\\t\'\n\n# -----------------------------------------------------------------------------\n# Error and Info Helpers\n# -----------------------------------------------------------------------------\n\n# die prints an error message and exits with status 1.\n# Arguments:\n#   $@: The error message to display.\ndie() {\n  printf \'\u274C %s\\n\' "$*" >&2\n  exit 1\n}\n\n# info prints an informational message.\n# Arguments:\n#   $@: The message to display.\ninfo() {\n  printf \'\u2139\uFE0F  %s\\n\' "$*"\n}\n\n# -----------------------------------------------------------------------------\n# Utility Functions\n# -----------------------------------------------------------------------------\n\n# get_vpn_interface finds the first utun/tun/ppp interface with a PtP address.\n# Returns:\n#   Prints the interface name or nothing if not found.\nget_vpn_interface() {\n  while read -r iface; do\n    iface=${iface%:}\n    if ifconfig "$iface" | grep -q \'inet .*--\x3e\'; then\n      printf \'%s\\n\' "$iface"\n      return\n    fi\n  done < <(ifconfig | awk \'/^(utun|tun|ppp)[0-9]+:/{print $1}\')\n}\n\n# get_vpn_peer obtains the Point-to-Point peer IP for a given VPN interface.\n# Args:\n#   $1: Interface name (e.g. utun4)\n# Returns:\n#   Prints the peer IP or nothing if not found.\nget_vpn_peer() {\n  local iface="$1"\n  ifconfig "$iface" | awk \'/inet / && /--\x3e/ {\n    for (i = 1; i <= NF; i++) {\n      if ($i == "--\x3e") { print $(i+1); exit }\n    }\n  }\'\n}\n\n# get_local_gateway finds the non-VPN default gateway.\n# Returns:\n#   Prints the gateway IP or nothing if not found.\nget_local_gateway() {\n  netstat -rn \\\n    | awk \'$1=="default" && $NF !~ /(utun|tun|ppp)/ { print $2; exit }\'\n}\n\n# iface_of returns the interface used to reach a host.\n# Args:\n#   $1: Hostname or IP\n# Returns:\n#   Prints the interface name.\niface_of() {\n  route get "$1" 2>/dev/null \\\n    | awk \'/interface:/{print $2}\'\n}\n\n# show_route_info prints current routes for default and 10.0.0.0/8.\nshow_route_info() {\n  printf \'\\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\\n\'\n  info "\u{1F50E} \u7576\u524D Default Route:"\n  route get default 2>/dev/null | awk \'NR<=5\'\n  info "\u{1F50E} \u7576\u524D 10.0.0.0/8 Route:"\n  route get 10.0.0.1 2>/dev/null | awk \'NR<=5\'\n  printf \'\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\\n\\n\'\n}\n\n# test_connect tests ping connectivity to a host.\n# Args:\n#   $1: Hostname or IP\ntest_connect() {\n  local host="$1"\n  printf \'   \u21B3 \u6E2C\u8A66 %s: \' "$host"\n  if ping -c2 -W1 "$host" &>/dev/null; then\n    printf \'\u2705 \u53EF\u9054\\n\'\n  else\n    printf \'\u274C \u4E0D\u53EF\u9054\\n\'\n  fi\n}\n\n# -----------------------------------------------------------------------------\n# Usage\n# -----------------------------------------------------------------------------\n\nusage() {\n  cat <<-EOF\nUsage: $(basename "$0") [ -h | --help ] host1 [host2 ...]\nOptions:\n  -h, --help    Show this help message and exit.\nEOF\n  exit 0\n}\n\n# -----------------------------------------------------------------------------\n# Main\n# -----------------------------------------------------------------------------\n\n# Parse flags.\nif [[ "${1-}" =~ ^-h|--help$ ]]; then\n  usage\nfi\n\n# Collect hosts.\nHOSTS=("$@")\n(( ${#HOSTS[@]} )) || die "\u8ACB\u6307\u5B9A\u81F3\u5C11\u4E00\u500B host\u3002"\n\n# 1. Detect VPN interface and gateways.\ninfo "\u{1F50D} \u5075\u6E2C VPN \u4ECB\u9762\u8207\u672C\u5730 gateway"\nVPN_IF=$(get_vpn_interface)                         || die "\u627E\u4E0D\u5230 VPN \u4ECB\u9762 (utun/tun/ppp)\u3002"\nVPN_PEER=$(get_vpn_peer "$VPN_IF")                  || die "\u7121\u6CD5\u53D6\u5F97 VPN PtP \u5C0D\u7AEF IP\u3002"\nLOCAL_GW=$(get_local_gateway)                       || die "\u7121\u6CD5\u53D6\u5F97\u672C\u5730 gateway\u3002"\ninfo "   \u2022 VPN \u4ECB\u9762\uFF1A$VPN_IF"\ninfo "   \u2022 VPN Peer\uFF1A$VPN_PEER"\ninfo "   \u2022 \u672C\u5730 Gateway\uFF1A$LOCAL_GW"\n\n# Show current routes before changes\nshow_route_info\n\n# 2. Reset routes injected by FortiClient.\ninfo "\u{1F9F9} \u79FB\u9664 FortiClient \u5F37\u5236\u6CE8\u5165\u7684\u8DEF\u7531"\nfor cidr in default 0.0.0.0/1 128.0.0.0/1; do\n  sudo route -q -n delete -ifscope "$VPN_IF" "$cidr" 2>/dev/null || true\ndone\n\n# 3. Restore local default gateway.\ninfo "\u{1F6A7} \u8A2D\u5B9A\u672C\u5730 default \u279C $LOCAL_GW"\nif ! sudo route -n change default "$LOCAL_GW" 2>/dev/null; then\n  sudo route -n add default "$LOCAL_GW"\nfi\n\n# 4. Bind 10.0.0.0/8 to VPN.\ninfo "\u{1F517} \u7D81\u5B9A 10.0.0.0/8 \u279C $VPN_PEER ($VPN_IF)"\nif ! sudo route -n add -net 10.0.0.0/8 "$VPN_PEER" 2>/dev/null; then\n  sudo route -n change -net 10.0.0.0/8 "$VPN_PEER"\nfi\n\n# Show current routes after changes\nshow_route_info\n\n# 5. Verify routing interfaces and connectivity.\ninfo "\u{1F310} \u6E2C\u8A66\u8DEF\u7531\u4ECB\u9762\u8207\u53EF\u9054\u6027"\nfor host in "${HOSTS[@]}"; do\n  actual_if=$(iface_of "$host" || echo "\u672A\u77E5")\n  if [[ $host == 10.* ]]; then\n    expected_if="$VPN_IF"\n  else\n    expected_if="\u672C\u5730 (\u975E VPN)"\n  fi\n  printf \'   \u2022 %-15s \u279C \u4ECB\u9762 %-8s (\u671F\u671B %s)\\n\' \\\n    "$host" "$actual_if" "$expected_if"\n  test_connect "$host"\ndone\n\ninfo "\u{1F389} \u5B8C\u6210\u8A2D\u5B9A\u3001\u8DEF\u7531\u8207\u9023\u901A\u6027\u6E2C\u8A66"\n'})})]})}function h(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},84429:function(n,e,t){t.d(e,{R:()=>o,x:()=>l});var i=t(96540);let s={},r=i.createContext(s);function o(n){let e=i.useContext(r);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:o(n.components),i.createElement(r.Provider,{value:e},n.children)}},46796:function(n){n.exports=JSON.parse('{"permalink":"/blog/mac-forticlient-vpn-split-routing","source":"@site/blog/2025/08-02-mac-forticlient-vpn-split-routing/index.md","title":"FortiClient VPN \u5206\u6D41\u8A2D\u5B9A\u8207\u8DEF\u7531\u6E2C\u8A66","description":"\u8B93 FortiClient \u53EA\u8CA0\u8CAC\u516C\u53F8\u5167\u7DB2\uFF0C\u5176\u4ED6\u6D41\u91CF\u5168\u90E8\u56DE\u5230\u672C\u5730\u3002","date":"2025-08-02T00:00:00.000Z","tags":[{"inline":true,"label":"vpn-routing","permalink":"/blog/tags/vpn-routing"},{"inline":true,"label":"macos","permalink":"/blog/tags/macos"},{"inline":true,"label":"forticlient","permalink":"/blog/tags/forticlient"}],"readingTime":7.3,"hasTruncateMarker":true,"authors":[{"name":"Z. Yuan","title":"Dosaid maintainer, Full-Stack AI Engineer","url":"https://github.com/zephyr-sh","socials":{"github":"https://github.com/zephyr-sh","linkedin":"https://www.linkedin.com/in/ze-yuan-sh7/"},"imageURL":"https://github.com/zephyr-sh.png","key":"Z. Yuan","page":null}],"frontMatter":{"slug":"mac-forticlient-vpn-split-routing","title":"FortiClient VPN \u5206\u6D41\u8A2D\u5B9A\u8207\u8DEF\u7531\u6E2C\u8A66","authors":"Z. Yuan","tags":["vpn-routing","macos","forticlient"],"image":"/img/2025/0802.jpg","description":"\u8B93 FortiClient \u53EA\u8CA0\u8CAC\u516C\u53F8\u5167\u7DB2\uFF0C\u5176\u4ED6\u6D41\u91CF\u5168\u90E8\u56DE\u5230\u672C\u5730\u3002"},"unlisted":false,"nextItem":{"title":"Docusaurus Sidebar \u8A08\u6578\u529F\u80FD\u7684\u9032\u968E\u5BE6\u4F5C\uFF1A\u905E\u8FF4\u7D71\u8A08\u8207\u7A69\u5B9A slug","permalink":"/blog/docusaurus-sidebars-enhanced-counting"}}')}}]);